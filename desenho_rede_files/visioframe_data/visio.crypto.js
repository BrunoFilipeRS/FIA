function decryptDocData(n,t,i,r,u,f,e){var o=workerCode.toString(),h,s;o=o.substring(o.indexOf("{")+1,o.lastIndexOf("}"));h=new Blob([o],{type:"application/javascript"});s=new Worker(URL.createObjectURL(h));s.onmessage=function(n){var t=JSON.parse(n.data);t.err?e(t.err,null):f(t,null);s.terminate()};s.postMessage(JSON.stringify({operation:"decrypt",encrypted:n,privateKey:t,iv:i,hash:r,ix:u}))}function encryptDocData(n,t,i,r,u){var f=workerCode.toString(),o,e;f=f.substring(f.indexOf("{")+1,f.lastIndexOf("}"));o=new Blob([f],{type:"application/javascript"});e=new Worker(URL.createObjectURL(o));e.onmessage=function(n){var t=JSON.parse(n.data);t.err?u(t.err,null):r(t,null);e.terminate()};e.postMessage(JSON.stringify({operation:"encrypt",text:n,privateKey:t,ix:i}))}function browserSupportCrypto(){try{return window.crypto&&window.crypto.subtle&&window.TextEncoder&&window.Worker&&window.atob}catch(n){return!1}}function workerCode(){function n(n){return btoa(new Uint8Array(n).reduce(function(n,t){return n+String.fromCharCode(t)},""))}function t(n){for(var i=self.atob(n),r=i.length,u=new Uint8Array(new ArrayBuffer(r)),t=0;t<r;t+=1)u[t]=i.charCodeAt(t);return u}function i(i,r,u,e,o){var s,h;try{var l={name:"PBKDF2",hash:"SHA-256",salt:(new TextEncoder).encode("VisioBrowserCacheSalt"),iterations:1e3},a={name:"AES-GCM",length:256},v=(new TextEncoder).encode(r),c={name:"AES-GCM",length:256,iv:new Uint8Array(12)};for(s=0;s<12;s+=1)c.iv[s]=u[s];h=self.crypto;h.subtle.importKey("raw",v,"PBKDF2",!1,["deriveKey"]).then(function(r){h.subtle.deriveKey(l,r,a,!1,["encrypt","decrypt"]).then(function(r){h.subtle.decrypt(c,r,t(i)).then(function(t){var i=f((new TextDecoder).decode(t));h.subtle.digest("SHA-256",(new TextEncoder).encode(i)).then(function(t){e.localeCompare(n(t))==0&&postMessage(JSON.stringify({Text:i,ix:o}))},function(n){postMessage(JSON.stringify({err:n.toString()}))})},function(n){postMessage(JSON.stringify({err:n.toString()}))})},function(n){postMessage(JSON.stringify({err:n.toString()}))})},function(n){postMessage(JSON.stringify({err:n.toString()}))})}catch(y){postMessage(JSON.stringify({err:y.toString()}))}}function r(t,i,r){try{var f=self.crypto,o={name:"PBKDF2",hash:"SHA-256",salt:(new TextEncoder).encode("VisioBrowserCacheSalt"),iterations:1e3},e={name:"AES-GCM",length:256,iv:f.getRandomValues(new Uint8Array(12))},s={name:"AES-GCM",length:256},h=(new TextEncoder).encode(i),c=f.subtle.digest("SHA-256",(new TextEncoder).encode(t));f.subtle.importKey("raw",h,"PBKDF2",!1,["deriveKey"]).then(function(i){f.subtle.deriveKey(o,i,s,!1,["encrypt","decrypt"]).then(function(i){f.subtle.encrypt(e,i,(new TextEncoder).encode(u(t))).then(function(t){c.then(function(i){postMessage(JSON.stringify({Data:n(t),iv:e.iv,Hash:n(i),ix:r}))},function(n){postMessage(JSON.stringify({err:n.toString()}))})},function(n){postMessage(JSON.stringify({err:n.toString()}))})},function(n){postMessage(JSON.stringify({err:n.toString()}))})},function(n){postMessage(JSON.stringify({err:n.toString()}))})}catch(l){postMessage(JSON.stringify({err:l.toString()}))}}function u(n){return null==n?"":e(n,15,function(n){return String.fromCharCode(n+32)})+" "}function f(n){return null==n?"":""==n?null:o(n.length,16384,function(t){return n.charCodeAt(t)-32})}function e(n,t,i){if(null==n)return"";for(var f,e,l={},v={},a="",y="",o="",c=2,w=3,s=2,h=[],r=0,u=0,p=0;p<n.length;p+=1)if(a=n.charAt(p),Object.prototype.hasOwnProperty.call(l,a)||(l[a]=w++,v[a]=!0),y=o+a,Object.prototype.hasOwnProperty.call(l,y))o=y;else{if(Object.prototype.hasOwnProperty.call(v,o)){if(o.charCodeAt(0)<256){for(f=0;f<s;f++)r<<=1,u==t-1?(u=0,h.push(i(r)),r=0):u++;for(e=o.charCodeAt(0),f=0;f<8;f++)r=r<<1|1&e,u==t-1?(u=0,h.push(i(r)),r=0):u++,e>>=1}else{for(e=1,f=0;f<s;f++)r=r<<1|e,u==t-1?(u=0,h.push(i(r)),r=0):u++,e=0;for(e=o.charCodeAt(0),f=0;f<16;f++)r=r<<1|1&e,u==t-1?(u=0,h.push(i(r)),r=0):u++,e>>=1}0==--c&&(c=Math.pow(2,s),s++);delete v[o]}else for(e=l[o],f=0;f<s;f++)r=r<<1|1&e,u==t-1?(u=0,h.push(i(r)),r=0):u++,e>>=1;0==--c&&(c=Math.pow(2,s),s++);l[y]=w++;o=String(a)}if(""!==o){if(Object.prototype.hasOwnProperty.call(v,o)){if(o.charCodeAt(0)<256){for(f=0;f<s;f++)r<<=1,u==t-1?(u=0,h.push(i(r)),r=0):u++;for(e=o.charCodeAt(0),f=0;f<8;f++)r=r<<1|1&e,u==t-1?(u=0,h.push(i(r)),r=0):u++,e>>=1}else{for(e=1,f=0;f<s;f++)r=r<<1|e,u==t-1?(u=0,h.push(i(r)),r=0):u++,e=0;for(e=o.charCodeAt(0),f=0;f<16;f++)r=r<<1|1&e,u==t-1?(u=0,h.push(i(r)),r=0):u++,e>>=1}0==--c&&(c=Math.pow(2,s),s++);delete v[o]}else for(e=l[o],f=0;f<s;f++)r=r<<1|1&e,u==t-1?(u=0,h.push(i(r)),r=0):u++,e>>=1;0==--c&&(c=Math.pow(2,s),s++)}for(e=2,f=0;f<s;f++)r=r<<1|1&e,u==t-1?(u=0,h.push(i(r)),r=0):u++,e>>=1;for(;;){if(r<<=1,u==t-1){h.push(i(r));break}u++}return h.join("")}function o(n,t,i){for(var a,f,e,o,u,s,h=[],c=4,l=4,v=3,y="",w=[],r={val:i(0),position:t,index:1},p=0;p<3;p+=1)h[p]=p;for(f=0,o=Math.pow(2,2),u=1;u!=o;)e=r.val&r.position,r.position>>=1,0==r.position&&(r.position=t,r.val=i(r.index++)),f|=(e>0?1:0)*u,u<<=1;switch(f){case 0:for(f=0,o=Math.pow(2,8),u=1;u!=o;)e=r.val&r.position,r.position>>=1,0==r.position&&(r.position=t,r.val=i(r.index++)),f|=(e>0?1:0)*u,u<<=1;s=String.fromCharCode(f);break;case 1:for(f=0,o=Math.pow(2,16),u=1;u!=o;)e=r.val&r.position,r.position>>=1,0==r.position&&(r.position=t,r.val=i(r.index++)),f|=(e>0?1:0)*u,u<<=1;s=String.fromCharCode(f);break;case 2:return""}for(h[3]=s,a=s,w.push(s);;){if(r.index>n)return"";for(f=0,o=Math.pow(2,v),u=1;u!=o;)e=r.val&r.position,r.position>>=1,0==r.position&&(r.position=t,r.val=i(r.index++)),f|=(e>0?1:0)*u,u<<=1;switch(s=f){case 0:for(f=0,o=Math.pow(2,8),u=1;u!=o;)e=r.val&r.position,r.position>>=1,0==r.position&&(r.position=t,r.val=i(r.index++)),f|=(e>0?1:0)*u,u<<=1;h[l++]=String.fromCharCode(f);s=l-1;c--;break;case 1:for(f=0,o=Math.pow(2,16),u=1;u!=o;)e=r.val&r.position,r.position>>=1,0==r.position&&(r.position=t,r.val=i(r.index++)),f|=(e>0?1:0)*u,u<<=1;h[l++]=String.fromCharCode(f);s=l-1;c--;break;case 2:return w.join("")}if(0==c&&(c=Math.pow(2,v),v++),h[s])y=h[s];else{if(s!==l)return null;y=a+a.charAt(0)}w.push(y);h[l++]=a+y.charAt(0);a=y;0==--c&&(c=Math.pow(2,v),v++)}}onmessage=function(n){try{var t=JSON.parse(n.data);t.operation=="decrypt"?i(t.encrypted,t.privateKey,t.iv,t.hash,t.ix):t.operation=="encrypt"?r(t.text,t.privateKey,t.ix):postMessage(JSON.stringify({err:"Invalid operation requested."}))}catch(n){postMessage(JSON.stringify({err:n.toString()}))}}}