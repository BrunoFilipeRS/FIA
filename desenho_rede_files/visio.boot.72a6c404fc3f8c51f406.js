var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Visio=function(i){var e={};function t(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return i[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=i,t.c=e,t.d=function(i,e,n){t.o(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:n})},t.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,e){if(1&e&&(i=t(i)),8&e)return i;if(4&e&&"object"==typeof i&&i&&i.__esModule)return i;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&e&&"string"!=typeof i)for(var o in i)t.d(n,o,function(e){return i[e]}.bind(null,o));return n},t.n=function(i){var e=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(e,"a",e),e},t.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},t.p="",t(t.s=17)}({17:function(i,e,t){"use strict";var n,o;t.r(e),t.d(e,"ApplicationEvents",(function(){return se})),t.d(e,"DocRebootSupportMode",(function(){return Kt})),t.d(e,"CommandIds",(function(){return Ti})),t.d(e,"EventIds",(function(){return Le})),t.d(e,"createCancellationToken",(function(){return ut})),t.d(e,"Application",(function(){return $t})),t.d(e,"createApplication",(function(){return Zt})),function(i){i[i.u=0]="msoulscat_ES_EWAJS",i[i.h=1]="msoulscat_ES_EWAJSGrid",i[i.v=6]="msoulscat_ES_EWAJSChart",i[i.g=202]="msoulscat_MSOSP_FileMenuCommands",i[i.A=220]="msoulscat_MSOSP_AddInCommands",i[i._=225]="msoulscat_MSOSP_OTelJS",i[i.F=227]="msoulscat_MSOSP_OTelJSInWebWoker",i[i.R=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",i[i.P=301]="msoulscat_Wac_WordViewer",i[i.O=306]="msoulscat_Wac_BrowserGeneral",i[i.k=320]="msoulscat_Wac_TaskPane",i[i.U=339]="msoulscat_Wac_OneNoteGeneral",i[i.N=340]="msoulscat_Wac_Ribbon",i[i.B=356]="msoulscat_Wac_WacFeedback",i[i.H=379]="msoulscat_Wac_WopiPendingApplication",i[i.J=383]="msoulscat_Wac_Telemetry",i[i.j=391]="msoulscat_Wac_WacCatchUpActivities",i[i.q=394]="msoulscat_Wac_Dictation",i[i.K=395]="msoulscat_Wac_OneNoteSync",i[i.X=700]="msoulscat_Wac_VisioApp",i[i.$=1601]="msoulscat_OneNoteOnline_EditableCache",i[i.Z=800]="msoulscat_Wac_PptAnimation",i[i.Y=833]="msoulscat_Wac_PptLive",i[i.ii=834]="msoulscat_Wac_PptMWeb",i[i.ei=835]="msoulscat_Wac_PptGc2General",i[i.ti=836]="msoulscat_Wac_PptGc2GraphicHost",i[i.ni=837]="msoulscat_Wac_PptGc2Operation",i[i.oi=844]="msoulscat_Wac_PptDataSync",i[i.ri=848]="msoulscat_Wac_PptFluidRuntime",i[i.si=815]="msoulscat_Wac_PptShape",i[i.ai=817]="msoulscat_Wac_PptSession",i[i.ci=830]="msoulscat_Wac_PptSlideshow",i[i.di=822]="msoulscat_Wac_PptView",i[i.li=846]="msoulscat_Wac_PptVideos",i[i.fi=1303]="msoulscat_Uci_Insights",i[i.hi=2300]="msoulscat_Wac_VersionHistory",i[i.pi=302]="msoulscat_Wac_WordPresence",i[i.vi=3e3]="msoulscat_Wac_OAuth",i[i.wi=3005]="msoulscat_Wac_WordVersionHistory",i[i.mi=3006]="msoulscat_Wac_LivePersonaCard",i[i.gi=3012]="msoulscat_Wac_CatchUpFlyout",i[i.Si=3016]="msoulscat_Wac_WordDesigner",i[i.bi=3021]="msoulscat_Wac_ModernFontPicker",i[i.Ii=3027]="msoulscat_Wac_UnifiedUiHost",i[i.Ti=3033]="msoulscat_Wac_EquationTools",i[i.yi=1401]="msoulscat_Osf_Latency",i[i.Ci=1402]="msoulscat_Osf_Notification",i[i.Ai=1403]="msoulscat_Osf_Runtime",i[i._i=3041]="msoulscat_Wac_AiMaker",i[i.Fi=3043]="msoulscat_Wac_AiRewrite",i[i.Ei=3044]="msoulscat_Wac_AiInsert",i[i.Vi=3047]="msoulscat_Wac_AiSummarize",i[i.Ri=3048]="msoulscat_Wac_CopilotCompose",i[i.Pi=3049]="msoulscat_Wac_Skittles"}(n||(n={})),function(i){i[i.Error=10]="Error",i[i.Warning=15]="Warning",i[i.Important=20]="Important",i[i.Info=50]="Info",i[i.Verbose=100]="Verbose",i[i.Spam=200]="Spam"}(o||(o={}));var r=["eurppc"];function s(i){return 8===i.toLowerCase().indexOf("ffc")}function a(i){return 8===i.toLowerCase().indexOf("ppc")}function c(i){var e=i.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return e&&e[1]?e[1]:"public"}function u(i){var e=i.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!e)throw new Error("Invalid URL");return e[1]}function d(i,e){var t=i.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!t)throw new Error("Invalid URL");var n=t[2];if(void 0===e)return n;if(e<0)throw new Error("subDomainParts should be at least 1");return n.split(".").slice(-(e+1)).join(".")}function l(i,e,t){t&&(i[e.toLowerCase()]=t)}function f(i,e){i[e.toLowerCase()]=""}function h(i,e){var t=i.toLowerCase(),n=e.toLowerCase(),o=t.indexOf("&"+n+"=");if(-1===o&&(o=t.indexOf("?"+n+"=")),-1===o)return"";var r=o+(e.length+2),s=i.indexOf("&",r);return i.substring(r,-1===s?void 0:s)}function p(i,e,t,n){if(!t)return i;var o=i,r=o.indexOf("?"),s="&";r===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?s="":-1===r&&(s="?");var a=e.toLowerCase()+"=",c=new RegExp("\\W"+a,"i").exec(o);if("?"!==s&&c){if(n){var u=c.index+1,d=o.indexOf("&",u);o=o.substring(0,u)+a+t+(-1===d?"":o.substring(d))}return o}return o.concat(s,a,t)}function v(i){var e={},t=i.indexOf("?");return-1===t||t===i.length-1||i.substring(t+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(i){if(i){var t=i.indexOf("=");-1!==t&&t!==i.length-1&&(e[i.substring(0,t).toLowerCase()]=i.substring(t+1))}})),e}function w(i,e){if(!i)return i;var t=i,n=t.indexOf("?"),o=e.toLowerCase()+"=",r=t.toLowerCase().indexOf(o,n);if(r>=0){var s=t.indexOf("&",r);return"&"===(t=t.substring(0,r)+(-1===s?"":t.substring(s+1))).slice(-1)&&(t=t.slice(0,-1)),t}return i}function m(i){var e=new RegExp("(c[1-5])h?(-)");return i.replace(e,"$1h$2")}function g(i,e,t){var n=new RegExp("[?&]"+e+"=("+(t||"1")+")\\b","i"),o=i.match(n);return!!o&&(!t||o[1]===t)}function S(i,e){var t=h(i,e);return t?decodeURI(t):t}function b(i){return i?i.indexOf("://")>-1?i.split("/")[2]:i.split("/")[0]:""}var I={BUILD_NUMBER:"###VERSION###"};function T(){try{return"20240328.7"}catch(i){return I.BUILD_NUMBER}}function y(){return function(i){if(!i)throw new Error("Build number not available");var e=i.split(".");if(4!==e.length)throw new Error("Build number has incorrect format");return e[0]+e[2]+e[3]}(T())}var C=function(){return(C=Object.assign||function(i){for(var e,t=1,n=arguments.length;t<n;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(i[o]=e[o]);return i}).apply(this,arguments)};function A(i,e,t,n){return new(t||(t=Promise))((function(o,r){function s(i){try{c(n.next(i))}catch(i){r(i)}}function a(i){try{c(n.throw(i))}catch(i){r(i)}}function c(i){var e;i.done?o(i.value):(e=i.value,e instanceof t?e:new t((function(i){i(e)}))).then(s,a)}c((n=n.apply(i,e||[])).next())}))}function _(i,e){var t,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(s=0)),s;)try{if(t=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(i,s)}catch(i){a=[6,i],n=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function F(i,e,t){if(t||2===arguments.length)for(var n,o=0,r=e.length;o<r;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return i.concat(n||Array.prototype.slice.call(e))}Object.create;function E(i){if(i){var e=i.lastIndexOf(".");if(-1!==e)return i.substring(e+1).toLowerCase()}return""}function V(i){if(!i)return"";var e=Object.getOwnPropertyNames(i),t=Object.getOwnPropertyNames(Object.getPrototypeOf(i));return JSON.stringify(i,F(F([],e,!0),t,!0))}var R,P,O,x=function(){try{var i=window.performance;return i&&i.now&&i.now()!==1/0}catch(i){return!1}}();function k(){return x?window.performance.now():Date.now()}function W(){if(!R){var i=window.performance;R=x&&i.timing&&i.timing.navigationStart?function(){return Math.round(i.now()+i.timing.navigationStart)}:Date.now?Date.now:function(){return(new Date).getTime()}}return R()}function U(){var i=new Uint8Array(31),e=function(i){var e={crypto:!1,perfNow:!1,exceptions:[]},t=window.crypto||window.msCrypto;if(t){e.crypto=!0;try{return t.getRandomValues(i),e}catch(i){e.exceptions.push("crypto: ".concat(V(i)))}}e.perfNow=x;for(var n=0;n<i.length;n+=1){try{if(x){var o=Math.floor(100*window.performance.now())%10;(o<0||o>9)&&(o=0);for(var r=0;r<o;r+=1)Math.random()}}catch(i){e.exceptions.push("Math.random: ".concat(V(i)))}i[n]=Math.floor(16*Math.random())}return e}(i),t=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=15&i[t];return t+=1,("x"===e?n:3&n|8).toString(16)})),e]}function D(i,e,t){if(e){var n=window.navigator;if(n&&n.sendBeacon)try{return void n.sendBeacon(e,i)}catch(i){}!function(i,e,t){var n=new XMLHttpRequest;n.readyState!==XMLHttpRequest.UNSENT&&n.readyState!==XMLHttpRequest.DONE||(n.open("POST",e,t),n.send(i))}(i,e,t)}}function N(i,e,t){!function(i,e,t,n){void 0===n&&(n=!0);var o={type:e.toString(),payloadJson:JSON.stringify(t)};D(JSON.stringify(o),i,n)}(i,P.JSAPI_STATE,{application:e,build:T(),state:t})}function B(i,e,t,n){var o=[],r=i.map((function(i){return function(i,e,t){var n={};if(n.G=i.tag,n.T=i.timestamp-e,n.M=i.message,n.C=i.category,i.correlationId){var o=t.findIndex((function(e){return e===i.correlationId}));o<0&&(o=t.push(i.correlationId)-1),n.I=o}var r=1e3*i.type+i.level;return n.D=r,n}(i,n,o)})),s=function(i,e,t,n,o){var r={};r.T=i,r.L=e,r.S=t,r.I=n,o&&o.length>0&&(r.W=o);return r.V=1,r}(n,r,e,t,o);return JSON.stringify(s)}!function(i){i.JSAPI_STATE="JSAPI_STATE",i.H_V2="H_V2"}(P||(P={})),function(i){i[i.Trace=0]="Trace",i[i.Assert=1]="Assert"}(O||(O={}));var M,H,L=function(){function i(i){var e=this;this.Oi=3e4,this.xi=30,this.ki=0,this.Wi=[],this.Ui=W(),this.Di=[],this.Ni="",this.Bi=0,this.flushOnClose=function(){e.Mi(!1,!1)},this.flush=function(){e.Hi()},this.flushAndSetNewEndpoint=function(i,t){var n,o=e.Li(i);o.localeCompare(null!==(n=e.Ji)&&void 0!==n?n:"",void 0,{sensitivity:"accent"})&&(e.Di.push((function(){e.Ji=o,t&&t()})),e.Mi(!0,!0))},this.Li=function(i){return i+"?usid="+e.Ni+"&officeserverversion="+T()},this.Hi=function(){window.setTimeout((function(){return e.Mi(!0,!0)}),0)},this.Mi=function(i,t){var n=k();if(window.clearTimeout(e.ji),e.Ji){if(e.Wi.length>0)e.ki+=1,D(B(e.Wi.splice(0,i?e.xi:e.Wi.length),e.Ni,e.ki,e.Ui),e.Ji,t),e.Ui=W();0===e.Wi.length&&e.Di.length>0&&(e.Di.forEach((function(i){"requestIdleCallback"in window?window.requestIdleCallback(i):window.setTimeout(i,0)})),e.Di=[]),i&&(e.ji=window.setTimeout((function(){e.Hi()}),e.Wi.length>e.xi||e.Di.length>0?1e3:e.Oi)),e.Bi+=k()-n}},i&&this.configure(i)}return i.prototype.getTimeSpentLogging=function(){return this.Bi},i.prototype.addLoggingTime=function(i){this.Bi+=i},i.prototype.configure=function(i){var e=k();if(i.uploadCadenceInMs&&(this.Oi=i.uploadCadenceInMs),i.uploadTriggerSize&&(this.xi=i.uploadTriggerSize),i.sessionId&&(this.Ni=i.sessionId),i.remoteUlsEndpoint){if(!i.sessionId&&this.Ji)throw new Error("Remote ULS endpoint is already set");this.Ji=this.Li(i.remoteUlsEndpoint),this.Ui=W(),this.Hi()}this.Bi+=k()-e},i.prototype.handleTrace=function(i){var e=k();i.message.length>3072&&(i.message=i.message.substring(0,3072-"... [Trimmed]".length)+"... [Trimmed]"),this.Wi.push(i),(this.Wi.length>this.xi||i.level===o.Error)&&this.Hi(),this.Bi+=k()-e},i.prototype.getUserSessionId=function(){return this.Ni},i}(),J=[];!function(i){i.Gi="BootstrapperMaxUlsHeartbeatTime",i.zi="BootstrapperNoCompleteWarning1Time",i.qi="BootstrapperNoCompleteWarning2Time",i.Ki="RemoteUlsETag",i.Xi="RemoteUlsSuppressions",i.$i="BootstrapperSettingsFetchPeriod",i.Zi="timestamp",i.Yi="BootstrapperUlsHeartbeatIntervalMs",i.Qi="BootstrapperUlsHeartBeatIsEnabled",i.ie="BootstrapperUlsUploadCadenceMs",i.ee="WordConsumptionViewToEditRedirectIsEnabled",i.te="RequestedCallThrottlingDefaultToViewMinimumValue",i.ne="BulsEndpointUrl",i.oe="EnableCommonHostDiagnosticsParams",i.re="EnableICNForWord",i.se="EnableModernEmbedViewForPowerPoint",i.ae="EnableModernEmbedViewInOneUpForPowerPoint",i.ce="EnableModernReadingViewForPowerPoint",i.ue="EnableDefaultToModernForPowerPoint",i.de="ShouldLogJsApiKpisForWord",i.le="WordSwitchToViewInTeamsJsapiV1Enabled",i.fe="EnableWordSessionRefreshTelemetry",i.he="PowerPointUseEssDCHint",i.pe="ModernEmbedViewBootstrapperFeatureGatesForPowerPoint",i.ve="ModernReadingViewBootstrapperFeatureGatesForPowerPoint",i.we="ModernEmbedViewForPowerPointEnabledPercentage",i.me="PowerPointESSCookieLookbackThresholdHour",i.ge="PowerPointSetESSCookieLookbackExpEnabled"}(H||(H={}));var j;function G(i){var e=new L(i);function t(i,t,n,o){var r=k();if(!function(i){return 1===J[i]}(i)){var s={timestamp:W(),category:t,tag:i,level:n,type:O.Trace,message:o,correlationId:""};e.addLoggingTime(k()-r),e.handleTrace(s)}}return{ULS:{Se:function(i,e,n,o){t(i,e,n,o)},shipAssertTag:function(i,e,n,r){n&&t(i,e,o.Error,r)},debugAssertTag:function(i,e,t,n){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:e.flush,flushOnClose:e.flushOnClose,setCorrelationId:function(){}},configure:function(i){e.configure(i)},settingsChangeHandler:function(i){var t,n;t=i.be.getValue(H.Xi,""),n=i.be.getValue(H.Ki,""),M&&n===M||(J=[],M=n,t&&t.split(",").forEach((function(i){var e=parseInt(i,10);e&&(J[e]=1)}))),e.configure({uploadCadenceInMs:i.be.getValue(H.ie,6e4)});var o=i.be.getValue(H.ne,"").toString();""!==o&&e.flushAndSetNewEndpoint(o)},getTimeSpentLogging:function(){return e.getTimeSpentLogging()},getUserSessionId:function(){return e.getUserSessionId()},flushAndSetNewEndpoint:function(i,t){e.flushAndSetNewEndpoint(i,t)}}}!function(i){i[i.Firefox=0]="Firefox",i[i.Opera=1]="Opera",i[i.IE=2]="IE",i[i.Edge=3]="Edge",i[i.Chrome=4]="Chrome",i[i.Safari=5]="Safari",i[i.TeamsElectron=6]="TeamsElectron",i[i.Unknown=7]="Unknown"}(j||(j={}));var z=window.navigator,q=z?z.userAgent:void 0;function K(){if(q){if(q.indexOf("Firefox")>-1)return j.Firefox;if(q.indexOf("Opera")>-1||q.indexOf("OPR")>-1)return j.Opera;if(q.indexOf("Trident")>-1)return j.IE;if(q.indexOf("Electron")>-1&&q.indexOf("Teams")>-1)return j.TeamsElectron;if(q.indexOf("Edg")>-1)return j.Edge;if(q.indexOf("Chrome")>-1)return j.Chrome;if(q.indexOf("Safari")>-1)return j.Safari}return j.Unknown}function X(){try{return!!q&&q.indexOf("iPad")>=0||!!q&&q.indexOf("Macintosh")>=0&&ii()&&!Q()||!!q&&q.indexOf("Android")>=0||ii()}catch(i){return!1}}function $(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(i){return!1}}function Z(){return K()===j.IE&&!function(){if(K()!==j.IE)return!1;if(null==document.documentMode||void 0===document.documentMode)return!1;return document.documentMode>=11}()}function Y(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(i){return!1}}function Q(){return!!q&&q.indexOf("iPhone")>=0}function ii(){return!!z&&z.maxTouchPoints>0}function ei(i,e){e&&Object.keys(e).forEach((function(t){i[t]=e[t]}))}function ti(i,e){try{if(void 0===window.performance)return void e.ULS.Se(595948609,n.H,o.Info,"Performance not supported");var t=window.performance.getEntriesByType("resource");if(void 0===t||t.length<=0)return void e.ULS.Se(595948610,n.H,o.Info,"No resources under performance");for(var r=new RegExp(i+"(-boot\\.min|(\\.(app|preview))?\\.boot)(\\.[0-9a-f]{20})?\\.js","i"),s=t.length-1;s>=0;s-=1){var a=t[s],c=a.name.match(r);if(c){var u=JSON.stringify(a);return u=u.replace(new RegExp(a.name,"g"),c[0]),void e.ULS.Se(595948616,n.H,o.Info,u)}}e.ULS.Se(595948484,n.H,o.Info,"Could not find JSAPI resource timing entry")}catch(i){e.ULS.Se(595948617,n.H,o.Info,"Could not trace the resource timing: ".concat(V(i)))}}function ni(i){var e,t,n=C(C({},i.host),{sessionId:i.hostSessionId,domain:location?location.host:void 0});delete n.siteId,delete n.webId,delete n.uiHostTabId;var o={};if(i.wdParams){var r=JSON.parse(JSON.stringify(i.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(i){r[i]&&(o[i]=r[i])}));var s=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;o.wdprevioussession&&!s.test(o.wdprevioussession)&&delete o.wdprevioussession,o.wdpreviouscorrelation&&!s.test(o.wdpreviouscorrelation)&&delete o.wdpreviouscorrelation}var a=C({},i.rebootOverride);delete a.ackExpected,delete a["ui-language"],delete a.wdUserSession,delete a.rebootMode,delete a.documentUrl;var u=i.wopi;return{accessToken:u?{length:u.accessToken.length,expiry:u.expiry}:"N/A",wacToken:u&&u.wacToken?{length:u.wacToken.length}:void 0,bootParams:i.bootParams,build:T(),host:n,intent:i.intent,jsApiVersion:"v2",rebootOverride:a,region:c(i.appBaseUrl),sessionOrigin:i.hostInitDiagnostics?i.hostInitDiagnostics.entryPoint:void 0,sessionContext:i.sessionContext,throttling:i.throttling,ui:i.ui,viewMode:i.viewMode,meeting:i.meeting?{id:null===(e=i.meeting)||void 0===e?void 0:e.id,isPresenter:null===(t=i.meeting)||void 0===t?void 0:t.isPresenter}:void 0,wdParams:o}}function oi(){var i={perfNowSupported:x,browser:j[K()],touchMode:X(),highContrast:$(),windows10x:Y()};try{var e=window.navigator,t=e.connection||e.mozConnection||e.webkitConnection;t&&(i.netDownlink=t.downlink,i.netDownlinkMax=t.downlinkMax,i.netEffectiveType=t.effectiveType,i.netRtt=t.rtt,i.netSaveData=t.saveData,i.netType=t.type),i.deviceMemory=e.deviceMemory,i.logicalProcessors=e.hardwareConcurrency}catch(i){}return i}var ri,si;function ai(i){var e=window.performance.timing;e&&(i.hostPageNavigationStartTime||(i.hostPageNavigationStartTime=e.navigationStart),i.hostPageFetchStartTime||(i.hostPageFetchStartTime=e.fetchStart),i.hostPageRequestStartTime||(i.hostPageRequestStartTime=e.requestStart),i.hostPageResponseStartTime||(i.hostPageResponseStartTime=e.responseStart),i.hostPageResponseEndTime||(i.hostPageResponseEndTime=e.responseEnd),i.hostPageDomCompleteTime||(i.hostPageDomCompleteTime=e.domComplete));var t=window.performance.navigation;if(t&&(void 0===i.hostPageRedirectCount&&(i.hostPageRedirectCount=t.redirectCount),!i.hostPageNavigationType)){var n="UNKNOWN";switch(t.type){case 0:n="NAVIGATE";break;case 1:n="RELOAD";break;case 2:n="BACK_FORWARD";break;case 255:n="RESERVED"}i.hostPageNavigationType=n}}function ci(i){var e=document.createElement("link");e.rel="preconnect",e.href=i,e.crossOrigin="anonymous",document.head.appendChild(e)}function ui(i,e){return void 0===i&&(i=!1),{shouldPreconnect:function(i){return li&&(!e||e(i))},preconnect:function(e){return ci(i?m(e):e)}}}!function(i){i[i.Unknown=0]="Unknown",i[i.Normal=1]="Normal",i[i.Minor=2]="Minor",i[i.Medium=3]="Medium",i[i.Major=4]="Major",i[i.Critical=5]="Critical"}(ri||(ri={})),function(i){i.Ie="App_AccessibilityLoopComplete",i.Te="Wac_ActionComplete",i.ye="WacInitialize_Ready",i.Ce="Wac_AppFailed",i.Ae="Wac_AppBootState",i._e="Wac_AppCompleted",i.Fe="BrowserEvent",i.Ee="UI_Close",i.Ve="App_CloseTab",i.Re="UI_Conversation",i.Pe="UI_CopyAndEdit",i.Oe="App_CreateNewDocument",i.xe="Wac_AppDataSavedStatus",i.ke="UI_Download",i.We="UI_Edit",i.Ue="Error",i.De="UI_FileEmbed",i.Ne="UI_FileProperties",i.Be="File_Rename",i.Me="File_RenameFailed",i.He="UI_FileVersions",i.Le="StateChanged",i.Je="App_IsFrameTrusted",i.je="GetAccessToken",i.Ge="App_GetAuthToken",i.ze="App_GetCustomAuthConfig",i.qe="App_GetHostKeyValue",i.Ke="App_WopiInfoFromUrl",i.Xe="App_DavUrlFromIds",i.$e="App_LoadingStatus",i.Ze="App_SwitchMode",i.Ye="App_MoveToFolder",i.Qe="UI_OpenInMobileApp",i.it="UI_OpenInBrowser",i.et="UI_OpenInClient",i.tt="PageChanged",i.nt="App_PushCommentContext",i.ot="App_PushState",i.rt="App_DocReboot",i.st="UI_RedeemForCommenting",i.ct="App_RefreshSessionInfo",i.ut="UI_ReplyWithChanges",i.dt="UI_ReportAbuse",i.lt="App_FilePicker",i.ft="UI_SaveStatus",i.ht="WopiSession_Complete_Ack",i.pt="SetOverlayContent",i.vt="UI_Sharing",i.wt="UI_ShareForm",i.gt="UI_SignIn",i.St="App_StoreHostKeyValue",i.bt="App_Unloaded",i.It="App_UlsLog",i.Tt="Wac_UnloadingApp",i.yt="App_UpdateBootComplete",i.Ct="PageCount",i.At="UI_CheckUserAccessAndGrantPermissions",i._t="User_Activity",i.Ft="Edit_Notification",i.Et="UI_Workflow",i.Vt="ZoomChanged",i.Rt="CAAEMessage",i.Pt="Excel_HostFrameCacheSave",i.Ot="Excel_HostFrameCacheEvict",i.xt="Excel_RegenerateFileBundle",i.kt="App_SwitchToWacFrame",i.Wt="App_SaveSSRData",i.Ut="App_PurgeDataInHostCache",i.Dt="App_SaveHostRenderingV2Data",i.Nt="App_SaveHostUtilsData",i.Bt="AcquireOAuthTokenTeams",i.Mt="App_SwitchNotebook",i.Ht="FailedBoot_CheckFileInfo",i.Lt="GetTeamsUsers",i.Jt="SendTeamsUserMention",i.jt="NavigateBackToHost",i.Gt="App_GetClientUrlComplete",i.zt="App_GetWebUrlComplete",i.qt="App_CopyLinkComplete",i.Kt="App_SendConversationId",i.Xt="CloseTeamsConversation",i.$t="PageLoaded",i.Zt="Visio_BRS",i.Yt="Visio_SendLicenseInfo",i.Qt="Visio_Consumption_CLTComplete",i.in="Visio_SwitchMode_FromViewFrame",i.en="Visio_ModeSwitch_ToHost_Ack",i.tn="Visio_UpdateEditUrl",i.nn="Visio_PageViewLoaded",i.on="Visio_ActiveAppFrameLoadFailed",i.rn="Visio_DisposeBkgFrame",i.sn="Visio_ReadyToReceiveDocData",i.an="Visio_DocReboot_HostNav",i.cn="Visio_SwitchToVisioFrame",i.un="WacAppPerfMetric",i.dn="App_ModifyURLState",i.ln="App_WacTokenAck",i.fn="App_InitEnd",i.hn="App_SplashScreenShown",i.pn="App_SetWacFlightValue"}(si||(si={}));var di,li=!0,fi=["https://augloop.office.com/v2","api://visio.officeapps.live.com/va/00695ed2-3202-4156-8da1-69f60065e255","394866fc-eedb-4f01-8536-3ff84b16be2a","https://officescripting.microsoft.com","https://officescripting-int.microsoft.com","https://nleditor.osi.office.net/nleditor","e03a13ee-9730-4cae-8525-47559c8cf18a","https://powerquery.microsoft.com","api://app.powerbi.com/00000009-0000-0000-c000-000000000000"],hi=function(){function i(i){var e=this;this.vn={},this.wn=[],this.mn=function(i){if(i&&i.origin)try{var t=i.data;if("string"==typeof t&&t.includes("AddinTrustedOrigin")){var r=JSON.parse(t),s=r.AddinTrustId;s&&"AddinTrustedOrigin"===r.MessageId&&(e.gn.ULS.Se(560754784,n.H,o.Info,"didReceiveMessage addinTrustId ".concat(s)),e.vn[s]=i.origin,e.wn.forEach((function(e){e(s,i.origin)})))}}catch(i){e.gn.ULS.Se(560754785,n.H,o.Error,"AuthTokenTrustValidator didReceiveMessage failed")}},this.gn=i,window.addEventListener("message",this.mn)}return i.prototype.isResourceTrustedForMessage=function(i){return A(this,void 0,void 0,(function(){var e,t,r,s,a,c,u,d,l=this;return _(this,(function(f){switch(f.label){case 0:return i&&i.Resource?(e=i.Resource,t=i.AddinTrustId,(r=function(i){if(!i)return!1;for(var e=i.toLowerCase(),t=0,n=fi;t<n.length;t++){var o=n[t];if(o===e||"".concat(o,"/")===e)return!0}return!1}(e))||!t?[2,r]:this.vn[t]?[2,pi(e,this.vn[t])]:(a=new Promise((function(i){s=function(n,o){t===n&&i(pi(e,o))},l.wn.push(s)})),c=-1,2e3,u=new Promise((function(i){c=window.setTimeout((function(){l.gn.ULS.Se(560754786,n.H,o.Warning,"isResourceTrustedForMessage - timeout waiting for addinTrustId: ".concat(t)),i(!1)}),2e3)})),[4,Promise.race([a,u])])):[2,!1];case 1:return d=f.sent(),this.wn=this.wn.filter((function(i){return i!==s})),window.clearTimeout(c),[2,d]}}))}))},i.prototype.dispose=function(){this.vn={},this.wn=[],window.removeEventListener("message",this.mn)},i}();function pi(i,e){try{if(!i||!e)return!1;for(var t=/[?&#%\\]/,n=0;n<i.length;n+=1){var o=i.charCodeAt(n);if(o<33||o>126)return!1;var r=i.charAt(n);if(t.test(r))return!1}var s=i;"api:"===s.substring(0,"api:".length).toLowerCase()&&(s="".concat("https:").concat(s.substring("api:".length)));var a=new URL(s);return"https:"===a.protocol&&e.toLowerCase()===a.origin.toLowerCase()}catch(i){return!1}}!function(i){i.AppInitError="AppInitError",i.ApiDisabledError="ApiDisabledError",i.CannotLoadFirstPage="CannotLoadFirstPage",i.InvalidWopiInfo="InvalidWopiInfo",i.TimeoutWacReady="TimeoutWacReady",i.WacFailed="WacFailed"}(di||(di={}));var vi,wi=function(){function i(){this.Sn=[]}return i.prototype.add=function(i){i&&this.Sn.push(i)},i.prototype.remove=function(i){if(i){var e=this.Sn.indexOf(i);e>-1&&this.Sn.splice(e,1)}},i.prototype.removeAll=function(){this.Sn=[]},i.prototype.dispatch=function(i,e){this.Sn.forEach((function(t){try{t(i)}catch(i){e&&e(i)}}))},i}(),mi=function(){function i(i,e){var t=this;this.bn=0,this.In=function(){try{if(!window||!window.localStorage)return;var i=window.localStorage.getItem(t.Tn);if(!i)return;var e=JSON.parse(i);t.yn(e)}catch(i){t.gn.ULS.Se(592836768,n.H,o.Warning,"Failed to get settings from localStorage: "+V(i))}},this.yn=function(i){return!!t.Cn(i)&&(t.An=i,t._n.dispatch({be:t},(function(i){t.gn.ULS.Se(592836769,n.H,o.Error,"Settings listener error: "+V(i))})),!0)},this.Cn=function(i){if(i&&"object"==typeof i){if(i.hasOwnProperty(H.Zi)&&!isNaN(i.timestamp))return!0;t.gn.ULS.Se(592836770,n.H,o.Error,"Received invalid settings")}return!1},this.Fn=function(){if(t.En){var i=new XMLHttpRequest;i.open("GET",t.En),i.responseType="json",i.timeout=5e3,i.send(),i.onload=function(){if(200===i.status&&i.response?(t.Vn(i.response),t.bn=0):(t.gn.ULS.Se(592836771,n.H,o.Error,"Fetch settings error. Status: ".concat(i.status,", curErrors: ").concat(t.bn)),t.bn+=1),!(t.bn>7)){var e=t.getValue(H.$i,3e5);t.bn>3&&(e+=(t.bn-3+1)*(e/2)),t.Rn=window.setTimeout(t.Fn,e)}}}},this.Vn=function(i){"requestIdleCallback"in window?(t.Pn&&self.cancelIdleCallback(t.Pn),t.Pn=window.requestIdleCallback((function(){return t.On(i)}),{timeout:1e4})):window.setTimeout((function(){return t.On(i)}),0)},this.On=function(i){if(t.yn(i)&&window&&window.localStorage){var e=JSON.stringify(i);try{window.localStorage.setItem(t.Tn,e)}catch(i){t.gn.ULS.Se(592836800,n.H,o.Warning,"Failed to set localStorage: "+V(i))}}},this.xn=i,this.Tn="Prod"+i+"Settings",this.gn=e,this._n=new wi,this.In()}return i.prototype.updateEnvironment=function(i){this.Tn=(s(i)?"FF":"Prod")+this.xn+"Settings",this.In()},i.prototype.initializePeriodicFetch=function(i,e){this.Tn=(s(i)?"FF":"Prod")+this.xn+"Settings",this.In(),this.En=i+"AppSettingsHandler.ashx?app="+this.xn+"&usid="+e+"&build="+T(),this.Rn||(this.Rn=window.setTimeout(this.Fn,3e4))},i.prototype.getValue=function(i,e){if(this.An||this.In(),!this.An||!this.An.hasOwnProperty(i))return e;var t=this.An[i],n=typeof e;if(typeof t===n)return t;if("string"==typeof t){if("number"===n)return parseInt(t,10);if("boolean"===n)return"true"===t}return e},i.prototype.addSettingsChangeListener=function(i){this._n.add(i)},i.prototype.removeSettingsChangeListener=function(i){this._n.remove(i)},i.prototype.dispose=function(){this.Rn&&window.clearTimeout(this.Rn),this.Pn&&self.cancelIdleCallback(this.Pn),this.Rn=void 0,this.Pn=void 0,this.An=void 0,this._n.removeAll()},i}();function gi(i,e){return{isFeatureEnabled:function(t){return function(i,e,t){if(!e)return;try{return e(i)}catch(i){t&&t.ULS.Se(594883024,n.H,o.Error,"IsFeatureEnabled callback error: "+V(i))}return}(t,i,e)}}}function Si(i,e){var t={};if(Object.keys(vi).forEach((function(e){var n=i.isFeatureEnabled(vi[e]);void 0!==n&&(t[vi[e]]=n?"1":"0")})),e&&e.wdFlights)for(var n=0,o=e.wdFlights.toLowerCase().split(",");n<o.length;n++){var r=o[n];"et-treatment"!==r&&"et-control"!==r||(t[vi.kn]="et-treatment"===r?"1":"0")}return JSON.stringify(t)}!function(i){i.kn="EnterpriseTemplates",i.Wn="ExcelAdaptiveLayoutDownload",i.Un="ExcelLandingPageOfflineTelemetry",i.Dn="ExcelLandingPageObserverRetry",i.Nn="H2StaticContent",i.Bn="HashedUrl",i.Mn="ODCShareLinkPreload",i.Hn="OfficeComExcelJsApiV2",i.Ln="OfficeComPptJsApiV2",i.Jn="OfficeComUiHost",i.jn="OfficeComWordJsApiV2",i.Gn="OfficeHwaUiHost",i.zn="OfficeUnifiedUiHostTeams",i.qn="WordViewToUnifiedRead",i.Kn="PowerPointEarlySessionStart"}(vi||(vi={}));var bi=function(){function i(i,e){this.Xn=function(){return Ii(i,"OnBeforeUnload",e)},this.$n=function(){return Ii(i,"OnPageHide",e)},this.Zn=function(){return Ii(i,"VisibilityChange_"+document.visibilityState,e)},this.Yn=function(){return Ii(i,"OnUnload",e)},window.addEventListener("beforeunload",this.Xn,{capture:!0,once:!0}),window.addEventListener("pagehide",this.$n,{capture:!0}),window.addEventListener("visibilitychange",this.Zn,{capture:!0}),window.addEventListener("unload",this.Yn,{capture:!0,once:!0})}return i.prototype.dispose=function(){window.removeEventListener("beforeunload",this.Xn,{capture:!0}),window.removeEventListener("pagehide",this.$n,{capture:!0}),window.removeEventListener("visibilitychange",this.Zn,{capture:!0}),window.removeEventListener("unload",this.Yn,{capture:!0})},i}();function Ii(i,e,t){i.ULS.Se(595957843,n.H,o.Info,"Page lifecycle: ".concat(e," fired")+(t?", flushing logger":"")),t&&i.ULS.flush()}var Ti,yi;function Ci(i,e){return i+"RemoteTelemetry.ashx"+(e?"?usid="+e:"")}function Ai(i,e){return Ci(_i(i),e)}function _i(i){var e=i.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!e)throw new Error("Invalid URL");return e[1]}!function(i){i.blurFocus="blurFocus",i.boot="boot",i.completeCreateNew="completeCreateNew",i.continueAccessibilityLoop="continueAccessibilityLoop",i.createNew="createNew",i.dispose="dispose",i.grabFocus="grabFocus",i.moveToFolder="moveToFolder",i.popState="popState",i.sendChannelId="sendChannelId",i.sendConvId="sendConvId",i.teamsUsersReply="teamsUsersReply",i.teamsUserMentionReply="teamsUserMentionReply",i.backButtonPressed="backButtonPressed",i.getClientUrl="getClientUrl",i.getWebUrl="getWebUrl",i.sendOwlFrameDiagnostics="sendOwlFrameDiagnostics",i.rename="rename",i.completeSharedFilePicker="completeSharedFilePicker",i.sendAccessToken="sendAccessToken",i.sendAuthToken="sendAuthToken",i.sendCustomAuthConfig="sendCustomAuthConfig",i.sendEmbeddedViewUrl="sendEmbeddedViewUrl",i.sendFrameTrustResult="sendFrameTrustResult",i.sendHWRTelemetry="sendHWRTelemetry",i.sendSessionInfo="sendSessionInfo",i.sendUserAccessAndPermissions="sendUserAccessAndPermissions",i.sendWopiInfo="sendWopiInfo",i.sendDavUrl="sendDavUrl",i.switchMode="switchMode",i.signalShared="signalShared",i.postWacToken="postWacToken"}(Ti||(Ti={})),function(i){i.Qn="Ack",i.io="WacInitialize_Ready_Ack",i.eo="Wac_BeforeUnloadApp",i.to="Blur_Focus",i.no="Wac_AppFailed_Ack",i.oo="Wac_AppCompleted_Ack",i.ro="WopiStartSession_Complete",i.so="WopiPendingSession_Complete",i.ao="Host_AccessibilityLoopComplete",i.Je="Host_IsFrameTrusted",i.co="Grab_Focus",i.uo="HostCacheDiagnostic",i.do="Host_KeyValue",i.lo="JsApiDiagnostics",i.Ye="Host_MoveToFolder",i.fo="PageChanged_Ack",i.ho="App_PopState",i.po="Host_SendChannelId",i.vo="Host_SendConversationId",i.wo="GetTeamsUsers_Reply",i.mo="SendTeamsUserMention_Reply",i.So="Host_BackButtonPressed",i.bo="Host_GetClientUrl",i.Io="Host_GetWebUrl",i.To="OwlFrameDiagnostics",i.yo="File_Rename",i.lt="Host_FilePicker",i.Co="PostAccessToken",i.Ao="Host_SetAuthToken",i._o="Host_SetCustomAuthConfig",i.Fo="App_PushCommentContext",i.Eo="CanEmbed",i.Vo="Host_RefreshSessionInfo",i.Ro="CheckUserAccessAndGrantPermissions_Result",i.Po="Host_WopiInfoFromUrl",i.Oo="Host_DavUrlFromIds",i.xo="SetCurrentPage",i.ko="SetZoomLevel",i.Wo="WopiPendingSession_Fail",i.Uo="SetOverlayContent",i.Do="WopiPendingApplicationComplete_Received",i.No="Host_SwitchMode",i.Bo="Host_Unload",i.Mo="PageCount_Ack",i.Ho="ZoomChanged_Ack",i.Lo="Host_ShareUI",i.Jo="Host_Telemetry",i.jo="Visio_ConsumptionCLTComplete_Ack",i.Go="Visio_SwitchMode_FromHF_Ack",i.zo="Visio_SwitchMode_FromHostFrame",i.qo="Visio_FallbackToLegacySwitch",i.Ko="Visio_DocumentData",i.Xo="Host_PostWacToken"}(yi||(yi={}));var Fi,Ei;function Vi(i){if(!i)return"";var e=""+document.cookie,t=new RegExp("(?:^|; )"+i+"=([^;]*)"),n=e.match(t);return!n||n.length<2?"":n[1]}function Ri(i,e,t,n,o){void 0===n&&(n=Fi.none);var r=i+"="+e,s="",a=new Date;a.setTime(a.getTime()+31536e6);var c=new Date;c.setTime(c.getTime()+864e5*t),c>a&&(c=a),c&&(s=";expires="+c.toUTCString());var u=r+s+(";SameSite="+Fi[n]);return document.cookie=o?u+"; Secure":u,!(!document.cookie||-1===document.cookie.indexOf(r))||n===Fi.none&&Ri(i,e,t,Fi.doNotSet,o)}!function(i){i[i.doNotSet=0]="doNotSet",i[i.none=1]="none",i[i.lax=2]="lax",i[i.strict=3]="strict"}(Fi||(Fi={}));var Pi=((Ei={})[Ti.blurFocus]=yi.to,Ei[Ti.continueAccessibilityLoop]=yi.ao,Ei[Ti.grabFocus]=yi.co,Ei[Ti.moveToFolder]=yi.Ye,Ei[Ti.popState]=yi.ho,Ei[Ti.rename]=yi.yo,Ei[Ti.sendAccessToken]=yi.Co,Ei[Ti.sendAuthToken]=yi.Ao,Ei[Ti.sendCustomAuthConfig]=yi._o,Ei[Ti.sendEmbeddedViewUrl]=yi.Eo,Ei[Ti.sendSessionInfo]=yi.Vo,Ei[Ti.sendUserAccessAndPermissions]=yi.Ro,Ei[Ti.sendWopiInfo]=yi.Po,Ei[Ti.sendDavUrl]=yi.Oo,Ei[Ti.completeSharedFilePicker]=yi.lt,Ei[Ti.switchMode]=yi.No,Ei[Ti.signalShared]=yi.Lo,Ei),Oi=function(){function i(i,e){var t,r,c=this;if(this.$o=!1,this.Zo={},this.Yo="",this.Qo="",this.ir=[],this.er=!1,this.tr=!1,this.nr=!1,this.or=!1,this.rr=[],this.sr=!0,this.ar=function(i,e,t){if(i){var r={MessageId:yi.Qn,CorrelationId:t,SendTime:W()};c.gn.ULS.Se(595732176,n.H,o.Info,"Sending Ack back"),i.postMessage(JSON.stringify(r),e)}else c.gn.ULS.Se(595736136,n.H,o.Info,"Missing target to send Ack back")},this.cr=function(i){var e,t=!1,r=!0,s="",a=!1;if(c.ur&&c.ur.contentWindow&&(t=!0,r=i.source===c.ur.contentWindow),i.origin&&(a=(s=d(i.origin,2).toLowerCase())===c.Qo||c.ir.includes(s)),!c.tr&&(!c.nr||a&&r)||c.gn.ULS.Se(595730526,n.H,o.Info,"Window is available: ".concat(t,", window is valid: ").concat(r,", origin is valid: ").concat(a,", expected origin: ").concat(c.Qo,", actual origin: ").concat(s)),a&&(!c.er||r)){var u;try{u=JSON.parse(i.data)}catch(i){return void c.gn.ULS.Se(596464282,n.H,o.Info,"Failed to parse event data: ".concat(V(i),"."))}var l=u.MessageId;if(l){if(c.gn.ULS.Se(595714715,n.H,o.Info,"Received messageId: ".concat(l,", correlation: ").concat(u.CorrelationId)),l!==si._e&&l!==si.$e||c.dr(i.origin),c.or&&l===si.un)return window._pageTimings=null!==(e=window._pageTimings)&&void 0!==e?e:{},void(window._pageTimings[u.Values.name]=u.Values.time);u.Values&&u.Values.ackExpected&&c.ar(i.source,i.origin,u.CorrelationId);var f=c.Zo[l];if(!f)return c.gn.ULS.Se(596464289,n.H,o.Info,"No handler found for message id: ".concat(l)),void(c.sr&&l===si.Ge&&(c.rr.push(u),c.gn.ULS.Se(543207888,n.H,o.Info,"Kept for later process: ".concat(l))));c.gn.ULS.Se(596464288,n.H,o.Info,"Processing message: ".concat(l)),l===si.vt&&(u.Values=C(C({},u.Values||{}),{sendTimeAsClickTime:u.SendTime}));try{f(u.Values||{})}catch(i){c.gn.ULS.Se(593773704,n.H,o.Error,"Handler error: ".concat(V(i)))}c.sr&&l===si._e&&c.lr()}else(c.tr||c.nr)&&c.gn.ULS.Se(595730520,n.H,o.Info,"Could not find message id")}},this.lr=function(){c.sr=!1,c.rr.forEach((function(i){var e=i.MessageId,t=c.Zo[e];if(t){c.gn.ULS.Se(543207890,n.H,o.Info,"Processing message after boot complete: ".concat(e));try{t(i.Values||{})}catch(i){c.gn.ULS.Se(543207891,n.H,o.Error,"Handler error: ".concat(V(i)))}}else c.gn.ULS.Se(543207889,n.H,o.Info,"No handler found after boot complete: ".concat(e))})),c.rr=[]},this.hr=function(i,e,t){i.postMessage(e,t)},this.dr=function(i){var e=i.toLowerCase();c.Yo&&c.Yo!==e&&c.gn.ULS.Se(596128131,n.H,o.Warning,"Updating origin: [".concat(b(c.Yo),"]->[").concat(b(e),"]")),c.Yo=e,c.Qo=d(e,2),c.ir=["www.onenote.com","www.onenote.partner.office365.cn","www.onenote.gcc.osi.office365.us","www.onenote.osi.office365.us","www.onenote.osi.apps.mil","www.onenote.osi.eaglex.ic.gov","www.onenote.osi.microsoft.scloud"],c.tr=s(e),c.nr=a(e)},!i)throw new Error("Missing origin for PostMessageHandler");this.tr=s(i),this.nr=a(i),this.gn=e,this.dr(i),this.or=!!(null===(r=null===(t=window.location)||void 0===t?void 0:t.search)||void 0===r?void 0:r.match(/wdpa=1/gi))||"1"===Vi("EnableMetricLogging")}return i.prototype.registerMessagePayloadHandler=function(i,e){if(this.Zo[i])throw new Error("Duplicate registration!");this.Zo[i]=e},i.prototype.removeMessageHandler=function(i){delete this.Zo[i]},i.prototype.sendPostMessage=function(i,e,t){if(i&&i.contentWindow){this.gn.ULS.Se(596464334,n.H,o.Info,"Sending message: "+e);var r={MessageId:e,SendTime:W(),Values:t};this.hr(i.contentWindow,JSON.stringify(r),this.Yo)}else this.gn.ULS.Se(595948308,n.H,o.Info,"Missing target for SendPostMessage")},i.prototype.activate=function(i,e){this.ur=i,this.er=!!e,this.$o||(window.addEventListener("message",this.cr,!1),this.$o=!0)},i.prototype.postMessageForCommand=function(i,e,t){var r=Pi[e];r?(this.gn.ULS.Se(595702598,n.H,o.Info,"Sending message ".concat(r," for command ").concat(e)),this.sendPostMessage(i,r,t)):this.gn.ULS.Se(595702599,n.H,o.Warning,"No mapping for command ".concat(e))},i.prototype.dispose=function(){this.Zo={},this.$o&&(window.removeEventListener("message",this.cr,!1),this.$o=!1)},i}();function xi(i,e,t,r,s,a){var c=W();r.ULS.Se(507774684,n.H,o.Important,"postWacToken flow initiated");var u=function(){a&&a.flush&&a.flush()};s?s.then((function(s){var d=function(){return t.sendPostMessage(s,yi.Xo,{wacToken:i,postWacTokenStart:e})};d();var l=window.setInterval(d,100);t.registerMessagePayloadHandler(si.ln,(function(i){r.ULS.Se(507597019,n.H,o.Info,"postWacToken flow completed in ".concat(W()-c," ms")),window.clearInterval(l),window.clearTimeout(f),a&&(a.PostWacTokenResult="success",a.PostWacTokenEndTime=W(),i&&void 0!==i.TokenAlreadySet&&(a.TokenAlreadySet=i.TokenAlreadySet),u())}));var f=window.setTimeout((function(){r.ULS.Se(507597018,n.H,o.Warning,"postWacToken flow timed out after ".concat(6e4," ms")),window.clearInterval(l),a&&(a.PostWacTokenResult="timeout",a.PostWacTokenEndTime=W(),u())}),6e4)})).catch((function(i){r.ULS.Se(507873094,n.H,o.Warning,"This should never reject, error: ".concat(V(i))),a&&(a.PostWacTokenResult="Unexpected JSAPI V1 error",a.PostWacTokenEndTime=W(),u())})):(r.ULS.Se(507846862,n.H,o.Warning,"`Promise` does not exist natively for this browser."),a&&(a.PostWacTokenResult="JSAPI V1 error: Promise not supported in browser",a.PostWacTokenEndTime=W(),u()))}var ki,Wi,Ui,Di,Ni=function(){function i(){}return i.sendXmlHttpRequest=function(i,e,t,r,s,a,c,u){if(void 0===u&&(u=!1),!i)throw new TypeError("method");if(!e)throw new TypeError("requestUrl");var d=W();if("GET"!==i)throw Error("Not Implemented");var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4===l.readyState)if(200===l.status){var i=W()-d;c.ULS.Se(595985034,n.X,o.Info,"Success: ".concat(a,", time spent in getting XHR response: ").concat(i,"(ms)")),r&&r(l.responseText)}else c.ULS.Se(595985035,n.X,o.Error,"Failed request: ".concat(a," with status code: ").concat(l.status.toString())),s&&s();u&&2===l.readyState&&l.abort()},l.open(i,e,t),l.send()},i}(),Bi=function(){function i(){}return i.HeaderHeight=50,i.ToolbarHeightConsumption=40,i.ToolbarLowerHeightEdit=46,i.ToolbarUpperHeightEdit=26,i.StatusbarHeight=50,i.StatusbarBorderTop=1,i.ProgressImageHeight=4,i.FishbowlBorderTop=1,i.FishbowlMarginInches=.4,i.RibbonHeightConsumption=i.HeaderHeight+i.ToolbarHeightConsumption,i.RibbonHeightEdit=i.HeaderHeight+i.ToolbarLowerHeightEdit+i.ToolbarUpperHeightEdit,i.RibbonHeightNoChrome=i.ToolbarLowerHeightEdit+i.ToolbarUpperHeightEdit,i.ShapePanelBorderWidth=1,i.ShapePanelWidthWithoutBorder=312,i.ShapePanelWidthWithBorder=i.ShapePanelWidthWithoutBorder+2*i.ShapePanelBorderWidth,i}(),Mi=function(){function i(){}return i.FastViewImage="fpd.png",i.FastViewJson="fv.json",i.docInfoNormal="di2.json",i.docInfoHighDpi="di4.json",i}();!function(i){i[i.INVALID=0]="INVALID",i[i.VIEW=1]="VIEW",i[i.EMBED_VIEW=2]="EMBED_VIEW",i[i.INTERACTIVE_PREVIEW=3]="INTERACTIVE_PREVIEW",i[i.EDIT=4]="EDIT",i[i.EDIT_NEW=5]="EDIT_NEW"}(ki||(ki={})),function(i){i.BOOTSTART="BOOTSTART",i.BACKGROUND_MODESWITCH_BOOTSTART="BACKGROUND_MODESWITCH_BOOTSTART",i.BOOTSUCCESS="BOOTSUCCESS",i.BOOTFAILED="BOOTFAILED",i.BOOTEXCEPTION="BOOTEXCEPTION",i.BOOTTIMEOUT="BOOTTIMEOUT"}(Wi||(Wi={})),function(i){i.JSAPIV2="JSAPIV2"}(Ui||(Ui={})),function(i){i[i.Fastfood=0]="Fastfood",i[i.MSITandFastfood=1]="MSITandFastfood",i[i.AllRings=2]="AllRings",i[i.None=3]="None"}(Di||(Di={}));var Hi=function(){function i(){}return i.initialize=function(e,t){i.pr=e,i.gn=t,void 0===i.pr&&i.gn&&i.gn.ULS.Se(592975122,n.X,o.Warning,"Environment is undefined")},i.getIntegerBRSValue=function(e,t){var n=i.vr[e];return n&&!isNaN(parseInt(n,10))?parseInt(n,10):window.localStorage&&(n=localStorage.getItem(e))&&!isNaN(parseInt(n,10))?(i.vr[e]=n,parseInt(n,10)):t},i.getBRSValue=function(e,t){void 0===t&&(t=!1);try{var r=i.vr[e];if(r)return"true"===r.toLowerCase();if(!window.localStorage)return!1;var s=localStorage.getItem(e);if(s)return i.vr[e]=s,t&&localStorage.removeItem(e),"true"===s.toLowerCase();if(s="false",i.wr.has(e))switch(i.wr.get(e)){case Di.Fastfood:this.pr===Ne.Fastfood&&(s="true");break;case Di.MSITandFastfood:this.pr!==Ne.Fastfood&&this.pr!==Ne.MSIT||(s="true");break;case Di.AllRings:s="true";break;default:s="false",i.gn&&i.gn.ULS.Se(592975123,n.X,o.Warning,e+" set to false due EnabledEnvironment=None")}return i.vr[e]=s,"true"===s.toLowerCase()}catch(i){return!1}},i.dispose=function(){i.vr={}},i.fromWacVisioFrameBRS="Visio_BRS",i.instantCreateNewLocalStorageKey="BRS_IsInstantCreateNewEnabled",i.backgroundEditSessionEnabledKey="BRS_IsUnifiedBackgroundEditAppEnabled",i.hostCacheForEmbedViewEnabledBRSKey="BRS_HostCacheForEmbedViewEnabled",i.InstantForAllTemplatesEnabledBRSKey="BRS_InstantForAllTemplatesEnabled",i.AppShellPrebootEnabledBRSKey="BRS_AppShellPrebootEnabled",i.FastViewForMRUFixEnabledBRSKey="BRS_FastViewForMRUFixEnabled",i.ReloadOnScriptFailMaxLimitBRSKey="BRS_ReloadOnScriptFailMaxLimit",i.CoCommentingAcrossViewAndEditEnabled="BRS_CoCommentingAcrossViewAndEditEnabled",i.WOPITokenRefreshIsEnabledForViewer="BRS_WOPITokenRefreshIsEnabledForViewer",i.IsToastUserFixEnabledBRSKey="BRS_IsToastUserFixEnabled",i.IsContextAppRefreshFixEnabledBRSKey="BRS_IsContextAppRefreshFixEnabled",i.IsAtMentionsEnabled="BRS_IsAtMentionsEnabled",i.IsFormulaeSerializationRollbackEnabled="BRS_IsFormulaeSerializationRollbackEnabled",i.IsFastViewCacheInTeamsDisabled="BRS_IsFastViewCacheInTeamsDisabled",i.IsSaveAndCloseRequestInvokedInTeamsEnabled="BRS_IsSaveAndCloseRequestInvokedInTeamsEnabled",i.IsTeamsBackgroundFrameFixEnabled="BRS_IsTeamsBackgroundFrameFixEnabled",i.TypeScriptLocalStorageEnabled="BRS_TypeScriptLocalStorageEnabled",i.JsapiV1DiagnosticFixEnabled="BRS_JsapiV1DiagnosticFixEnabled",i.DTEEnabledBRSKey="BRS_DTEEnabled",i.DTEEnabledForPlan0BRSKey="BRS_DTEEnabledForPlan0",i.DTESharingFixEnabledBRSKey="BRS_DTESharingFixEnabled",i.DTESafariFixEnabledBRSKey="BRS_DTESafariFixEnabled",i.IsLongPoleInfraEnabled="BRS_IsLongPoleInfraEnabled",i.Fluent2StyleIsEnabled="BRS_Fluent2StyleIsEnabled",i.VisioWebVsdEditEnabled="BRS_VisioWebVsdEditEnabled",i.IsInfiniteCanvasEnabled="BRS_IsInfiniteCanvasEnabled",i.pr=void 0,i.gn=void 0,i.vr={},i.wr=new Map([[i.instantCreateNewLocalStorageKey,Di.AllRings],[i.backgroundEditSessionEnabledKey,Di.AllRings],[i.InstantForAllTemplatesEnabledBRSKey,Di.Fastfood],[i.IsToastUserFixEnabledBRSKey,Di.AllRings],[i.IsContextAppRefreshFixEnabledBRSKey,Di.Fastfood],[i.IsAtMentionsEnabled,Di.AllRings],[i.JsapiV1DiagnosticFixEnabled,Di.AllRings],[i.Fluent2StyleIsEnabled,Di.Fastfood]]),i.handleVisioBRS=function(e,t){if(window.localStorage&&e){var r=!!e.IsInstantCreateNewEnabled;localStorage.setItem(i.instantCreateNewLocalStorageKey,r.toString());var s=!!e.IsUnifiedBackgroundEditAppEnabled;localStorage.setItem(i.backgroundEditSessionEnabledKey,s.toString());var a=!!e.IsToastUserFixEnabled;localStorage.setItem(i.IsToastUserFixEnabledBRSKey,a.toString());var c=!!e.IsContextAppRefreshFixEnabled;localStorage.setItem(i.IsContextAppRefreshFixEnabledBRSKey,c.toString());var u=!!e.HostCacheForEmbedViewEnabled;localStorage.setItem(i.hostCacheForEmbedViewEnabledBRSKey,u.toString());var d=!!e.InstantForAllTemplatesEnabled;localStorage.setItem(i.InstantForAllTemplatesEnabledBRSKey,d.toString());var l=!!e.AppShellPrebootEnabled;localStorage.setItem(i.AppShellPrebootEnabledBRSKey,l.toString());var f=e.VisioReloadOnScriptFailMaxLimit?e.VisioReloadOnScriptFailMaxLimit:0;localStorage.setItem(i.ReloadOnScriptFailMaxLimitBRSKey,f.toString());var h=!!e.CoCommentingAcrossViewAndEditEnabled;localStorage.setItem(i.CoCommentingAcrossViewAndEditEnabled,h.toString());var p=!!e.DTEEnabled;localStorage.setItem(i.DTEEnabledBRSKey,p.toString());var v=!!e.DTEEnabledForPlan0;localStorage.setItem(i.DTEEnabledForPlan0BRSKey,v.toString());var w=!!e.DTESafariFixEnabled;localStorage.setItem(i.DTESafariFixEnabledBRSKey,w.toString());var m=!!e.DTESharingFixEnabled;localStorage.setItem(i.DTESharingFixEnabledBRSKey,m.toString());var g=!!e.WOPITokenRefreshIsEnabledForViewer;localStorage.setItem(i.WOPITokenRefreshIsEnabledForViewer,g.toString());var S=!!e.IsAtMentionsEnabled;localStorage.setItem(i.IsAtMentionsEnabled,S.toString());var b=!!e.IsFastViewCacheInTeamsDisabled;localStorage.setItem(i.IsFastViewCacheInTeamsDisabled,b.toString());var I=!!e.IsSaveAndCloseRequestInvokedInTeamsEnabled;localStorage.setItem(i.IsSaveAndCloseRequestInvokedInTeamsEnabled,I.toString());var T=!!e.IsTeamsBackgroundFrameFixEnabled;localStorage.setItem(i.IsTeamsBackgroundFrameFixEnabled,T.toString());var y=!!e.IsFormulaeSerializationRollbackEnabled;localStorage.setItem(i.IsFormulaeSerializationRollbackEnabled,y.toString());var C=!!e.TypeScriptLocalStorageEnabled;localStorage.setItem(i.TypeScriptLocalStorageEnabled,C.toString());var A=!!e.JsapiV1DiagnosticFixEnabled;localStorage.setItem(i.JsapiV1DiagnosticFixEnabled,A.toString());var _=!!e.IsLongPoleInfraEnabled;localStorage.setItem(i.IsLongPoleInfraEnabled,_.toString());var F=!!e.Fluent2StyleIsEnabled;localStorage.setItem(i.Fluent2StyleIsEnabled,F.toString());var E=!!e.VisioWebVsdEditEnabled;localStorage.setItem(i.VisioWebVsdEditEnabled,E.toString());var V=!!e.IsInfiniteCanvasEnabled;localStorage.setItem(i.IsInfiniteCanvasEnabled,V.toString()),t.ULS.Se(595691654,n.X,o.Info,"Received BRS settings from visio frame and storing it in local storage. BRS values:".concat(e))}else t.ULS.Se(595691671,n.X,o.Info,"Received BRS settings from visio frame but local storage is not supported or values are null.")},i}();function Li(i){var e=i.toLocaleLowerCase();return e.indexOf("visioview=consumptionview&embed=1")>=0?ki.EMBED_VIEW:e.indexOf("visioview=consumptionview&interactivepreview=1")>=0?ki.INTERACTIVE_PREVIEW:e.indexOf("visioview=consumptionview")>=0?ki.VIEW:e.indexOf("visioview=editview&new=1")>=0?ki.EDIT_NEW:e.indexOf("visioview=editview")>=0?ki.EDIT:ki.INVALID}function Ji(i){return g(i,"backgroundsession","1")}function ji(i){return i.toLocaleLowerCase().indexOf("embed=1")>=0}function Gi(i){return i.toLocaleLowerCase().indexOf("interactivepreview=1")>=0}function zi(i){return Hi.getBRSValue(Hi.IsInfiniteCanvasEnabled)&&(i===ki.EDIT||i===ki.EDIT_NEW)}function qi(i){i&&history.replaceState({},"",i)}function Ki(i,e){return!!(i.sessionInformation&&i.sessionInformation.WdParams&&i.sessionInformation.WdParams[e])}function Xi(i,e){return i.sessionInformation&&i.sessionInformation.WdParams&&i.sessionInformation.WdParams[e]?i.sessionInformation.WdParams[e]:null}function $i(i,e,t){var n=document.createElement("canvas");if(!n.getContext||!n.getContext("2d"))return"";n.width=e,n.height=t;var o=n.getContext("2d");return null==o?"":(o.drawImage(i,0,0),n.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,""))}function Zi(){return performance.timing?performance.timing.navigationStart:0}function Yi(){return performance.navigation?performance.navigation.redirectCount:0}function Qi(){var i=window.location.href;i=w(i,"wdreloadsessionid"),i=w(i,"wdreloadcount"),Hi.getBRSValue(Hi.WOPITokenRefreshIsEnabledForViewer)&&i&&(i=w(i,"wdToastUser")),Hi.getBRSValue(Hi.DTEEnabledBRSKey)&&i&&(i=w(i,"wdToastForUnsupported"),i=w(i,"wdPreviousSessionDct")),Hi.getBRSValue(Hi.VisioWebVsdEditEnabled)&&(i=w(i,"wdvsdedit")),qi(i)}var ie,ee=function(){function i(e,t,n,o){this.mr="AES-GCM",this.gr=256,this.Sr=12,this.br=null,this.Ir=i.Tr+e,this.yr=t,this.Cr=n,this.gn=o,this.loadCache()}return i.Create=function(e,t,n,o){if(i.Ar(e,t,n)){var r=e+"_"+t,s=i.getHashCode(t),a=i.getHashCode(n);i._r=new i(s,a,r,o)}return i._r},i.dispose=function(){i._r=null},i.prototype.SaveDocument=function(i,e){var t=this;try{if(!e||e.length<=0||!i||i.length<=0)return this.gn.ULS.Se(595903506,n.X,o.Warning,"Unexpected data provided to save document in cache. Removing the item."),void localStorage.removeItem(this.Ir);var r=W(),s={ImageData:e,DocView:i,DocVersion:this.yr},a=JSON.stringify(s);this.encrypt(a,this.Cr,this.mr,this.gr,this.Sr).then((function(i){try{i.DocVersion=t.yr,i.LastAccessTime=W(),localStorage.setItem(t.Ir,JSON.stringify(i));var e=W();t.gn.ULS.Se(595903646,n.X,o.Info,"[VO_Perf] Save Document Cache Time Taken: ".concat(e-r))}catch(i){t.gn.ULS.Se(595910981,n.X,o.Warning,"Failure trying to save data in localStorage: ".concat(V(i)))}}),(function(i){t.gn.ULS.Se(595907478,n.X,o.Warning,"Failure to encrypt: ".concat(V(i)))}))}catch(i){this.gn.ULS.Se(595907479,n.X,o.Warning,"Failure to SaveDocument: ".concat(V(i)))}},i.prototype.DeleteDocument=function(){try{localStorage.removeItem(this.Ir)}catch(i){this.gn.ULS.Se(595904288,n.X,o.Warning,"Failure to DeleteDocument: ".concat(V(i)))}},i.prototype.IsCacheAvailable=function(){return null!=this.br},i.EvictStaleCache=function(i,e,t){try{if(!window.localStorage)return void t.ULS.Se(595903507,n.X,o.Info,"localStorage is not supported by Browser. Skipping Eviction.");for(var r=W(),s=[],a=0;a<localStorage.length;a+=1){var c=localStorage.key(a);if(c.substring(0,this.Tr.length)===this.Tr){var u=localStorage.getItem(c);if(u){var d=JSON.parse(u);if(d){var l=d.LastAccessTime;l?s.push({key:c,lastAccessTime:l,data:u}):localStorage.removeItem(c)}else localStorage.removeItem(c)}else localStorage.removeItem(c)}}s.sort((function(i,e){return e.lastAccessTime-i.lastAccessTime}));var f=[],h=0,p=0;for(a=0;a<s.length;a+=1)(h+=2*s[a].data.length)>i&&W()-s[a].lastAccessTime>e?(localStorage.removeItem(s[a].key),p+=1,h-=2*s[a].data.length):f.push(s[a]);f.sort((function(i,e){return i.lastAccessTime-e.lastAccessTime})),h=0;var v=0;for(a=0;a<f.length;a+=1)(h+=2*f[a].data.length)>i&&(localStorage.removeItem(f[a].key),v+=1,h-=2*f[a].data.length);var w=W();t.ULS.Se(595903508,n.X,o.Info,"[VO_Perf] Evict Stale Cache Time Taken: ".concat(w-r,", Ist iteration evicted items: ").concat(p,", 2nd iteration evicted items: ").concat(v))}catch(i){t.ULS.Se(595904090,n.X,o.Warning,"Failure to Evict Stale Cache: ".concat(V(i)))}},i.prototype.GetDocVersion=function(){return this.IsCacheAvailable()?this.yr:""},i.prototype.DecryptAndValidate=function(i,e){var t=this;try{var r=W();this.decrypt(this.br,this.Cr,this.mr,this.gr).then((function(s){try{var a;a=JSON.parse(s);var c=W();t.gn.ULS.Se(595903648,n.X,o.Info,"[VO_Perf] Decrypt and validate cache Time Taken: ".concat(c-r)),a.DocVersion===t.yr?i(a.DocView,a.ImageData):(t.gn.ULS.Se(595907480,n.X,o.Warning,"Document version unexpected mismatch."),e())}catch(i){t.gn.ULS.Se(595907481,n.X,o.Warning,"Failure to deserialize the decrypted text: ".concat(V(i))),e()}}),(function(i){t.gn.ULS.Se(595907482,n.X,o.Warning,"Failure to decrypt: ".concat(V(i))),e()}))}catch(i){this.gn.ULS.Se(595907483,n.X,o.Warning,"Failure to DecryptAndValidate: ".concat(V(i))),e()}},i.prototype.loadCache=function(){try{var i=localStorage.getItem(this.Ir);if(i){var e;(e=JSON.parse(i)).DocVersion===this.yr&&(this.br=e)}}catch(i){this.gn.ULS.Se(595910982,n.X,o.Warning,"Failure trying to load data from localStorage: ".concat(i))}},i.prototype.encode64=function(i){return btoa(new Uint8Array(i).reduce((function(i,e){return i+String.fromCharCode(e)}),""))},i.prototype.decode64=function(i){for(var e=window.atob(i),t=e.length,n=new Uint8Array(new ArrayBuffer(t)),o=0;o<t;o+=1)n[o]=e.charCodeAt(o);return n},i.prototype.genEncryptionKey=function(i,e,t){return A(this,void 0,void 0,(function(){var n,o,r,s;return _(this,(function(a){switch(a.label){case 0:return n={name:"PBKDF2",hash:"SHA-256",salt:(new TextEncoder).encode("VisioBrowserCacheSalt"),iterations:1e3},o={name:e,length:t},r=(new TextEncoder).encode(i),[4,crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveKey"])];case 1:return s=a.sent(),[2,crypto.subtle.deriveKey(n,s,o,!1,["encrypt","decrypt"])]}}))}))},i.prototype.encrypt=function(i,e,t,n,o){return A(this,void 0,void 0,(function(){var r,s,a,c;return _(this,(function(u){switch(u.label){case 0:return r={name:t,length:n,iv:crypto.getRandomValues(new Uint8Array(o))},[4,this.genEncryptionKey(e,t,n)];case 1:return s=u.sent(),c={},a=this.encode64,[4,crypto.subtle.encrypt(r,s,(new TextEncoder).encode(i))];case 2:return c.DocumentData=a.apply(this,[u.sent()]),c.DocVersion=void 0,c.DataHash=void 0,c.IV=r.iv,c.LastAccessTime=void 0,[2,c]}}))}))},i.prototype.decrypt=function(i,e,t,n){return A(this,void 0,void 0,(function(){var o,r,s,a;return _(this,(function(c){switch(c.label){case 0:for(o={name:t,length:n,iv:new Uint8Array(this.Sr)},r=0;r<this.Sr;r+=1)o.iv[r]=i.IV[r];return[4,this.genEncryptionKey(e,t,n)];case 1:return s=c.sent(),[4,crypto.subtle.decrypt(o,s,this.decode64(i.DocumentData))];case 2:return a=c.sent(),[2,(new TextDecoder).decode(a)]}}))}))},i.getHashCode=function(i){var e=0,t=i.length,n=0;if(t>0)for(;n<t;)e=(e<<5)-e+i.charCodeAt(n)|0,n+=1;return e},i.cachedDocumentVersionData="cacheDocVersion",i.documentSaveIdleTimeInMs=4e3,i.cacheEvictIdleTimeInMs=8e3,i.maxStorageQuotaSettingName="BrowserCacheMaxQuotaInMB",i.minEvictTimePeriodSettingName="BrowserCacheMinEvictTimePeriodInDays",i.Tr="VisioCachedView_",i._r=null,i.Ar=function(e,t,n){if(null!=i._r&&e&&n&&t){var o=e+"_"+t,r=i.getHashCode(n);if(i._r.Cr===o&&i._r.yr===r)return!1}return!!(window.crypto&&crypto.subtle&&window.localStorage)&&"TextEncoder"in window&&!!n&&!!t&&!!e&&n.length>0&&e.length>0&&t.length>0},i}();!function(i){i.Fr="access_token",i.Er="access_token_ttl",i.Vr="wac_token",i.Rr="bundleSrc",i.Pr="bundleStaleness",i.Or="DocID",i.xr="SiteID",i.kr="WebID",i.Wr="ETag",i.Ur="feature_status",i.Dr="fileExtension",i.Nr="fileGetUrl",i.Br="customFontCatalogUrl",i.Mr="fileName",i.Hr="fileSize",i.Lr="forceSLR",i.Jr="frameHeightPx",i.jr="frameWidthtPx",i.Gr="highContrast",i.zr="highDpi",i.qr="host_diagnostics",i.Kr="hostName",i.Xr="huictrls",i.$r="owner_id",i.Zr="sc",i.Yr="softBlockedBrowser",i.Qr="templateUrl",i.es="touchMode",i.ts="user_id",i.ns="hfck",i.os="hfcv",i.ss="timeZoneId",i.as="darkCssMedia",i.cs="caae",i.us="meetingId",i.ds="meetingTitle",i.ls="meetingType",i.fs="scheduledStartTime",i.hs="scheduledEndTime",i.ps="isPresenter",i.vs="meetingOrganizerId",i.ws="meetingJoinUrl",i.ms="isMeetingTeamsRoom",i.gs="jsapibuild",i.Ss="owlver",i.bs="owlro",i.Is="caaemode",i.Ts="traceparent",i.ys="tracestate"}(ie||(ie={}));function te(i,e){K()===j.Safari?i.style.display=e?"none":"block":i.style.visibility=e?"hidden":"visible"}function ne(i,e,t){l(e,ie.Jr,String(t?window.outerHeight:i.offsetHeight)),l(e,ie.jr,String(t?window.outerWidth:i.offsetWidth)),l(e,ie.es,String(X())),l(e,ie.Gr,String($())),l(e,ie.Lr,String(Y())),l(e,ie.as,String(function(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(i){return!1}}()))}function oe(i){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(e){return i&&i.ULS.Se(591525084,n.H,o.Info,"Trust check error: ".concat(V(e))),!1}}function re(i){var e=window.navigator;if(e&&e.virtualKeyboard&&void 0!==e.virtualKeyboard.overlaysContent&&window===top)return e.virtualKeyboard.overlaysContent=i}var se,ae,ce=function(i,e,t,n,o){return i!==si.pt?Promise.reject("Wrong flow"):new Promise((function(i){re(e.overlayContent),t.container&&t.container.postMessage(yi.Uo,void 0),i({completion:"success"})}))},ue=!1,de=!1;function le(){ue=!1}function fe(i,e,t,r,s,a,c){if(e.ULS.Se(595714433,n.H,o.Info,"Starting disposing the application. unloadApp:".concat(i,"; disposed:").concat(ue,"; unloading:").concat(de)),ue||de&&i)e.ULS.Se(595714908,n.H,o.Info,"Application is already disposed or unloading");else{var u,d={logger:e,postMessenger:t,innerApplicationFrame:r,onDisposed:s,onFrameRemoved:a,unloadTimeoutInMs:c||1e3,forceAppUnload:!1,disposeStartTime:W(),appUnloadTimedOut:!1};if(i&&r)return de=!0,d.forceAppUnload=!0,(u=d).forceAppUnloadStartTime=W(),u.logger.ULS.Se(595855490,n.H,o.Info,"Sending postmessage to unload app"),u.logger.ULS.flush(),u.postMessenger.registerMessagePayloadHandler(si.bt,(function(i){return function(i,e){i.forceAppUnloadEndTime=W(),i.appUnloadedMessageValues=e,i.logger.ULS.Se(595855491,n.H,o.Info,"AppUnloaded received from app"),he(i)}(u,i)})),u.postMessenger.sendPostMessage(u.innerApplicationFrame,yi.Bo,{}),void window.setTimeout((function(){return function(i){!de&&ue||(i.appUnloadTimedOut=!0,i.logger.ULS.Se(595855492,n.H,o.Info,"ApplicationUnload timed out, forcing dispose"),he(i))}(u)}),u.unloadTimeoutInMs);he(d)}}function he(i){if(!ue)try{ue=!0,de=!1,function(i){if(!i.innerApplicationFrame)return;i.innerApplicationFrame.src="about:blank",window.setTimeout((function(){i.innerApplicationFrame&&i.innerApplicationFrame.parentElement&&i.innerApplicationFrame.parentElement.removeChild(i.innerApplicationFrame),i.onFrameRemoved&&i.onFrameRemoved()}),0)}(i),function(i){var e={disposeStartTime:i.disposeStartTime,disposeEndTime:W(),forceAppUnload:i.forceAppUnload,appUnloadTimedOut:i.appUnloadTimedOut};i.forceAppUnloadStartTime&&(e.appUnloadStartTime=i.forceAppUnloadStartTime);i.forceAppUnloadEndTime&&(e.appUnloadEndTime=i.forceAppUnloadEndTime);if(i.appUnloadedMessageValues){var t=i.appUnloadedMessageValues,r=Number(t.hostMessageReceived);i.forceAppUnloadStartTime&&!isNaN(r)&&(e.hostToAppPostMessageLatency=r-i.forceAppUnloadStartTime);var s=Number(t.appMessageSent);!isNaN(s)&&i.forceAppUnloadEndTime&&(e.appToHostPostMessageLatency=i.forceAppUnloadEndTime-s);var a=Number(t.appUnloadStart),c=Number(t.appUnloadEnd);if(isNaN(a)||isNaN(c)||(e.appUnloadLatency=c-a),t.serverTimings){var u=t.serverTimings;for(var d in u)e["st-"+d.toString()]=u[d]}}i.logger.ULS.Se(595855436,n.H,o.Info,"App disposed "+JSON.stringify(e)),i.logger.ULS.flushOnClose()}(i),i.onDisposed&&i.onDisposed()}catch(e){i.logger.ULS.Se(595714434,n.H,o.Error,"Error disposing: ".concat(V(e)))}}function pe(i,e){e&&e.Diagnostics&&Object.keys(e.Diagnostics).forEach((function(t){return i[t]=e.Diagnostics[t]}))}function ve(i,e){var t=C({},e);delete t.UserId,delete t.OwnerId,delete t.SiteId,delete t.WebId,delete t.Upn,delete t.TenantId,delete t.UiHostTabId,delete t.OriginalWdParam,delete t.WdParams;var n=t,o=e.WdParams?JSON.parse(JSON.stringify(e.WdParams).toLowerCase()):{};n.WdParams={};["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(i){o[i]&&(n.WdParams[i]=o[i])}));var r=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;return n.WdParams.wdprevioussession&&!r.test(n.WdParams.wdprevioussession)&&delete n.WdParams.wdprevioussession,n.WdParams.wdpreviouscorrelation&&!r.test(n.WdParams.wdpreviouscorrelation)&&delete n.WdParams.wdpreviouscorrelation,n.UiEmbedMode=g(i,"uiembed"),n.UiHostName=h(i,"uih")||"N/A",n.HostDomain=location?location.hostname:"",n}!function(i){i.BrowserEvent="BrowserEvent",i.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",i.PageChanged="PageChanged",i.ZoomChanged="ZoomChanged",i.ContentRefreshBegin="ContentRefreshBegin",i.ContentRefreshEnd="ContentRefreshEnd",i.AppClosed="UI_Close",i.UserEdit="Edit_Notification",i.FileRename="File_Rename",i.FileShare="UI_Sharing",i.ShowFileVersions="UI_FileVersions",i.UIWorkflow="UI_Workflow",i.IsDisabled="IsDisabled",i.AccessibilityLoopComplete="App_AccessibilityLoopComplete",i.Unloaded="Unloaded",i.Disposed="Disposed",i.SwitchMode="App_SwitchMode",i.DocumentReboot="DocReboot",i.WopiInfoFromUrl="WopiInfoFromUrl",i.DavUrlFromIds="DavUrlFromIds",i.ModeSwitched="ModeSwitched",i.CreateNewDocument="App_CreateNewDocument",i.GetAuthToken="GetAuthToken",i.GetCustomAuthConfig="GetCustomAuthConfig",i.SetOverlayContent="SetOverlayContent",i.MoveToFolder="MoveToFolder",i.SharedFilePicker="SharedFilePicker"}(se||(se={})),function(i){i.bootWithoutWopiInfo="",i.unifiedSingleFlush="Unified_SingleFlush",i.unifiedIrmEnabled="Unified_IrmEnabled",i.unifiedViewActionUrl="Unified_ViewActionUrl",i.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",i.forceSingleStepBoot="Force_SingleStepBoot",i.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",i.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect",i.wordViewToUnifiedReadRedirect="WordView_UnifiedReadRedirect"}(ae||(ae={}));var we="WebApplicationFrame";function me(i,e,t,n,o,r,s){return function(i,e,t,n){ne(i,n);var o=e.ownerDocument,r=o.createElement("form");for(var s in r.id="office_form",r.name="office_form",r.action=t,r.target=i.name,r.method="POST",n){var a=o.createElement("input");a.type="hidden",a.name=s,a.value=n[s],r.appendChild(a)}return e.appendChild(r),r.submit(),i}(function(i,e,t){var n=i.ownerDocument.createElement("iframe");n.name=t||we,n.id=we,n.src="",n.title="Office Online Frame",n.width="100%",n.height="100%",n.marginWidth="0",n.marginHeight="0",n.style.left="0",n.style.top="0",n.style.right="0",n.style.bottom="0",n.style.display="block",n.style.position="absolute",n.style.backgroundColor="transparent",n.style.border="none",n.frameBorder="0",n.setAttribute("allowfullscreen","true"),n.setAttribute("allowTransparency","true");var o=u(e);return n.setAttribute("allow","microphone ".concat(o,"; autoplay ").concat(o,"; camera ").concat(o,"; clipboard-read ").concat(o,"; clipboard-write ").concat(o,"; keyboard-map ").concat(o,"; display-capture ").concat(o)),i.appendChild(n),n}(i,e,s),i,e,t)}function ge(i,e){var t={};if(i.wopiInfo&&(t[ie.Fr]=i.wopiInfo.AccessToken,t[ie.Er]=Ie(i.wopiInfo),i.wopiInfo.WacToken&&(t[ie.Vr]=i.wopiInfo.WacToken)),i.wopiPrecheckInfo.BundleInfo&&i.wopiPrecheckInfo.BundleInfo.Url&&i.wopiPrecheckInfo.BundleInfo.Url.length>0)if(t[ie.Rr]=i.wopiPrecheckInfo.BundleInfo.Url,null!=i.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==i.wopiPrecheckInfo.BundleInfo.BundleStaleness){var r=i.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();e.ULS.Se(593503580,n.H,o.Info,"Content bundle staleness - "+r),t[ie.Pr]=r}else e.ULS.Se(593503581,n.H,o.Info,"Content bundle staleness does not exist");if(i.wopiPrecheckInfo.FileGetUrl&&(t[ie.Nr]=i.wopiPrecheckInfo.FileGetUrl),i.wopiPrecheckInfo.CustomFontCatalogUrl&&(t[ie.Br]=i.wopiPrecheckInfo.CustomFontCatalogUrl),i.wopiPrecheckInfo.FileName){var s=E(i.wopiPrecheckInfo.FileName);s&&(t[ie.Dr]=s),t[ie.Mr]=i.wopiPrecheckInfo.FileName}i.newFileTemplateSource&&i.newFileTemplateSource.FileSize?t[ie.Hr]=i.newFileTemplateSource.FileSize.toString():i.wopiPrecheckInfo.FileSize&&(t[ie.Hr]=i.wopiPrecheckInfo.FileSize.toString()),i.sessionInformation.UserId&&(t[ie.ts]=i.sessionInformation.UserId),i.sessionInformation.OwnerId&&(t[ie.$r]=i.sessionInformation.OwnerId),i.sessionInformation.SessionContext&&(t[ie.Zr]=i.sessionInformation.SessionContext),i.diagnostics.HostInitDiagnostics&&(t[ie.qr]=JSON.stringify({HostInitializeDiagnostics:i.diagnostics.HostInitDiagnostics,ClientDiagnostics:i.diagnostics.ClientDiagnostics})),t[ie.Ur]=Si(i.featureManager,i.sessionInformation.WdParams),i.applicationCustomSettings&&i.applicationCustomSettings.HostUIControls&&(t[ie.Xr]=JSON.stringify(i.applicationCustomSettings.HostUIControls)),t[ie.zr]=String(window.devicePixelRatio>1.24),t[ie.Yr]=String(Z()),t[ie.Kr]=i.sessionInformation.HostName;var a=i.newFileTemplateSource;a&&a.FileGetUrl&&(t[ie.Qr]=a.FileGetUrl),a&&a.DocUniqueId?t[ie.Or]=a.DocUniqueId:i.wopiPrecheckInfo.DocUniqueId&&(t[ie.Or]=i.wopiPrecheckInfo.DocUniqueId),a&&a.ETag?t[ie.Wr]=a.ETag:i.wopiPrecheckInfo.ETag&&(t[ie.Wr]=i.wopiPrecheckInfo.ETag),"Templatization"!==i.sessionInformation.ContentAssemblyMode&&"DocGen"!==i.sessionInformation.ContentAssemblyMode&&"ContentAssemblyEdit"!==i.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==i.sessionInformation.ContentAssemblyMode||(t[ie.cs]="1"),i.sessionInformation.ContentAssemblyMode&&(t[ie.Is]=i.sessionInformation.ContentAssemblyMode);var c=i.sessionInformation.Meeting;c&&(c.id&&(t[ie.us]=c.id),c.title&&(t[ie.ds]=c.title),c.type&&(t[ie.ls]=c.type),c.scheduledStartTime&&(t[ie.hs]=c.scheduledStartTime),c.scheduledEndTime&&(t[ie.hs]=c.scheduledEndTime),c.joinUrl&&(t[ie.ws]=encodeURIComponent(c.joinUrl)),c.organizerId&&(t[ie.vs]=c.organizerId),c.isPresenter&&(t[ie.ps]=c.isPresenter.toString()),c.isMeetingTeamsRoom&&(t[ie.ms]=c.isMeetingTeamsRoom.toString()));var u=i.sessionInformation.OwlVersion;u&&(t[ie.Ss]=u);var d=i.sessionInformation.OwlRollout;d&&(t[ie.bs]=d),t[ie.gs]=T();var l=i.sessionInformation.TraceParent;if(l){t[ie.Ts]=l;var f=i.sessionInformation.TraceState;f&&(t[ie.ys]=f)}return t}function Se(i,e,t){void 0===t&&(t=!1);var n=i.applicationUrl;var o={jsApi:"1",jsapiver:"v1"};if(t&&(o.NewSession="1"),o.corrid=i.sessionId,o.usid=i.sessionId,o.sftc="1",(i.applicationCustomSettings&&i.applicationCustomSettings.IsCore||i.sessionInformation.IsCore)&&(o.core="1"),i.sessionInformation.HideViewerToolbar&&(o.hvt="1"),i.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),i.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(i.sessionInformation.HighContrastMode)),i.sessionInformation.SupportsAtMentions&&(o.sams="1"),i.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),i.sessionInformation.SupportsDocReboot){var r=i.sessionInformation.SupportsDocReboot;o.sdr=!0===r?"1":r.toString()}return i.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),i.sessionInformation.SupportsAuthToken&&(o.sat="1"),i.sessionInformation.SupportsCustomAuthConfig&&(o.cac="1"),i.sessionInformation.SupportsMoveToFolder&&(o.mtf="1"),i.sessionInformation.SupportsCommonFilePicker&&(o.sfp="1"),i.sessionInformation.OpenLinksInNewWindow&&(o.onw="1"),i.sessionInformation.UseDarkTheme&&(o.udt="1"),(i.sessionInformation.HideHeader||"DocGen"===i.sessionInformation.ContentAssemblyMode||"Templatization"===i.sessionInformation.ContentAssemblyMode||"ContentAssemblyEdit"===i.sessionInformation.ContentAssemblyMode||"ContentAssemblyView"===i.sessionInformation.ContentAssemblyMode)&&(o.hhdr="1"),i.sessionInformation.HideAppLauncherInHeader&&(o.halh="1"),i.sessionInformation.HideChatInHeader&&(o.hch="1"),i.sessionInformation.HideMeInHeader&&(o.hmh="1"),i.sessionInformation.HideSearchInHeader&&(o.hsh="1"),i.sessionInformation.HideWorkflowInHeader&&(o.hwfh="1"),i.sessionInformation.HideSettingsInHeader&&(o.hsth="1"),i.sessionInformation.ShowAppIconInHeader&&(o.sih="1"),i.sessionInformation.UseNeutralColorInHeader&&(o.unh="1"),i.sessionInformation.HideBreadCrumbInViewer&&(o.hbcv="1"),i.sessionInformation.HideTitleInViewer&&(o.htv="1"),i.sessionInformation.HideWACOneDriveFileLocationPicker&&(o.hodflp="1"),i.sessionInformation.NoBrowserModalDialogs&&(o.nbmd="1"),i.applicationCustomSettings&&i.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),i.wopiPrecheckInfo.ReadOnly&&(o.readOnly="1"),"DocGen"!==i.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==i.sessionInformation.ContentAssemblyMode||(o.readOnly="1"),i.sessionInformation.UIEmbed&&(o.uiEmbed="1"),i.sessionInformation.IsSynthetic&&(o.syn="1"),i.sessionInformation.SupportsDirectDownload&&(o.sdd="1"),i.sessionInformation.SupportsDirectPrint&&(o.sdp="1"),i.sessionInformation.UiHostIntegrationType&&(o.uihit=encodeURIComponent(i.sessionInformation.UiHostIntegrationType)),i.sessionInformation.MetaUiHostVersion&&(o.muv=encodeURIComponent(i.sessionInformation.MetaUiHostVersion)),i.applicationCustomSettings&&i.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),i.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(i.wopiPrecheckInfo.PreseededSessionKey)),i.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(i.wopiPrecheckInfo.PreseededWacSessionId)),i.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=i.wopiPrecheckInfo.RequestedCallThrottling),i.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=i.wopiPrecheckInfo.ClientThrottlingProtection),i.applicationCustomSettings&&i.applicationCustomSettings.additionalApplicationParameters&&(o=C(C({},i.applicationCustomSettings.additionalApplicationParameters),o)),i.rebootOverrideData&&i.rebootOverrideData.queryOverrides&&(o=C(C({},o),i.rebootOverrideData.queryOverrides)),be(n,i.sessionInformation,i.wopiInfo,i.diagnostics.HostInitDiagnostics,o)}function be(i,e,t,n,o){var r=v(i);("teams"===r.uih&&"UnifiedUiHostTeams"!==e.UiHostIntegrationType&&"TeamsModern"!==e.UiHostIntegrationType||"owa"===r.uih)&&(r.hhdr="1");var s=i.indexOf("?"),a=-1===s?i.concat("?"):i.substring(0,s+1);e.UiLocale&&(r.ui=encodeURIComponent(e.UiLocale)),e.DataLocale&&(r.rs=encodeURIComponent(e.DataLocale)),e.HostSessionId&&(r.hid=encodeURIComponent(e.HostSessionId)),e.DisableChat&&(r.dchat="1"),e.SessionContext&&(r.sc=encodeURIComponent(e.SessionContext)),t&&t.WopiSrc&&(r.wopisrc=encodeURIComponent(t.WopiSrc)),e.CookieCompliant&&(r.mscc="1"),n&&(n.entryPoint&&(r.wdorigin=encodeURI(n.entryPoint)),n.userClickTime&&(r.wdhostclicktime=n.userClickTime.toString())),r=C(C(C({},r),e.WdParams),o);var c={};for(var u in r)c[u.toLowerCase()]=r[u];var d=[];for(var u in c)c[u]&&d.push(u.concat("=",c[u]));return a.concat(d.join("&"))}function Ie(i){return i.AccessTokenExpiry?i.AccessTokenExpiry.getTime().toString():"0"}function Te(i,e,t,n){var o=new XMLHttpRequest;for(var r in o.onreadystatechange=function(){if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{n&&n(o)}finally{null!=o&&(o.onreadystatechange=function(){})}}},o.open("POST",i),t)o.setRequestHeader(r,t[r]);o.send(e)}var ye=function(){function i(i,e,t,n,o){this.Cs=0,this.As=[],this.tr=!1,this.tr=i,this._s=e,this.gn=t,this.Fs=n,this.Es=o,this.restart()}return i.prototype.restart=function(){var i=this,e=this._s.getValue(H.Qi,!1);this.Cs=k()+(this.Es?this.Es:this._s.getValue(H.Gi,6e5));var t=this.tr?3e3:5e3;this.Vs=window.setInterval((function(){e&&i.gn.ULS.Se(595724178,n.H,o.Info,"Boot_HeartBeat"),k()>i.Cs&&(i.stop(),Ce(i.gn),i.Fs&&i.Fs())}),this._s.getValue(H.Yi,t)),this.As.push(window.setTimeout(Ce,this._s.getValue(H.zi,6e4),this.gn,1)),this.As.push(window.setTimeout(Ce,this._s.getValue(H.qi,18e4),this.gn,2))},i.prototype.stop=function(){this.Cs=0,this.Vs&&(window.clearInterval(this.Vs),this.Vs=void 0),this.As.forEach((function(i){window.clearTimeout(i)})),this.As=[]},i}();function Ce(i,e){i.ULS.Se(594901218,n.H,o.Warning,"Boot_NotComplete_".concat(e||"Final")),i.ULS.flush()}function Ae(i){localStorage.setItem(i.flightKey,i.flightValue.toString())}var _e=function(i,e,t,r,s){return i!==si.pn?Promise.reject("Wrong flow"):new Promise((function(i){var r=e.flightKey,s=e.flightValue;t.logger.ULS.Se(507343134,n.Ii,o.Info,"setWacFlightValue ".concat(r,": ").concat(s)),Ae(e),i({completion:"success"})}))};function Fe(i){return Vi(i.hostKey)}function Ee(i){Ri(i.hostKey,i.hostValue,365)}var Ve=function(){function i(i,e,t,r,s,a){var c=this;if(this.Rs=!1,this.Ps=function(i,e){c.Os.officeFrameCreateTime=W(),c.xs.frameCreateStartTime=c.Os.officeFrameCreateTime;var t=c.ks.applicationCustomSettings&&c.ks.applicationCustomSettings.appFrameName;c.ur=me(c.ks.container,i,e,c.ks.featureManager,c.gn,c.ks.sessionId,t),c.Ws.activate(c.ur)},this.Us=function(i){c.Ws.registerMessagePayloadHandler(si._e,c.Ds),c.Ws.registerMessagePayloadHandler(si.Ce,c.Ns),c.ji=window.setTimeout(c.Bs,15e3),c.Ms=new ye(i,c.ks.be,c.gn,(function(){N(c.ks.remoteTelemetryUrl,"Visio","bootTimeout")}))},this.Hs=function(i){var e=i.flightKey,t=i.flightValue;c.gn.ULS.Se(507343133,n.Ii,o.Info,"storeWacFlightKeyValue ".concat(e,": ").concat(t));try{Ae(i)}catch(i){c.gn.ULS.Se(507340380,n.Ii,o.Error,"Handler error: ".concat(V(i)))}},this.Ls=function(i){var e=i&&i.state?i.state:"unknown";c.gn.ULS.Se(595714271,n.H,o.Info,"WAC Boot App state:[".concat(e,"]"))},this.Js=function(i){var e=oe(c.gn);c.gn.ULS.Se(595653903,n.H,o.Info,"Top frame is trusted: ".concat(e)),c.js(yi.Je,{isTopFrameTrusted:e})},this.Gs=function(i){var e=re(i&&i.overlayContent);c.gn.ULS.Se(587487432,n.H,o.Info,"Overlay content: ".concat(e)),c.js(yi.Uo,void 0)},this.Ds=function(i){if(c.gn.ULS.Se(595986314,n.H,o.Info,"Received wac complete message"),c.gn.ULS.flush(),window.clearTimeout(c.ji),c.Ms&&c.Ms.stop(),c.Rs)c.gn.ULS.Se(596444234,n.H,o.Info,"Received multiple wac complete or failure messages");else{c.Rs=!0,c.js(yi.oo,{}),pe(c.Os,i);var e=c.zs();c.qs(e),c.ks.be.getValue(H.oe,!1)&&(c.ks.diagnostics.HostInitDiagnostics||(c.ks.diagnostics.HostInitDiagnostics={}),ai(c.ks.diagnostics.HostInitDiagnostics)),c.Ks(c.ks.diagnostics)}},this.Xs=function(){c.gn.ULS.Se(579342464,n.H,o.Info,"Received close tab message");try{window.close()}catch(i){c.gn.ULS.Se(579213188,n.H,o.Warning,"Failed to close the browser tab")}},this.zs=function(){return{innerApplicationFrame:c.ur}},this.Ns=function(i){if(c.gn.ULS.Se(595986315,n.H,o.Error,"Received wac failed message"),c.gn.ULS.flush(),window.clearTimeout(c.ji),c.Ms&&c.Ms.stop(),c.Rs)c.gn.ULS.Se(596444235,n.H,o.Info,"Received multiple wac complete or failure messages");else{c.Rs=!0,c.js(yi.no,{});var e={errorType:di.WacFailed,errorObject:{}};i&&(e.errorObject=i.Error,c.xs.error=e),c.$s(e)}},this.Zs=function(i){var e=i.hostKey;c.gn.ULS.Se(574433173,n.H,o.Info,"GetHostKeyValue ".concat(e));var t=Fe(i);null!=t&&c.js(yi.do,{hostKey:e,hostValue:t})},this.Ys=function(i){var e=i.hostKey,t=i.hostValue;c.gn.ULS.Se(574433174,n.H,o.Info,"storeHostKeyValue ".concat(e,": ").concat(t)),Ee(i)},this.Bs=function(){c.Rs||c.gn.ULS.Se(596444236,n.H,o.Warning,"Timeout. SessionTraces:"+JSON.stringify(c.xs))},this.Ks=function(i){c.js(yi.lo,{HostInitializeDiagnostics:i.HostInitDiagnostics,ClientDiagnostics:i.ClientDiagnostics})},this.js=function(i,e){c.ur&&c.ur.contentWindow?c.Ws.sendPostMessage(c.ur,i,e):c.gn.ULS.Se(595955718,n.H,o.Info,"Attempted to send postmessage: "+i)},void 0===e)throw new TypeError("bootFlowInfo");if(e.isSingleStepBoot&&void 0===i.wopiInfo)throw new TypeError("wopiInfo");this.ks=i,this.Qs=e,this.gn=t,this.Ws=r,this.qs=s,this.$s=a,this.Os=i.diagnostics.AppInitDiagnostics,this.xs=i.diagnostics.SessionTraces,this.xs.wopiInitializeTime=W()}return i.prototype.Boot=function(){this.gn.ULS.Se(596444241,n.H,o.Info,"Initializing WAC frame");var i=Se(this.ks,this.Qs,!0),e=ge(this.ks,this.gn);if(this.Ws.registerMessagePayloadHandler(si.Ae,this.Ls),this.Ws.registerMessagePayloadHandler(si.Ve,this.Xs),this.ks.sessionInformation.SupportsFrameTrustCheck||this.Ws.registerMessagePayloadHandler(si.Je,this.Js),this.Ws.registerMessagePayloadHandler(si.pt,this.Gs),this.Ws.registerMessagePayloadHandler(si.qe,this.Zs),this.Ws.registerMessagePayloadHandler(si.St,this.Ys),this.Ws.registerMessagePayloadHandler(si.pn,this.Hs),this.Qs.ignoreWacFramePostMessages||this.Us(s(i)),this.Ps(i,e),this.Qs.ignoreWacFramePostMessages){var t=this.zs();this.qs(t)}return this.gn.ULS.Se(595661019,n.H,o.Info,"Created Wac Frame"),this.ur},i}();!function(){function i(i,e,t,r,s,a,c){var u=this;this.ia=!1,this.ea=!1,this.ta=!1,this.na=null,this.oa=!0,this.ra=!1,this.sa=!1,this.aa=function(){u.gn.ULS.Se(596444231,n.H,o.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout(u.ca,5e3),u.Ws.registerMessagePayloadHandler(si.ye,u.ua),u.Ws.registerMessagePayloadHandler(si.ht,u.da);var i=new Ve(u.ks,u.Qs,u.gn,u.Ws,u.qs,u.$s);u.ur=i.Boot(),u.la&&u.la(u.ur)},this.fa=function(){var i={ParallelizeStartSession:u.oa,WacFrameIsLoaded:u.ia,WacAcceptsStartSessionComplete:u.ra};u.gn.ULS.Se(596444232,n.H,o.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(i)),!u.oa||u.ia&&!u.ra?u.ia&&u.ha():u.pa()},this.va=function(){u.gn.ULS.Se(596444233,n.H,o.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),u.ks.wopiInfo=u.wa;var i=new Ve(u.ks,u.Qs,u.gn,u.Ws,u.qs,u.$s);u.ur=i.Boot(),u.la(u.ur)},this.ma=function(i){u.ia?(u.gn.ULS.Se(595968481,n.H,o.Warning,"Fail called and wacframe is able to accept postmessages"),u.ga(i)):(u.gn.ULS.Se(595968482,n.H,o.Warning,"Fail was called on the session prior to WacReady."),u.na=i)},this.ga=function(i){u.gn.ULS.Se(596444189,n.H,o.Warning,"Fail called, sending the failure postmessage to IFrame"),u.js(yi.Wo,i)},this.Sa=function(){u.gn.ULS.Se(596444190,n.H,o.Warning,"Fail called during single step boot, calling host failure callback..."),u.$s({errorType:di.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},this.ca=function(){u.ia||(u.gn.ULS.Se(596444191,n.H,o.Warning,"Timeout Wac Ready"),u.$s({errorType:di.TimeoutWacReady,errorObject:void 0}))},this.ba=function(){u.ta||(u.xs.timeoutCompleteOrFail=W(),u.gn.ULS.Se(596444192,n.H,o.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(u.xs)))},this.Ia=function(i,e,t){u.sa||(u.gn.ULS.Se(596444193,n.H,o.Info,"SessionCompletion timed out with no ack."),u.Ta(i,e,t+1))},this.ua=function(i){if(u.xs.readyMessageReceiveTime=W(),u.js(yi.io,{}),u.ia)u.gn.ULS.Se(596444194,n.H,o.Info,"Received multiple ready messages - frame is already loaded.");else{u.ia=!0,u.ra=i&&i.CanAcceptStartSessionComplete;var e={AcceptStartSessionComplete:u.ra,ParallelizeStartSession:u.oa,StartSessionResponseAvailable:!!u.ya,WopiInfoAvailable:!!u.wa};u.gn.ULS.Se(596444195,n.H,o.Info,"HandleWacReadyMessage - "+JSON.stringify(e)),u.ta&&(u.na?u.ga(u.na):u.js(yi.Do,{})),u.oa&&u.ra?u.ya&&u.Ca():u.wa&&u.ha(),pe(u.Os,i)}},this.da=function(i){u.sa=!0,u.xs.sessionCompleteAckReceivedTime=W()},this.js=function(i,e){u.Ws.sendPostMessage(u.ur,i,e)},this.Aa=function(i,e){u.Ta(i,e,1)},this.Ta=function(i,e,t){if(t>3)u.gn.ULS.Se(596444224,n.H,o.Error,"Attempted to call complete, but received no ack from the frame. Time: ".concat(W()));else{u.gn.ULS.Se(596444225,n.H,o.Info,"Sending completion message to frame. Attempt number: ".concat(t,", Time: ").concat(W()));var r=W();1===t&&(u.ya&&u.ya.Diagnostics&&(u.ya.Diagnostics.completeMessageCreateTime=r),u.xs.completeMessageCreateTime=r),e.Diagnostics.completeMessageSendTime=r,u.xs.completeMessageSendTime=r,u.js(i,e),window.setTimeout((function(){return u.Ia(i,e,t)}),1e3)}},this.pa=function(){u.gn.ULS.Se(596444226,n.H,o.Info,"Making parallelized startSession request.");var i=u._a(u.wa),e={"Content-Type":"application/x-www-form-urlencoded"},t="access_token="+encodeURIComponent(u.wa.AccessToken)+"&access_token_ttl="+encodeURIComponent(Ie(u.wa));u.xs.startSessionStartTime=W(),Te(i,t,e,u.Fa)},this.Fa=function(i){if(u.xs.startSessionCompleteTime=W(),u.xs.startSessionResponseStatus=i.status,u.ya={StartSessionResponse:{RequestStatus:i.status,ResponseText:i.responseText},Diagnostics:{wopiPendingInitializeTime:u.xs.wopiPendingInitializeTime,wopiPendingCompleteTime:u.xs.wopiPendingCompleteTime,startSessionStartTime:u.xs.startSessionStartTime,startSessionCompleteTime:u.xs.startSessionCompleteTime,readyMessageReceiveTime:u.xs.readyMessageReceiveTime}},u.gn.ULS.Se(596444227,n.H,o.Info,"StartSession request completed with status code: ".concat(u.ya.StartSessionResponse.RequestStatus,", Time: ").concat(W())),u.ia&&u.ra)u.Ca();else{var e={WacFrameIsLoaded:u.ia,InitializeCompleted:u.ea};u.gn.ULS.Se(596444228,n.H,o.Info,"StartSessionCompleted not called - "+JSON.stringify(e))}},this.ha=function(){if(!u.ea){u.ea=!0,u.gn.ULS.Se(596444229,n.H,o.Info,"Sending wopi info to the frame.");var i={WopiDetails:{WopiSrc:u.wa.WopiSrc,AccessToken:u.wa.AccessToken,AccessTokenTtl:Ie(u.wa)},Diagnostics:{wopiPendingInitializeTime:u.xs.wopiPendingInitializeTime,wopiPendingCompleteTime:u.xs.wopiPendingCompleteTime,readyMessageReceiveTime:u.xs.readyMessageReceiveTime}};u.wa.WacToken&&(i.WopiDetails.WacToken=u.wa.WacToken),u.Aa(yi.so,i)}},this.Ca=function(){200===u.ya.StartSessionResponse.RequestStatus?u.ea||(u.ea=!0,u.Aa(yi.ro,u.ya)):u.ha()},this._a=function(i){var e=u.ks.applicationBasePath+"wordeditorstartsession.ashx",t=Se(u.ks,u.Qs,!1);return e=p(e+="?"+t.substring(t.indexOf("?")+1),"WOPISrc",encodeURIComponent(i.WopiSrc)),e=p(e,"build",encodeURIComponent(T())),e=p(e,"WacUserType",encodeURIComponent("WOPI")),u.ks.wopiPrecheckInfo.FileGetUrl&&(e=p(e,"fileGetUrlPresent","1")),e},this.Ea=function(i){if(u.ks.isCreateNew){if(!i||!i.NewFilePath)return void u.gn.ULS.Se(596444230,n.H,o.Info,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",i.NewFilePath),i.UpdatedPageTitle&&(document.title=i.UpdatedPageTitle)}},this.ks=i,this.Qs=e,this.Os=i.diagnostics.AppInitDiagnostics,this.gn=t,this.Ws=r,this.qs=a,this.$s=c,Promise&&(this.Va=new Promise((function(i){return u.la=i}))),this.xs=i.diagnostics.SessionTraces,this.xs.wopiPendingInitializeTime=W(),this.Ra=s,le(),window.setTimeout(this.ba,5e3)}i.prototype.Complete=function(i,e){if(this.ta)this.gn.ULS.Se(596444184,n.H,o.Warning,"Complete called after Complete/Fail already called");else{this.gn.ULS.Se(596444185,n.H,o.Info,"Complete called."),this.ks.diagnostics.HostInitDiagnostics&&(this.ks.diagnostics.HostInitDiagnostics.hostCompleteCallTime=W()),this.ta=!0,this.wa=i,this.xs.wopiPendingCompleteTime=W();try{this.Qs.isSingleStepBoot?this.va():this.fa(),this.ia&&this.js(yi.Do,{}),this.Ea(e)}catch(i){this.gn.ULS.Se(596444186,n.H,o.Error,"Unexpected script error: ".concat(V(i))),N(this.ks.remoteTelemetryUrl,"Visio","bootException")}finally{this.gn.ULS.flush()}}},i.prototype.Fail=function(i){this.ta?this.gn.ULS.Se(596444187,n.H,o.Warning,"Fail called after Complete/Fail already called"):(this.gn.ULS.Se(596444188,n.H,o.Warning,"Fail called. Reason: "+(i?JSON.stringify(i):"N/A")),this.ta=!0,this.Qs.isSingleStepBoot?this.Sa():this.ma(i),this.gn.ULS.flush())},i.prototype.Dispose=function(i,e,t){var n=this;fe(i||!1,this.gn,this.Ws,this.ur,(function(){delete n.ur,e&&e(),n.Ra(),n.Ws.dispose()}),void 0,t)},i.prototype.PostWacToken=function(i,e,t){xi(i,e,this.Ws,this.gn,this.Va,t)},i.prototype.Boot=function(){this.Qs.isSingleStepBoot||this.aa(),this.gn.ULS.flush()}}();var Re,Pe=function(){function i(e,t,r,s,a,c,d,l,f,h,p,w,m,g){var S=this;this.Pa=!1,this.Oa=!1,this.xa=!1,this.ka=!1,this.ea=!1,this.Wa=!1,this.sa=!1,this.Ua=!1,this.Zo={},this.js=function(i,e){S.ur&&S.ur.contentWindow?S.Da.sendPostMessage(S.ur,i,e):S.gn.ULS.Se(595706831,n.H,o.Warning,"Attempted to send postmessage: "+i)},this.Na=function(e,t,r){void 0===e&&(e=!1),S.gn.ULS.Se(596464673,n.X,o.Info,"VisioWopiApplication.createInnerFrame()"),S.ur=document.createElement("iframe"),S.ur.id=e?i.Ba:we,S.ur.name=we,S.ur.width="100%",S.ur.height="100%",S.ur.src="",S.ur.frameBorder="0",S.ur.marginWidth="0",S.ur.marginHeight="0",S.ur.allowFullscreen=!0,S.ur.style.left="0",S.ur.style.top="0",S.ur.style.right="0",S.ur.style.bottom="0",S.Ma(e),S.ur.style.position="absolute",S.ur.style.backgroundColor="transparent",S.ur.setAttribute("allowTransparency","true"),S.ur.setAttribute("loading","eager"),S.ur.title="Office Online Frame",S.ur.style.zIndex="1000",S.ur.style.setProperty("will-change","opacity"),S.ur.onload=r;var s=u(S.Ha);S.ur.setAttribute("allow","microphone ".concat(s,"; autoplay ").concat(s,"; camera ").concat(s,"; clipboard-read ").concat(s,"; clipboard-write ").concat(s,"; keyboard-map ").concat(s,"; display-capture ").concat(s)),S.Os.officeFrameCreateTime=W(),t.insertBefore(S.ur,t.firstChild),S.la&&S.la(S.ur)},this.Ma=function(i){K()===j.Safari?S.ur.style.display=i?"none":"block":S.ur.style.visibility=i?"hidden":"visible"},this.La=function(e){if(void 0===e&&(e=!1),S.ur.onload=function(){},S.gn.ULS.Se(596464674,n.X,o.Info,"VisioWopiApplication.internalBootFromWac() isBackground:".concat(e)),null!=S.ur.contentWindow){S.Ja=S.ur.contentWindow,S.ja=S.Ja.document,S.ja.body.style.margin="0",S.ja.body.style.padding="0",S.ja.body.style.overflow="hidden",S.ja.body.style.msContentZooming="none";var t=S.ja.createElement("meta");t.charset="utf-8",S.ja.head.appendChild(t);var r=S.ja.createElement("meta");r.httpEquiv="x-ua-compatible",S.ja.head.appendChild(r);var s=S.ja.createElement("meta");s.name="viewport",s.content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no",S.ja.head.appendChild(s);var a=S.ja.createElement("form");a.id="office_form",a.name="office_form",a.target=e?"_self":we,a.action=S.Ga,a.method="POST";var c=ge(S.ks,S.gn);for(var u in ke.isInstantBootMode(S.za,S.Ha)&&(c.hasOwnProperty(ie.Fr)&&delete c[ie.Fr],c.hasOwnProperty(ie.Er)&&delete c[ie.Er],c.hasOwnProperty(ie.Vr)&&delete c[ie.Vr]),c.hasOwnProperty(ie.Zr)&&delete c[ie.Zr],c)S.qa(a,u,c[u]);if(Hi.getBRSValue(Hi.DTEEnabledBRSKey)&&S.qa(a,i.Ka,S.Wa.toString()),!S.Xa.MetaUiHostVersion){if(S.Xa.HighContrastMode&&S.qa(a,"hcm",encodeURIComponent(S.Xa.HighContrastMode)),S.Xa.SupportsAccessibilityLoop&&S.qa(a,"accloop","1"),S.Xa.SupportsDocReboot){var d=S.Xa.SupportsDocReboot;S.qa(a,"sdr",!0===d?"1":d.toString())}S.Xa.SupportsCreateNewDocument&&S.qa(a,"scnd","1"),S.Xa.SupportsAuthToken&&S.qa(a,"sat","1"),S.Xa.SupportsCustomAuthConfig&&S.qa(a,"cac","1"),S.Xa.SupportsMoveToFolder&&S.qa(a,"mtf","1"),S.Xa.SupportsCommonFilePicker&&S.qa(a,"sfp","1"),S.Xa.SupportsDirectPrint&&S.qa(a,"sdp","1"),S.Xa.SupportsDirectDownload&&S.qa(a,"sdd","1"),S.Xa.HideHeader&&S.qa(a,"hhdr","1"),S.Xa.MetaUiHostVersion&&S.qa(a,"muv",S.Xa.MetaUiHostVersion),S.Xa.HideWACOneDriveFileLocationPicker&&S.qa(a,"hodflp","1"),S.Xa.OpenLinksInNewWindow&&S.qa(a,"onw","1"),S.Xa.UseDarkTheme&&S.qa(a,"udt","1"),Hi.getBRSValue(Hi.IsAtMentionsEnabled)&&S.Xa.SupportsAtMentions&&S.qa(a,"sams","1")}if(S.$a&&S.za===ki.VIEW){var l=decodeURIComponent(S.$a);S.qa(a,"nav",l)}S.qa(a,i.Za,"true"),S.qa(a,i.Ya,"true"),S.Qa&&S.qa(a,ee.cachedDocumentVersionData,S.Qa.GetDocVersion()),S.qa(a,ie.zr,String(window.devicePixelRatio>i.highDpiThreshold)),S.ic&&S.qa(a,i.ec,S.ic.getTime().toString()),S.ja.body.appendChild(a),a.submit()}},this.qa=function(i,e,t){var n=S.ja.createElement("input");n.name=e,n.value=t,n.type="hidden",i.appendChild(n)},this.tc=function(){var i;i=S.Xa.MetaUiHostVersion?Se(S.ks,function(i,e){var t={isSingleStepBoot:i.forceSingleStepBoot,bootFlowType:i.forceSingleStepBoot?ae.forceSingleStepBoot:ae.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(i.forceSingleStepBoot,t.isSingleStepBoot){var r={singleStepBootIsRequired:!0,singleStepBootReason:t.bootFlowType,irmEnabled:i.wopiPrecheckInfo.IrmEnabled,readOnly:i.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:t.ignoreWacFramePostMessages};e.ULS.Se(596444182,n.H,r.irmEnabled?o.Warning:o.Info,JSON.stringify(r))}else e.ULS.Se(596444183,n.H,o.Info,"Received input valid for two step flow")}(S.ks,S.gn)):S.Ha;var e={};return e.usid=S.nc,e.sftc="1",e.fileSrc=S.Xa.HostName,e.pmOrigin=encodeURIComponent(u(window.location.href)),e.fastPreview=S.ka?"true":"false",ke.isInstantBootMode(S.za,S.Ha)&&(e.instantedit="1"),S.Xa.MetaUiHostVersion||(S.oc.RequestedCallThrottling&&(e.rct=S.oc.RequestedCallThrottling),S.oc.ClientThrottlingProtection&&(e.ctp=S.oc.ClientThrottlingProtection)),"DocGen"!==S.Xa.ContentAssemblyMode&&"ContentAssemblyView"!==S.Xa.ContentAssemblyMode||(e.readOnly="1"),"DocGen"!==S.Xa.ContentAssemblyMode&&"Templatization"!==S.Xa.ContentAssemblyMode&&"ContentAssemblyView"!==S.Xa.ContentAssemblyMode&&"ContentAssemblyEdit"!==S.Xa.ContentAssemblyMode||(e.hhdr="1"),be(i,S.Xa,S.wa,S.rc,e)},this.ua=function(i){S.js(yi.io,{}),S.Pa||(S.Pa=!0,pe(S.Os,i),ke.isInstantBootMode(S.za,S.Ha)&&S.wa&&S.ha())},this.ha=function(){if(!S.ea){S.ea=!0,S.gn.ULS.Se(595706832,n.H,o.Info,"Sending wopi info to the frame.");var i="";Hi.getBRSValue(Hi.AppShellPrebootEnabledBRSKey)&&void 0!==S.ac&&void 0!==S.ac.TemplateSource&&void 0!==S.ac.TemplateSource.DocUniqueId&&(i=S.ac.TemplateSource.DocUniqueId);var e={WopiDetails:{WopiSrc:S.wa.WopiSrc,AccessToken:S.wa.AccessToken,AccessTokenTtl:Ie(S.wa),CreateNewTemplateId:i}};S.wa.WacToken&&(e.WopiDetails.WacToken=S.wa.WacToken),S.Aa(yi.so,e)}},this.Aa=function(i,e){S.Ta(i,e,1)},this.cc=function(){if(S.gn.ULS.Se(589611397,n.H,o.Info,"Sending comment context message to frame"),void 0!==S.uc){var i=S.uc;S.js(yi.Fo,i),S.uc=void 0}},this.dc=function(i){S.uc=i},this.Ta=function(i,e,t){t>3?S.gn.ULS.Se(595706833,n.H,o.Error,"Attempted to call complete, but received no ack from the frame. Time: ".concat(W())):(S.gn.ULS.Se(595706834,n.H,o.Info,"Sending completion message to frame. Attempt number: ".concat(t,", Time: ").concat(W())),S.js(i,e),window.setTimeout((function(){return S.Ia(i,e,t)}),1e3))},this.Ia=function(i,e,t){S.sa||(S.gn.ULS.Se(595706835,n.H,o.Info,"SessionCompletion timed out with no ack."),S.Ta(i,e,t+1))},this.da=function(i){S.sa=!0},this.lc=function(i){S.za===ki.VIEW&&Hi.getBRSValue(Hi.CoCommentingAcrossViewAndEditEnabled)&&S.cc(),S.xa||(S.xa=!0,S.gn.ULS.Se(596457678,n.X,o.Info,"Switched to Visio Frame at Time: ".concat(W())),pe(S.Os,i),S.Os.webAppFrameReinitialized=S.Ua,S.Os&&S.gn.ULS.Se(596464400,n.X,o.Info,"AppInitializeDiagnostics:"+JSON.stringify(S.Os)),S.gn.ULS.Se(596464675,n.X,o.Info,"".concat(JSON.stringify(i))),S.fc(S.Os,i&&i.Settings?i.Settings:null),S.Da.sendPostMessage(S.ur,yi.lo,{HostInitializeDiagnostics:S.ks.diagnostics.HostInitDiagnostics,ClientDiagnostics:S.ks.diagnostics.ClientDiagnostics}))},this.Ns=function(i){var e;S.xa=!0,i&&(e=i.Error),void 0===e&&(S.gn.ULS.Se(596453597,n.X,o.Warning,"No error information passed by the WAC Frame"),e={errorType:di.AppInitError,errorObject:new TypeError("WacFrame")}),S.hc(e,S.Os)},this.pc=function(i){S.Oa||(S.Oa=!0,S.gn.ULS.Se(595969242,n.X,o.Info,"Page View loaded on WAC Frame"),pe(S.Os,i))},this.vc=function(i){S.raiseEvent(se.DocumentReboot,i)},this.wc=function(i){S.raiseEvent(se.CreateNewDocument,i)},this.mc=function(i){Promise?S.gc.isResourceTrustedForMessage(i).then((function(e){e?S.raiseEvent(se.GetAuthToken,i):S.Da.sendPostMessage(S.ur,yi.Ao,{AuthToken:"",Error:"accessDenied",RequestId:i.RequestId,IdentityType:i.IdentityType})}),(function(){S.Da.sendPostMessage(S.ur,yi.Ao,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:i.RequestId,IdentityType:i.IdentityType})})):S.Da.sendPostMessage(S.ur,yi.Ao,{AuthToken:"",Error:'"Promise" does not exist natively in browser',RequestId:i.RequestId,IdentityType:i.IdentityType})},this.Sc=function(i){S.raiseEvent(se.GetCustomAuthConfig,i)},this.bc=function(i){S.raiseEvent(se.MoveToFolder,i)},this.Ic=function(i){S.raiseEvent(se.SharedFilePicker,i)},this.Js=function(i){var e=oe();S.gn.ULS.Se(595642328,n.X,o.Info,"Top frame is trusted: ".concat(e)),S.Da.sendPostMessage(S.ur,yi.Je,{isTopFrameTrusted:e})},this.Tc=function(i){var e=re(i&&i.overlayContent);S.gn.ULS.Se(587487433,n.H,o.Info,"Overlay content: ".concat(e)),S.Da.sendPostMessage(S.ur,yi.Uo,void 0)},this.wa=e,this.ks=t,this.oc=t.wopiPrecheckInfo,this.yc=t.container,this.Xa=t.sessionInformation,this.nc=t.sessionId,this.Ha=t.applicationUrl,this.rc=t.diagnostics.HostInitDiagnostics,this.gn=r,this.fc=s,this.hc=a,this.Cc=c,this.ka=d,this.Qa=l,this.Da=h,this.gc=p,this.za=w,this.Ua=m,this.Wa=g,this.Zo=f,this.Os={officeSessionId:this.nc,officeBootstrapperVersion:T()},Promise&&(this.Va=new Promise((function(i){return S.la=i})));var b=v(window.location.href);(this.$a="",Hi.getBRSValue(Hi.IsAtMentionsEnabled)&&(this.$a=b.nav),void 0!==this.rc)?(b.teamsvisiomode&&(this.gn.ULS.Se(576074626,n.X,o.Warning,"Resetting user click for Teams reboot scenarios"),this.rc.userClickTime=(new Date).getTime()),this.ic=this.rc.userClickTime?new Date(this.rc.userClickTime):void 0,this.Ac=this.rc.officeInitializationTime?new Date(this.rc.officeInitializationTime):void 0):(this.ic=void 0!==this.Xa&&void 0!==this.Xa.DocumentClickTime?this.Xa.DocumentClickTime:void 0,this.Ac=void 0!==this.Xa&&void 0!==this.Xa.HostInitTime?this.Xa.HostInitTime:void 0);this.ic?this.gn.ULS.Se(596459904,n.X,o.Info,"DocumentClickTime: ".concat(this.ic.getTime())):(this.ic=new Date,this.gn.ULS.Se(595686562,n.X,o.Info,"Fallback DocumentClickTime: ".concat(this.ic.getTime()))),this.Ac&&this.gn.ULS.Se(596459905,n.X,o.Info,"hostInitTime: ".concat(this.Ac.getTime())),this.Ga=this.tc(),m||this.registerPostMessageHandlers(),le()}return i.prototype.registerPostMessageHandlers=function(){this.Da.registerMessagePayloadHandler(si.ye,this.ua),this.Da.registerMessagePayloadHandler(si._e,this.lc),this.Da.registerMessagePayloadHandler(si.Ce,this.Ns),this.Da.registerMessagePayloadHandler(i._c,this.pc),this.Da.registerMessagePayloadHandler(si.rt,this.vc),this.Da.registerMessagePayloadHandler(si.Oe,this.wc),this.Da.registerMessagePayloadHandler(si.ht,this.da),this.Da.registerMessagePayloadHandler(i.Fc,this.Cc),Hi.getBRSValue(Hi.CoCommentingAcrossViewAndEditEnabled)&&this.Da.registerMessagePayloadHandler(si.nt,this.dc),this.Xa.SupportsFrameTrustCheck||this.Da.registerMessagePayloadHandler(si.Je,this.Js),this.Da.registerMessagePayloadHandler(si.Ge,this.mc),this.Da.registerMessagePayloadHandler(si.ze,this.Sc),this.Da.registerMessagePayloadHandler(si.pt,this.Tc),this.Da.registerMessagePayloadHandler(si.Ye,this.bc),this.Da.registerMessagePayloadHandler(si.lt,this.Ic)},i.prototype.unregisterPostMessageHandlers=function(){this.Da.removeMessageHandler(si.ye),this.Da.removeMessageHandler(si._e),this.Da.removeMessageHandler(si.Ce),this.Da.removeMessageHandler(i._c),this.Da.removeMessageHandler(si.ht),this.Da.removeMessageHandler(i.Fc),Hi.getBRSValue(Hi.CoCommentingAcrossViewAndEditEnabled)&&this.Da.removeMessageHandler(si.nt),this.Da.removeMessageHandler(si.Je),this.Da.removeMessageHandler(si.Ge),this.Da.removeMessageHandler(si.ze),this.Da.removeMessageHandler(si.pt),this.Da.removeMessageHandler(si.Ye),this.Da.removeMessageHandler(si.lt),this.Da.removeMessageHandler(si.rt),this.Da.removeMessageHandler(si.Oe)},i.prototype.registerEventHandler=function(i,e){switch(i){case se.Unloaded:case se.DocumentReboot:case se.CreateNewDocument:case se.GetAuthToken:case se.GetCustomAuthConfig:case se.MoveToFolder:case se.SharedFilePicker:case se.SetOverlayContent:if(this.Zo[i])throw new Error("Duplicate registration for: "+i);this.Zo[i]=e;break;default:this.Da.registerMessagePayloadHandler(i,e)}},i.prototype.removeEventHandler=function(i,e){switch(i){case se.Unloaded:case se.DocumentReboot:case se.CreateNewDocument:case se.GetAuthToken:case se.GetCustomAuthConfig:case se.MoveToFolder:case se.SharedFilePicker:case se.SetOverlayContent:if(this.Zo[i]!==e)throw new Error("The handler requested to be removed does not exist for the eventType: "+i);delete this.Zo[i];break;default:this.Da.removeMessageHandler(i)}},i.prototype.showApplicationFrame=function(){this.ur.style.opacity="1.0"},i.prototype.hideApplicationFrame=function(){this.ur.style.opacity=i.Ec},i.prototype.Dispose=function(i,e){var t=this;this.gn.ULS.Se(595682585,n.X,o.Info,"VisioWopiApplication.Dispose() Entered"),i||this.ur&&this.ur.parentElement&&this.ur.parentElement.removeChild(this.ur),i?fe(i||!1,this.gn,this.Da,this.ur,(function(){delete t.ja,delete t.Ja,delete t.ur,t.raiseEvent(se.Unloaded,{})}),void 0,e):(delete this.ja,delete this.Ja,delete this.ur)},i.prototype.raiseEvent=function(i,e){var t=this.Zo[i];t&&t(e||{})},i.prototype.activate=function(){this.gn.ULS.Se(595682586,n.X,o.Info,"VisioWopiApplication.Activate() Entered"),this.Ma(!1)},i.prototype.resetInnerApplicationFrameId=function(){this.ur.id=we},i.prototype.getInnerApplicationFrame=function(){return this.ur},i.prototype.getInnerApplicationFramePromise=function(){return this.Va},i.prototype.completeTwoStepFlow=function(i,e){this.gn.ULS.Se(595706829,n.X,o.Info,"VisioWopiApplication.CompleteTwoStepFlow()");try{this.wa=i,void 0!==e&&(this.ac=e),this.wa&&this.Pa&&this.ha()}catch(i){this.gn.ULS.Se(595706830,n.X,o.Error,"VisioWopiApplication.CompleteTwoStepFlow() failed: ".concat(V(i)))}},i.prototype.Boot=function(i){var e=this;void 0===i&&(i=!1),this.gn.ULS.Se(596464402,n.X,o.Info,"VisioWopiApplication.Boot() isBackground:".concat(i)),ke.validateAppModeForBackgroundBoot(i,this.za);try{this.Na(i,this.yc,(function(){try{e.La(i)}catch(i){e.hc(i,e.Os)}}))}catch(i){this.hc(i,this.Os)}},i.prototype.notifyFastPreviewFailed=function(){this.ka?this.ka=!1:this.gn.ULS.Se(596459906,n.X,o.Info,"Fast boot container is not available")},i.prototype.sendCreateNewTemplateId=function(e){void 0!==e&&this.js(i.Vc,e)},i.prototype.sendWACDataPostMessage=function(e){this.Da.sendPostMessage(this.ur,i.Rc,e),this.gn.ULS.Se(595935318,n.X,o.Info,"Document Data Sent with Post Message.")},i.prototype.sendPostMessageForCommand=function(i,e){this.Da.postMessageForCommand(this.ur,i,e)},i.prototype.IsPageViewLoaded=function(){return this.Oa},i.prototype.IsBootComplete=function(){return this.xa},i.prototype.UpdateLogger=function(i){this.gn=i},i.prototype.PostWacToken=function(i,e,t){xi(i,e,this.Da,this.gn,this.Va,t)},i._c="Visio_PageViewLoaded",i.Rc="Visio_DocumentData",i.Vc="TemplateInfo_Ready",i.Fc="Visio_ReadyToReceiveDocData",i.Za="bsdpm",i.Ya="dpmdv",i.ec="dct",i.Ka="wde",i.Ba="BkgWebApplicationFrame",i.highDpiThreshold=1.25,i.Ec="0.0000001",i}();!function(i){i[i.TimerBegin=0]="TimerBegin",i[i.TimerEnd=1]="TimerEnd"}(Re||(Re={}));var Oe=function(){function i(){}return i.RecordTelemetryData=function(i,e,t,r,s,a){if(Hi.getBRSValue(Hi.IsLongPoleInfraEnabled)){var c={FeatureName:i,GUID:e,ComponentName:t,EventCategory:r===Re.TimerBegin?"BeginTimeStamp":"EndTimeStamp",MilliSecondsSinceEpoch:null!=s?s.getTime().toString():"-1",Value:null!=s?s.toUTCString():"-1"};a&&a.ULS.Se(523375501,n.X,o.Info,JSON.stringify(c))}},i}();function xe(i,e,t){var n=void 0;((null==i?void 0:i.userClickTime)?n=i.userClickTime:(null==i?void 0:i.hostPageFirstFlushTime)&&(n=i.hostPageFirstFlushTime),(null==i?void 0:i.officeBootstrapperStartTime)&&n)&&(Math.floor((i.officeBootstrapperStartTime-n)/1e3)<60&&(Oe.RecordTelemetryData("bootPerf","constGuid","hostDuration",Re.TimerBegin,new Date(n),t),Oe.RecordTelemetryData("bootPerf","constGuid","hostDuration",Re.TimerEnd,new Date(i.officeBootstrapperStartTime),t)));if((null==i?void 0:i.officeBootstrapperStartTime)&&Oe.RecordTelemetryData("bootPerf","constGuid","bootStrapperStartToVisioFrameCreateDuration",Re.TimerBegin,new Date(i.officeBootstrapperStartTime),t),null==e?void 0:e.officeFrameCreateTime){var o=new Date(e.officeFrameCreateTime);Oe.RecordTelemetryData("bootPerf","constGuid","visioFrameToAppCompleteDuration",Re.TimerBegin,o,t),Oe.RecordTelemetryData("bootPerf","constGuid","bootStrapperStartToVisioFrameCreateDuration",Re.TimerEnd,o,t)}if(null==e?void 0:e.appCompletedTime){var r=new Date(e.appCompletedTime);Oe.RecordTelemetryData("bootPerf","constGuid","visioFrameToAppCompleteDuration",Re.TimerEnd,r,t)}if(null==e?void 0:e.documentLoadedTime){var s=new Date(e.documentLoadedTime);Oe.RecordTelemetryData("bootPerf","constGuid","fastViewDuration",Re.TimerEnd,s,t)}}var ke=function(){function i(e,t,r,s,a,c,u,d,l,f){void 0===l&&(l=De.Active),void 0===f&&(f=!1);var v,m=this;this.Pc=!1,this.Oc=!1,this.xc=!1,this.kc=!1,this.Wc=!1,this.Uc=!1,this.Dc=!1,this.Nc=!1,this.Bc=!1,this.Mc=!1,this.Hc=!1,this.Lc=!1,this.Jc=!1,this.jc=!1,this.Gc=!1,this.Wa=!1,this._ImageDataFormat="data:image/png;base64,{0}",this.Zo={},this.zc=function(){return"teams"===m.qc.toLowerCase()},this.Kc=function(){m.Ws.registerMessagePayloadHandler(si.cn,m.Xc),m.Ws.registerMessagePayloadHandler(si.tn,m.$c),m.Ws.registerMessagePayloadHandler(si.on,m.Zc),m.Ws.registerMessagePayloadHandler(si.an,m.Yc)},this.Qc=function(){m.Ws.removeMessageHandler(si.cn),m.Ws.removeMessageHandler(si.tn),m.Ws.removeMessageHandler(si.on),m.Ws.removeMessageHandler(si.an)},this.iu=function(i){if(!m.eu)throw new TypeError("VisioApplication:disposeWopiApplication() Visio wopi Application is null");m.eu.Dispose(i),i||(m.eu=void 0)},this.tu=function(){ee.dispose()},this.nu=function(i){m.eu&&m.eu.IsBootComplete()||!m.isActive()||m.gn.ULS.Se(587580759,n.X,o.Warning,"Wopi Boot not completed even after ".concat(i," milliseconds"))},this.ou=function(){return m.za===ki.EDIT||m.za===ki.EDIT_NEW},this.Ea=function(i){m.za===ki.EDIT_NEW&&(i&&i.NewFilePath?(qi(i.NewFilePath),i.UpdatedPageTitle&&(document.title=i.UpdatedPageTitle)):m.gn.ULS.Se(595722523,n.H,m.ru?o.Warning:o.Info,"Either NewFileInfo or NewFilePath are not provided for a new file."))},this.$c=function(i){if(-1===m.ks.applicationUrl.indexOf("embed")){var e="";i&&i.RefreshOrigin&&(e=i.RefreshOrigin);var t=window.location.href;Hi.getBRSValue(Hi.IsToastUserFixEnabledBRSKey)&&t&&(t=w(t,"wdToastUser")),Hi.getBRSValue(Hi.IsContextAppRefreshFixEnabledBRSKey)&&t&&(t=w(t,"wdActivePageId"),t=w(t,"wdPageScale"),t=w(t,"wdPageCenterX"),t=w(t,"wdPageCenterY")),m.za===ki.EDIT?t&&(t=p(t,"action","edit",!0),e&&(t=p(t,"OR",e,!0)),qi(t)):m.za===ki.EDIT_NEW&&t&&(t=p(t,"action","edit",!0),e&&(t=p(t,"OR",e,!0)),qi(t=p(t,"wdNewAndOpenCt","0",!0)))}},this.Yc=function(i){var e=window.location.href;"VIEW"===i.toMode||"EDIT"===i.toMode?(e=p(e,"teamsvisiomode",i.toMode,!0),Hi.getBRSValue(Hi.IsFormulaeSerializationRollbackEnabled)&&m.za===ki.EDIT&&"1"===i.wdDisableFormulae&&(e=p(e,"wdDisableFormulae","1",!0)),window.location.href=e):m.gn.ULS.Se(593622414,n.X,o.Warning,"Invalid options received in Visio_DocReboot_HostNav message")},this.Zc=function(){var i=window.location.href;i=p(i,"wdreloadsessionid",m.ks.sessionId,!0);var e=m.ks.sessionId,t=1;Ki(m.ks,"wdreloadcount")&&(t=parseInt(Xi(m.ks,"wdreloadcount"),10)+1),t>Hi.getIntegerBRSValue(Hi.ReloadOnScriptFailMaxLimitBRSKey,3)?m.gn.ULS.Se(590455010,n.X,o.Error,"Visio Boot failed for WACSessionID: "+e+" after"+t+"retries"):(i=p(i,"wdreloadcount",String(t),!0),m.gn.ULS.Se(590455011,n.X,o.Warning,"Refreshing VisioFrame for WACSessionID: "+e+", currentReloadCount: "+t+", UriLen: "+i.length),m.gn.ULS.flush(),window.location.href=i)},this.su=function(i){m.eu=new Pe(m.wa,m.ks,m.gn,m.au,m.cu,m.uu,m.Pc,m.Qa,m.Zo,m.Ws,m.gc,m.za,m.isBackground(),m.Wa),m.du&&m.du(m.eu),m.gn.ULS.Se(596464071,n.X,o.Info,"Boot VisioWopiApplication"),m.eu.Boot(i),m.Oc&&m.eu.hideApplicationFrame()},this.lu=function(){m.gn.ULS.Se(596464079,n.X,o.Info,"VisioApplication.ShowFirstPage()"),Ji(m.ks.applicationUrl)||Oe.RecordTelemetryData("bootPerf","constGuid","fastViewDuration",Re.TimerBegin,new Date,m.gn);try{if(m.fu(m.hu),m.hu.MajorVersion<i.GetMinContentVersion())return void m.gn.ULS.Se(596464080,n.X,o.Warning,"Content bundle version: ".concat(m.hu.MajorVersion," is out of date"));m.Mc=!0,m.pu(m.ks.container),m.vu()}catch(i){m.gn.ULS.Se(596464081,n.X,o.Error,"Failed to boot from the host cache: ".concat(V(i)))}},this.wu=function(e){if(e){m.gn.ULS.Se(596121056,n.X,o.Info,"VisioApplication.TryPrefetchRemainingContent()");try{if(m.fu(m.hu),m.hu.MajorVersion<i.GetMinContentVersion())return void m.gn.ULS.Se(596121057,n.X,o.Warning,"Content bundle version: ".concat(m.hu.MajorVersion," is out of date"));m.mu()}catch(i){m.gn.ULS.Se(596121058,n.X,o.Error,"Failed to pre fetch interactive content from host cache: ".concat(V(i)))}}},this.fu=function(i){if(void 0===i)throw new TypeError("WopiPrecheckInfo.BundleInfo");if(void 0===i.Url)throw new TypeError("WopiPrecheckInfo.BundleInfo.Url");if(void 0===i.MajorVersion)throw new TypeError("WopiPrecheckInfo.BundleInfo.MajorVersion")},this.gu=function(){return""},this.Su=function(i){i.setAttribute("crossorigin","anonymous")},this.bu=function(i){var e=m.Iu;e.style.top=i+"px",e.style.position="absolute",e.style.height="auto",e.style.borderWidth=Bi.ShapePanelBorderWidth+"px",e.style.borderRightStyle="solid",e.style.boxShadow="2px 1px 4px 0 rgba(0,0,0,0.13)",e.style.borderColor="#e1e1e1",e.style.backgroundColor="#f2f2f2",e.style.width=Bi.ShapePanelWidthWithoutBorder+"px",e.style.bottom="0px",e.style.overflow="0";var t=document.createElement("div");t.style.top="50%",t.style.left="50%",t.style.position="absolute",t.style.transform="translateX(-50%) translateY(-50%)",t.style.fontSize="9pt",t.style.fontFamily='"Segoe UI", Arial, Verdana, sans-serif',e.appendChild(t);var n=document.createElement("img");n.style.cssFloat="left",n.style.height="16px",n.style.width="16px",m.Su(n),void 0!==m.Tu?n.src=m.Tu.getLoadingSpinnerGif():n.style.visibility="hidden",t.appendChild(n);var o=document.createElement("div");return o.style.cssFloat="left",o.style.paddingLeft="10px",o.innerText=m.gu(),t.appendChild(o),e},this.pu=function(i){m.Pc||(m.yu=document.createElement("div"),m.yu.id="VisioBootContainer",m.yu.style.width="100%",m.yu.style.height="100%",m.yu.style.visibility="hidden",m.yu.style.position="absolute",m.yu.style.backgroundColor="#F3F2F1",m.yu.style.display="block",m.yu.style.touchAction="none",m.Oc=!1,i.appendChild(m.yu),m.Cu=document.createElement("div"),m.Cu.style.top=Bi.RibbonHeightConsumption+"px",m.Cu.style.left="0px",m.Cu.style.right="0px",m.Cu.style.bottom=Bi.StatusbarHeight+"px",m.Cu.style.position="absolute",m.Cu.style.borderTopColor="#C6C6C6",m.Cu.style.borderTopWidth=Bi.FishbowlBorderTop+"px",m.Cu.style.borderTopStyle="solid",m.Cu.style.backgroundColor=zi(m.za)?"#FFFFFF":"#F9F9F9",m.yu.appendChild(m.Cu),m.Au=document.createElement("div"),m.Au.id="backgroundPage",m.Cu.appendChild(m.Au),m._u=document.createElement("img"),m._u.id="foregroundPage",m._u.style.visibility="hidden",m.Su(m._u),m.Au.appendChild(m._u),m.xc||(m.Fu=document.createElement("div"),m.Fu.style.top="0px",m.Fu.style.height=Bi.HeaderHeight+"px",m.Fu.style.left="0px",m.Fu.style.right="0px",m.Fu.style.position="absolute",Hi.getBRSValue(Hi.Fluent2StyleIsEnabled)?m.Fu.style.backgroundColor=m.zc()?"#F3F2F1":"#FFFFFF":m.Fu.style.backgroundColor=m.zc()?"#F3F2F1":"#3955A3",m.yu.appendChild(m.Fu)),m.xc&&!m.kc||(m.Eu=document.createElement("div"),m.Eu.style.top=(m.kc?0:Bi.HeaderHeight)+"px",m.Eu.style.height="0px",m.Eu.style.left="0px",m.Eu.style.right="0px",m.Eu.style.position="absolute",m.Eu.style.backgroundColor="#E1E1E1",m.yu.appendChild(m.Eu),m.Vu=document.createElement("div"),m.Vu.style.top=(m.kc?0:Bi.HeaderHeight)+"px",m.Vu.style.height=Bi.ToolbarHeightConsumption+"px",m.Vu.style.left="0px",m.Vu.style.right="0px",m.Vu.style.position="absolute",m.Vu.style.backgroundColor="#FFFFFF",m.yu.appendChild(m.Vu)),m.Iu=document.createElement("div"),m.yu.appendChild(m.Iu),m.Iu.style.height="0px",m.Ru=document.createElement("div"),m.Ru.style.top=Bi.RibbonHeightConsumption+Bi.FishbowlBorderTop+"px",m.Ru.style.height=Bi.ProgressImageHeight+"px",m.Ru.style.left="0px",m.Ru.style.right="0px",m.Ru.style.position="absolute",void 0!==m.Tu&&(m.Ru.style.backgroundImage="url(".concat(m.Tu.getDelayLoadingGif(),")"),m.Ru.style.backgroundRepeat="repeat-x"),m.xc&&(m.Cu.style.top=m.kc?Bi.ToolbarHeightConsumption+"px":"0px",m.Ru.style.top=m.kc?Bi.ToolbarHeightConsumption+"px":"0px"),m.yu.appendChild(m.Ru),m.Pu=document.createElement("div"),m.Pu.style.bottom="0px",m.Pu.style.height=Bi.StatusbarHeight+"px",m.Pu.style.left="0px",m.Pu.style.right="0px",m.Pu.style.position="absolute",m.Pu.style.borderTopColor="#C6C6C6",m.Pu.style.borderTopWidth=Bi.StatusbarBorderTop+"px",m.Pu.style.borderTopStyle="solid",m.Pu.style.backgroundColor="#FFFFFF",m.yu.appendChild(m.Pu),m.Pc=!0),m.ou()&&m.Ou()},this.Ou=function(){if(m.ou()){m.gn.ULS.Se(596456520,n.X,o.Info,"Adjusting Boot container for Edit View"),m.xc&&m.gn.ULS.Se(596129762,n.X,o.Warning,"No chrome mode encountered in Edit App");var i=m.xc?Bi.RibbonHeightNoChrome:Bi.RibbonHeightEdit;m.xc?m.Cu.style.top=Bi.RibbonHeightNoChrome+"px":(m.Cu.style.top=Bi.RibbonHeightEdit+"px",m.Vu.style.height=Bi.ToolbarLowerHeightEdit+"px",m.Vu.style.top=Bi.HeaderHeight+Bi.ToolbarUpperHeightEdit+"px",m.Eu.style.height=Bi.ToolbarUpperHeightEdit+"px",m.Eu.style.backgroundColor="#F4F4F4",m.Vu.style.backgroundColor="#F4F4F4"),m.Ru.style.top=i+Bi.FishbowlBorderTop+"px",m.Cu.style.left=Bi.ShapePanelWidthWithBorder+"px",m.Pu.style.left=Bi.ShapePanelWidthWithBorder+"px",m.bu(i)}},this.xu=function(){m.Pc&&(m.gn.ULS.Se(596449229,n.X,o.Info,"Disabling boot container"),m.Pc=!1,m.eu&&m.eu.showApplicationFrame(),m.ku(),m.Jc=!0,m.gn.ULS.Se(595935319,n.X,o.Info,"Ready to send doc data empty response."),m.jc&&m.eu&&m.eu.sendWACDataPostMessage(m.Wu),m.eu&&m.eu.notifyFastPreviewFailed())},this.ku=function(){m.yu&&(m.yu.style.display="none",m.Oc=!1)},this.Uu=function(i){if(m.Pc&&(m.gn.ULS.Se(596449230,n.X,o.Info,"Switching to Wopi App"),m.eu&&m.eu.showApplicationFrame(),window.setTimeout(m.ku,0)),i){var e=parseInt(i[ee.maxStorageQuotaSettingName],10),t=parseInt(i[ee.minEvictTimePeriodSettingName],10);e>0?m.Qa&&(window.setTimeout((function(){return m.Qa.SaveDocument(m.Du,m.Nu)}),ee.documentSaveIdleTimeInMs),window.setTimeout((function(){return ee.EvictStaleCache(1024*e*1024,24*t*60*60*1e3,m.gn)}),ee.cacheEvictIdleTimeInMs)):(m.gn.ULS.Se(595903509,n.X,o.Info,"Evicting all cache as per app settings."),ee.EvictStaleCache(0,0,m.gn))}},this.vu=function(){var i=W(),e=m.Bu(m.hu.Url,Mi.FastViewJson),t=function(i){return m.Mu(i)};if(m._u.onload=function(){var e=W()-i;m.gn.ULS.Se(596464084,n.X,o.Info,"Time spent in getting Image response: ".concat(e,"(ms)")),m.Hu()},m._u.onerror=function(){m.gn.ULS.Se(596464085,n.X,o.Error,"Failed to download the first page image"),m.Mc=!1,m.Hc=!1,m.xu()},(!Hi.getBRSValue(Hi.IsFastViewCacheInTeamsDisabled)||K()!==j.TeamsElectron)&&m.Qa&&m.Qa.IsCacheAvailable())return m.Hc=!0,m.Lu=function(){return m.Qa.DecryptAndValidate((function(i,e){m.Nu=e,m._u.setAttribute("src",m._ImageDataFormat.replace("{0}",e)),t(i)}),(function(){m.Mc=!1,m.Hc=!1,m.Qa.DeleteDocument(),m.xu()}))},void(m.Bc&&(m.Ju=!0));Ni.sendXmlHttpRequest("GET",e,!0,(function(i){t(i),m.gn.ULS.Se(596464082,n.X,o.Info,"Successfully handled doc view response")}),(function(){m.gn.ULS.Se(596464083,n.X,o.Error,"Failed to get doc view response"),m.Mc=!1,m.xu()}),Mi.FastViewJson,m.gn),m._u.src=m.Bu(m.hu.Url,Mi.FastViewImage),m.Ju=!0},this.mu=function(){var i=window.devicePixelRatio>Pe.highDpiThreshold?Mi.docInfoHighDpi:Mi.docInfoNormal,e=m.Bu(m.hu.Url,i);Ni.sendXmlHttpRequest("GET",e,!0,(function(i){m.gn.ULS.Se(596121059,n.X,o.Info,"Received doc info json response. Size: ".concat(i.length))}),(function(){m.gn.ULS.Se(596121088,n.X,o.Error,"Failed to get doc info response")}),i,m.gn,!0)},this.Mu=function(i){try{m.Du=i,m.ju=JSON.parse(i),null==m.ju.Width&&(m.gn.ULS.Se(596115793,n.X,o.Info,"New format of doc view. Filling the old params."),m.ju.Width=m.ju.Pages[0].PageImage.Width,m.ju.Height=m.ju.Pages[0].PageImage.Height,m.ju.OffsetX=m.ju.Pages[0].PageImage.OffsetX,m.ju.OffsetY=m.ju.Pages[0].PageImage.OffsetY,m.ju.Scale=m.ju.Pages[0].PageImage.Scale)}catch(i){return m.gn.ULS.Se(596464086,n.X,o.Error,"Unable to parse JSON response: ".concat(V(i))),void m.xu()}m.Gu=m.zu(m.ju.PageWidth,m.ju.PageHeight),m.qu(m.ju.PageWidth,m.ju.PageHeight,m.Gu),m.Ku(m.ju.Height,m.ju.OffsetX,m.ju.OffsetY,m.Gu)},this.uu=function(i){return m.gn.ULS.Se(595935320,n.X,o.Info,"WAC is ready to receive Doc Data."),m.jc=!0,!m.Jc&&m.Ju||m.eu.sendWACDataPostMessage(m.Wu),i},this.Hu=function(){m.Wc=!0,m.Uc&&m.Xu()},this.zu=function(i,e){var t=96*Bi.FishbowlMarginInches,n=96*Bi.FishbowlMarginInches,o=(m.Cu.offsetWidth-t)/(96*i),r=(m.Cu.offsetHeight-n)/(96*e);return Math.min(o,r)},this.qu=function(i,e,t){var n=m.Cu.offsetWidth-96*i*t,o=m.Cu.offsetHeight-96*e*t;m.Au.style.width=96*i*t+"px",m.Au.style.height=96*e*t+"px",m.Au.style.backgroundColor="white",zi(m.za)||(m.Au.style.borderColor="#C6C6C6",m.Au.style.borderWidth="1px",m.Au.style.borderStyle="solid",m.Au.style.boxShadow="0px 0px 20px #C6C6C6"),m.Au.style.position="absolute",m.Au.style.top=o/2+"px",m.Au.style.left=n/2+"px"},this.Ku=function(i,e,t,n){m._u.style.position="absolute",m._u.style.left=96*e*n+"px",m._u.style.top=m.Au.clientHeight-96*(i+t)*n+"px",m.Uc=!0,m.Wc&&m.Xu()},this.Xu=function(){if(m.eu&&m.eu.IsBootComplete())m.gn.ULS.Se(596129763,n.X,o.Warning,"WOPI Boot already completed, not switching to Fast View");else if(m.eu&&m.eu.IsPageViewLoaded())m.gn.ULS.Se(595969243,n.X,o.Warning,"WOPI Page View already loaded, not switching to Fast View");else{if(Hi.getBRSValue(Hi.FastViewForMRUFixEnabledBRSKey)&&m.$u!==De.Active)return m.gn.ULS.Se(592470212,n.X,o.Info,"MakeFastViewVisible called in inactive VisioApplication, skipping it for now"),void(m.Zu=!0);if(m.Yu=m._u.height,m.Qu=m._u.width,m._u.width=96*m.ju.Width*m.Gu,m._u.height=96*m.ju.Height*m.Gu,m._u.style.visibility="visible",m.yu.style.display="block",m.yu.style.visibility="visible",m.Oc=!0,m.eu&&m.eu.hideApplicationFrame(),m.ed=new Date,m.Lc=!0,m.gn.ULS.Se(596453598,n.X,o.Info,"Fast View Visible (PLT) Time: ".concat(m.ed.getTime())),m.za===ki.EDIT&&m.td){var i=m.ed.getTime()-m.td;m.gn.ULS.Se(596452765,n.X,o.Info,"Fast View Switch To Edit Visible (PLT) Time: ".concat(i))}window.setTimeout(m.nd,15e3),(!m.Nu||m.Nu.length<=0)&&(m.Nu=$i(m._u,m.Qu,m.Yu)),m.Wu[Mi.FastViewImage]=m.Nu,m.Wu[Mi.FastViewJson]=m.Du,m.Jc=!0,m.gn.ULS.Se(595935321,n.X,o.Info,"Doc Data is ready to send with Post Message."),m.jc&&m.eu.sendWACDataPostMessage(m.Wu),m.gn.ULS.Se(595907484,n.X,o.Info,"Loaded from browser cache: ".concat(m.Hc))}},this.nd=function(){m.eu&&!m.eu.IsBootComplete()&&(m.gn.ULS.Se(596129792,n.X,o.Warning,"WOPI boot taking too long, time since FastView: ".concat(15e3)),m.Uu(null))},this.au=function(i,e){m.gn.ULS.Se(596457106,n.X,o.Info,"Initialization succeeded Time: ".concat(W())),e&&e.VisioEarlyToolbarEnabled&&"true"===e.VisioEarlyToolbarEnabled.toString().toLowerCase()?m.gn.ULS.Se(595654606,n.X,o.Verbose,"Early toolbar enabled, so skipping switching to visioframe here"):m.Uu(e),i.cacheAboutToExpire=!1,m.Mc&&!i.cacheHit&&(i.cacheAboutToExpire=!0),i.cacheHit=m.Mc,i.documentLoadedFromWopiPrecheckInfo=m.Lc,m.Lc&&(i.documentLoadedTime=m.ed.getTime()),m.od.stop();var t=m.od.getVisibilityChangeEvents();if(null!=t&&t.length>0){for(var r=0,s=t;r<s.length;r++){var a=s[r];if("hidden"===(null==a?void 0:a.visibility)){i.documentLoadedWithTabSwitch=!0;break}}m.gn.ULS.Se(596457107,n.X,o.Info,"Visibility Change Events:"+JSON.stringify(t))}m.ks.pageStateObserver.dispose(),m.ks.fnOnInitializeSuccess(m,i),m.rd(i),ti("visio",m.gn),m.gn.ULS.flush(),N(m.ks.remoteTelemetryUrl,"Visio","bootSuccess")},this.cu=function(i,e){m.gn.ULS.Se(596464088,n.X,o.Error,"Initialize failed due to error ".concat(JSON.stringify(i))),m.Uu(null),e.cacheHit=m.Mc,e.documentLoadedFromWopiPrecheckInfo=m.Lc,m.od.stop(),m.ks.pageStateObserver.dispose(),m.ks.fnOnInitializeFailure({errorType:di.AppInitError,errorObject:i},e),m.rd(e),m.gn.ULS.flush(),N(m.ks.remoteTelemetryUrl,"Visio","bootFailure")},this.Bu=function(i,e){if(!i||-1===i.indexOf("{0}"))throw new TypeError("invalid content URL");if(!e)throw new TypeError("invalid content id");return decodeURI(i).replace("{0}",e)},this.rd=function(i){var e,t,r,s,a;i&&(Ji(m.ks.applicationUrl)||xe(m.ks.diagnostics.HostInitDiagnostics,i,m.gn),m.gn.ULS.Se(595981388,n.X,o.Info,JSON.stringify({BootDiagnostics:i,hostDiagnostics:m.ks.diagnostics.HostInitDiagnostics,navigationStartTime:Zi(),isJSAPIV2:"false",localCacheHit:m.Hc?"true":"false",compressedView:m.ju&&m.ju.IsCompressed?"true":"false",backgroundBoot:Ji(m.ks.applicationUrl),appMode:m.za.toString()})),window._pageTimings=null!==(e=window._pageTimings)&&void 0!==e?e:{},i.documentLoadedTime&&(null===(t=m.ks.diagnostics.HostInitDiagnostics)||void 0===t?void 0:t.hostInitializeCallTime)&&(window._pageTimings.Visio_Perf_PLT=i.documentLoadedTime-(null===(r=m.ks.diagnostics.HostInitDiagnostics)||void 0===r?void 0:r.hostInitializeCallTime)),i.appCompletedTime&&(null===(s=m.ks.diagnostics.HostInitDiagnostics)||void 0===s?void 0:s.hostInitializeCallTime)&&(window._pageTimings.Visio_Perf_ILT=i.appCompletedTime-(null===(a=m.ks.diagnostics.HostInitDiagnostics)||void 0===a?void 0:a.hostInitializeCallTime)))},this.Xc=function(i){m.gn.ULS.Se(595654607,n.X,o.Info,"".concat(JSON.stringify(i))),(m.Dc&&m.za===ki.EDIT||i&&i.Settings&&i.Settings.VisioEarlyToolbarEnabled&&"true"===i.Settings.VisioEarlyToolbarEnabled.toString().toLowerCase())&&m.Uu(i.Settings)},this.sd=new Date,this.ks=e,this.Tu=s,this.od=r,this.gn=t,this.za=a,this.Ws=u,this.Zo=c,this.$u=l,this.gc=new hi(t),this.qc=h(this.ks.applicationUrl,"uih"),this.qc&&(this.qc=this.qc.toLowerCase()),this.Zu=!1,this.Wa=f,this.gn.ULS.Se(596457105,n.X,o.Info,"Created visio application Time: ".concat(this.sd.getTime())),this.Wu={},this.Ju=!1,Promise&&(this.ad=new Promise((function(i){return m.du=i})));var g=-1!==e.applicationUrl.indexOf("wdDisableBCache");e.sessionInformation&&e.sessionInformation.WdParams&&(g=void 0!==e.sessionInformation.WdParams.wdDisableBCache),g||(this.Qa=ee.Create(e.sessionInformation.UserId,null===(v=e.wopiInfo)||void 0===v?void 0:v.WopiSrc,e.wopiPrecheckInfo.ETag,t)),this.ru=i.isInstantBootMode(this.za,this.ks.applicationUrl),this.ud=d,this.isBackground()||this.Kc()}return i.prototype.unregisterAppLevelPostMessageHandlers=function(){this.Gc||(this.eu&&this.eu.unregisterPostMessageHandlers(),this.Qc(),this.Gc=!0)},i.prototype.registerAppLevelPostMessageHandlers=function(){this.Ws.activate(this.getInnerApplicationFrame()),this.Kc(),this.eu&&this.eu.registerPostMessageHandlers()},i.prototype.isBackground=function(){return this.$u===De.Background},i.prototype.isActive=function(){return this.$u===De.Active},i.prototype.getWopiInfo=function(){return this.ks.wopiInfo},i.prototype.getNewFileInfo=function(){return this.ac},i.prototype.GetApplicationType=function(){return"Visio"},i.prototype.GetVersion=function(){return T()},i.prototype.GetSessionId=function(){return this.ks.sessionId},i.prototype.RegisterEventHandler=function(i,e){this.eu&&this.eu.registerEventHandler(i,e)},i.prototype.RemoveEventHandler=function(i,e){this.eu&&this.eu.removeEventHandler(i,e)},i.prototype.RegisterErrorHandler=function(i){throw void 0!==i&&(this.dd=i),Error("Not Implemented")},i.prototype.RemoveErrorHandler=function(i){throw void 0!==i&&delete this.dd,Error("Not Implemented")},i.prototype.PostCommand=function(i,e){this.eu.sendPostMessageForCommand(i,e)},i.prototype.Dispose=function(i){if(this.gn.ULS.Se(595682625,n.X,o.Info,"VisioApplication.Dispose() Disposing Active Frame appMode:".concat(this.za,", appState:").concat(this.$u)),this.$u===De.Disposed){if(!(Hi.getBRSValue(Hi.IsSaveAndCloseRequestInvokedInTeamsEnabled)&&i&&this.ud))throw new TypeError("Trying to Dispose application whose appState is Disposed");return this.gn.ULS.Se(529343379,n.X,o.Info,"Calling appUnloadCallback to dispose active application (Edit Background App) in appMode:".concat(this.za,", appState:").concat(this.$u)),void this.ud({})}this.$u=De.Disposed,this.tu(),this.iu(i),this.ks.sessionInformation.MetaUiHostVersion&&this.unregisterAppLevelPostMessageHandlers(),this.gn.ULS.flushOnClose(),delete this._u,delete this.yu},i.prototype.removeFastView=function(){this.yu&&this.ks.container&&this.ks.container.contains(this.yu)&&this.ks.container.removeChild(this.yu)},i.prototype.updateVisibilityMetrics=function(i){i&&(this.od=i)},i.prototype.activate=function(){if(this.gn.ULS.Se(595682626,n.X,o.Info,"VisioApplication.activate() Activating Background Frame appMode:".concat(this.za,", appState:").concat(this.$u)),this.$u!==De.Background)throw new TypeError("Trying to activate application whose appState is not Background");if(!this.eu)throw new TypeError("VisioApplication:activate() Visio wopi Application is null");this.$u=De.Active,this.Zu&&(this.Zu=!1,this.Xu()),this.eu.activate()},i.prototype.resetInnerApplicationFrameId=function(){this.eu.resetInnerApplicationFrameId()},i.prototype.getInnerApplicationFrame=function(){return this.eu.getInnerApplicationFrame()},i.prototype.getInnerApplicationFramePromise=function(){if(this.ad)return this.ad.then((function(i){return i.getInnerApplicationFramePromise()}))},i.prototype.Complete=function(i,e){var t=this;if(this.gn.ULS.Se(596464068,n.X,o.Info,"VisioApplication.Complete() isBackground:".concat(this.isBackground()," appMode:").concat(this.za)),Hi.getBRSValue(Hi.JsapiV1DiagnosticFixEnabled)&&this.ks.diagnostics.HostInitDiagnostics&&(this.ks.diagnostics.HostInitDiagnostics.hostCompleteCallTime=W()),this.wa=i,this.ks.wopiInfo=i,void 0!==e&&(this.ac=e),this.wa&&this.wa.AccessToken&&this.wa.WopiSrc)if(this.gn.ULS.Se(596464070,n.X,o.Info,"Create VisioWopiApplication"),this.ru)this.eu.completeTwoStepFlow(i,e),this.Ea(e);else try{this.su(this.isBackground()),this.Lu&&(this.gn.ULS.Se(540922266,n.X,o.Info,"Document image/data are present in local cache"),window.setTimeout((function(){t.gn.ULS.Se(540922267,n.X,o.Info,"Loading the fast view from local cache"),t.Lu()}))),this.Ea(e)}catch(i){this.gn.ULS.Se(596464072,n.X,o.Error,"Failure trying to boot the WOPI application: ".concat(V(i))),this.ks.fnOnInitializeFailure({errorType:di.AppInitError,errorObject:i},void 0),N(this.ks.remoteTelemetryUrl,"Visio","bootException")}else this.gn.ULS.Se(596464069,n.X,o.Error,"VisioApplication Invalid WopiInfo"),this.ks.fnOnInitializeFailure({errorType:di.AppInitError,errorObject:new TypeError("wopiInfo")},void 0)},i.prototype.Fail=function(i){this.gn.ULS.Se(596464073,n.X,o.Info,"VisioApplication.Fail() Reason: ".concat(JSON.stringify(i))),this.gn.ULS.flush()},i.prototype.PostWacToken=function(i,e,t){xi(i,e,this.Ws,this.gn,this.getInnerApplicationFramePromise(),t)},i.GetMinContentVersion=function(){return 1},i.validateAppModeForBackgroundBoot=function(i,e){if(i&&e!==ki.EDIT)throw new TypeError("Boot() isBackground can not be true in other than Edit Mode")},i.prototype.addTimerTagForBoot=function(i){var e=this;window.setTimeout((function(){return e.nu(i)}),i)},i.prototype.Boot=function(){(this.gn.ULS.Se(596464074,n.X,o.Info,"VisioApplication.Boot()"),this.gn.ULS.Se(596452560,n.X,o.Info,"Visio Application Mode: ".concat(this.za," , isBackground: ").concat(this.isBackground())),i.validateAppModeForBackgroundBoot(this.isBackground(),this.za),this.Bc=Hi.getBRSValue(Hi.hostCacheForEmbedViewEnabledBRSKey,!0),this.za===ki.VIEW?(this.gn.ULS.Se(596457682,n.X,o.Info,"Enabling fast boot since this is consumption mode"),this.Dc=!0,this.Nc=!0):this.za!==ki.EMBED_VIEW&&this.za!==ki.INTERACTIVE_PREVIEW||!this.Bc?this.za===ki.EDIT&&-1===this.ks.applicationUrl.indexOf("embed=1")&&(this.Dc=!0,this.gn.ULS.Se(594838688,n.X,o.Info,"Enabling wrs fast boot in edit mode")):(this.gn.ULS.Se(595198939,n.X,o.Info,"Enabling fast boot with no chrome mode for Embed View."),this.Dc=!0,this.xc=!0),(this.Dc||this.Nc)&&this.zc()&&this.ks.sessionInformation.HideHeader&&(this.xc=!0),this.xc&&this.zc()&&(this.kc=!0),this.ks.sessionInformation&&this.ks.sessionInformation.WdParams)&&(this.ks.sessionInformation.WdParams.wdPBIView&&(this.gn.ULS.Se(596464075,n.X,o.Info,"No fast boot since the session is in PBI Mode"),this.Dc=!1,this.Nc=!1),this.ks.sessionInformation.WdParams.wdnc&&(this.gn.ULS.Se(596129760,n.X,o.Info,"Boot in no chrome mode"),this.xc=!0));if(-1!==this.ks.applicationUrl.indexOf("wdPBIView")&&(this.gn.ULS.Se(596457683,n.X,o.Info,"No fast boot since the session is in PBI Mode"),this.Dc=!1,this.Nc=!1),-1!==this.ks.applicationUrl.indexOf("wdnc")&&(this.gn.ULS.Se(596129761,n.X,o.Info,"Boot in no chrome mode"),this.xc=!0),-1!==this.ks.applicationUrl.indexOf("wdFastView")&&(this.Dc=!0,this.Nc=!0),window.matchMedia("screen and (-ms-high-contrast: active)").matches&&(this.gn.ULS.Se(596452935,n.X,o.Info,"Running in High Contrast Mode, disable fast view"),this.Dc=!1,this.Nc=!1),this.Dc?this.ks.wopiPrecheckInfo.BundleInfo?(this.gn.ULS.Se(596464076,n.X,o.Info,"Bundle is cached in host, try rendering the first page"),this.hu=this.ks.wopiPrecheckInfo.BundleInfo,this.lu(),this.wu(!1)):this.gn.ULS.Se(596464077,n.X,o.Info,"Did not find the bundle information"):this.gn.ULS.Se(596464078,n.X,o.Info,"Fast View is disabled via configuration"),this.ru)try{this.su(this.isBackground()),this.gn.ULS.Se(595706836,n.X,o.Info,"VisioWopiApplication created in case of instant create-new")}catch(i){this.gn.ULS.Se(595706837,n.X,o.Error,"Failure trying to boot the WOPI application in instant create-new: ".concat(V(i))),this.ks.fnOnInitializeFailure({errorType:di.AppInitError,errorObject:i},void 0)}},i.prototype.updateModeSwitchClickTime=function(){this.ks.diagnostics.AppInitDiagnostics.modeSwitchClickTime=W()},i.prototype.showFasttViewForEditApp=function(){this.za===ki.EDIT?this.ks.wopiPrecheckInfo.BundleInfo?(this.gn.ULS.Se(595648647,n.X,o.Info,"showFasttViewForDirectToEdit(): Bundle is cached in host, try rendering the first page"),this.hu=this.ks.wopiPrecheckInfo.BundleInfo,this.lu(),this.Lu&&this.Lu()):this.gn.ULS.Se(595648648,n.X,o.Info,"showFasttViewForDirectToEdit(): Did not find the bundle information"):this.gn.ULS.Se(595648649,n.X,o.Info,"showFasttViewForDirectToEdit() called for non edit app mode")},i.isInstantBootMode=function(i,e){if(!Hi.getBRSValue(Hi.instantCreateNewLocalStorageKey)||void 0===e)return!1;var t=e.toLowerCase();return-1===t.indexOf("wopisrc")&&(!(i!==ki.EDIT_NEW||!Hi.getBRSValue(Hi.InstantForAllTemplatesEnabledBRSKey)&&-1!==t.indexOf("wdtpl"))||Hi.getBRSValue(Hi.AppShellPrebootEnabledBRSKey)&&-1!==t.indexOf("wdasp"))},i.prototype.updateCreateNewTemplateInfo=function(i){void 0!==this.eu&&this.eu.sendCreateNewTemplateId(i)},i}(),We=function(){function i(i,e){this.ld=!!e&&function(i){return!!i.includes("wise")}(e),this.fd=u(this.ld&&e?e:i),this.hd=this.ld?"":y()}return i.prototype.getDelayLoadingGif=function(){return this.ld?"".concat(this.fd,"/wise/owl/delay.gif"):"".concat(this.fd).concat("/v/","s/").concat(this.hd,"_resources/1033/delay.gif")},i.prototype.getLoadingSpinnerGif=function(){return this.ld?"".concat(this.fd,"/wise/owl/progress.gif"):"".concat(this.fd).concat("/v/","s/").concat(this.hd,"_resources/1033/progress16.gif")},i}(),Ue=function(){function i(){var i=this;if(this.pd=[],this.Zo=[],this.vd=function(){var e={visibility:document.visibilityState,time:W(),initialState:!1};i.pd.push(e);for(var t=0,n=i.Zo;t<n.length;t++){var o=n[t];o&&o(e)}},"hidden"===document.visibilityState){var e={visibility:document.visibilityState,time:W(),initialState:!0};this.pd.push(e)}document.addEventListener("visibilitychange",this.vd)}return i.prototype.registerEventHandler=function(i){this.Zo.push(i)},i.prototype.removeEventHandler=function(i){if(i){var e=this.Zo.indexOf(i);this.Zo.splice(e,1)}},i.prototype.stop=function(){document.removeEventListener("visibilitychange",this.vd)},i.prototype.getVisibilityChangeEvents=function(){return this.pd},i.prototype.dispose=function(){this.stop(),this.Zo=[],this.pd=[]},i}();var De,Ne,Be=function(){function i(e,t,r,s,a,c,u){var d=this;if(this.md=null,this.gd=null,this.Sd=null,this.bd=null,this.Id=null,this.Zo={},this.Td=function(){var i=d.yd,e=i.applicationUrl;if("consumptionview"!==h(e.toLowerCase(),"visioview"))throw new TypeError("applicationUrl does not have VisioView=ConsumptionView query param");e=p(e,"VisioView","EditView",!0),e=p(e,"backgroundsession","1",!0),i.applicationUrl=p(e,"wdIsModeSwitch","1",!0);var t=U(),r=t[0],s=t[1];i.sessionId=r;var a=G({remoteUlsEndpoint:d.yd.applicationBasePath+"RemoteUls.ashx",sessionId:r,uploadCadenceInMs:je}),c=JSON.parse(JSON.stringify(i.sessionInformation));delete c.OwnerId,delete c.SiteId,delete c.TenantId,delete c.UserId,delete c.Upn,delete c.WebId,a.ULS.Se(595682589,n.X,o.Info,"VisioApplicationManager - initializing background Edit session.\n      Init Time: ".concat(W(),",\n      newGuidLogging: ").concat(JSON.stringify(s),",\n      loggableSessionInfo: ").concat(JSON.stringify({hostSessionInformation:c}))),d.Sd=i,d.bd=a,d.Id=ki.EDIT},this.Cd=function(i){var e=i===De.Background;d.gn.ULS.Se(595682590,n.X,o.Info,"Visio Application Manager appMode: ".concat(d.za,", isBackground: ").concat(e));var t=d.gn,r=d.yd;try{var s=d.Da,a=d.za;e&&(d.Td(),r=d.Sd,t=d.bd,a=d.Id);var c=new ke(r,t,d.od,d.Tu,a,d.Zo,s,d.appUnloadHandler,i);return e?d.gd=c:(d.md=c,d.md.addTimerTagForBoot(12e4)),c.Boot(),c}catch(i){return d.gn.ULS.Se(595682591,n.X,o.Error,"Background Edit App ".concat(di.AppInitError,": ").concat(V(i))),t&&t.ULS.flushOnClose(),void r.fnOnInitializeFailure({errorType:di.AppInitError,errorObject:i})}},this.appUnloadHandler=function(){d.md&&d.md.isActive()&&d.md.Dispose(!0)},this.Ad=function(){if(d._d(yi.jo),d.gn.ULS.Se(595682592,n.X,o.Info,"ApplicationManager Visio ViewFrame CLTComplete PostMessage Received"),d.za!==ki.VIEW)throw new TypeError("Active Visio Application mode is not view but received ConsumptionCLTCompletePost Message");var i=d.md.getWopiInfo();if(!i)throw new TypeError("ApplicationManager wopiInfo is null");if(d.gn.ULS.Se(595682593,n.X,o.Info,"Building Background Edit VisioApplication"),d.Cd(De.Background),!d.gd)throw new TypeError("After BuildApplication backgroundEditApp is null");d.gd.Complete(i,d.md.getNewFileInfo())},this.Fd=function(){d.gd?d.Ed():d.gn.ULS.Se(595642373,n.X,o.Warning,"handleVisioViewDisposeBkgFrame backgroundEditApp is null")},this.Vd=function(i){if(d._d(yi.Go),d.gn.ULS.Se(595682594,n.X,o.Info,"ApplicationManager Received SwitchMode PostMessage from Visio View Frame appMode:".concat(d.za)),!d.gd)return d.gn.ULS.Se(595682466,n.X,o.Warning,"handleVisioViewFrameSwitchMode backgroundEditApp is null"),void d._d(yi.qo);d.bd?d.gd.updateVisibilityMetrics(new Ue):d.gn.ULS.Se(595616995,n.X,o.Warning,"handleVisioViewFrameSwitchMode bgLogger is null"),d.md.unregisterAppLevelPostMessageHandlers(),d.gd.registerAppLevelPostMessageHandlers(),d.md.removeFastView(),d.gd.updateModeSwitchClickTime(),d.gd.showFasttViewForEditApp(),d.gd.resetInnerApplicationFrameId(),d.gd.addTimerTagForBoot(12e4),d.Da.registerMessagePayloadHandler(si.en,d.Rd),d.Pd(yi.zo,i)},this.Pd=function(i,e){d.Od(i,e,1)},this.Od=function(i,e,t){if(t>3)switch(d.gn.ULS.Se(595650624,n.H,o.Error,"Attempted to call mode switch, but received no ack from the frame. MessageId: ".concat(i,", Time: ").concat(W())),i){case yi.zo:if(!d.xd)return d.gn.ULS.Se(595650625,n.H,o.Error,"Falling back to legacy way of switching for message timeout. Message: ".concat(i)),void d._d(yi.qo);break;default:return void d.gn.ULS.Se(595650626,n.H,o.Warning,"Invalid message. MessageId: ".concat(i))}d.gn.ULS.Se(595650627,n.H,o.Info,"Sending mode switch message to frame. MessageId: ".concat(i,", Attempt number: ").concat(t,", Time: ").concat(W())),d.kd(i,e),window.setTimeout((function(){return d.Wd(i,e,t)}),1e3)},this.Wd=function(i,e,t){switch(i){case yi.zo:if(d.xd)return;break;default:return void d.gn.ULS.Se(595650628,n.H,o.Warning,"Invalid message. MessageId: ".concat(i))}d.gn.ULS.Se(595650629,n.H,o.Info,"Timed out with no ack. MessageId: ".concat(i)),d.Od(i,e,t+1)},this._d=function(i,e){if(void 0===e&&(e=null),!d.md)throw new TypeError("visio Active Application is null");if(!d.md.getInnerApplicationFrame())throw new TypeError("visio Active Application Frame is null");d.Da.sendPostMessage(d.md.getInnerApplicationFrame(),i,e)},this.kd=function(i,e){if(void 0===e&&(e=null),!d.gd)throw new TypeError("visio Background Edit Application is null");if(!d.gd.getInnerApplicationFrame())throw new TypeError("visio Background Edit Application Frame is null");d.Da.sendPostMessage(d.gd.getInnerApplicationFrame(),i,e)},this.Ud=function(){if(!d.md||!d.gd)throw new TypeError("HandleEditILTCompletePostMessage visioApplicationActive or backgroundEditApp is null");d.md.Dispose(),d.md=null,d.gd.activate(),d.md=d.gd,d.gn=d.bd,d.za=d.Id,d.yd=d.Sd,d.gd=null,d.bd=null,d.Id=null,d.Sd=null},this.Rd=function(i){if(d.gn.ULS.Se(595682624,n.X,o.Info,"ApplicationManager Visio_ACK_ModeSwitch_ToHost Received on ack to Visio_SwitchMode_FromHostFrame"),d.xd=!0,i){if(i.IsSuccess)return void d.Ud();d.gn.ULS.Se(595645409,n.X,o.Warning,"".concat(JSON.stringify(i)))}d._d(yi.qo)},this.Ed=function(){d.gd&&(d.gd.Dispose(),d.gd=null)},this.yd=e,this.gn=t,this.od=r,this.Tu=s,this.za=a,this.Da=c,this.Zo=u,this.xd=!1,this.qc=h(this.yd.applicationUrl,"uih"),this.qc&&(this.qc=this.qc.toLowerCase()),a!==ki.VIEW)throw new TypeError("VisioApplicationManager appMode is not view");this.Da.registerMessagePayloadHandler(si.Qt,this.Ad),this.Da.registerMessagePayloadHandler(si.in,this.Vd),this.Da.registerMessagePayloadHandler(i.Dd,this.Fd)}return i.prototype.buildApplication=function(){return this.Cd(De.Active)},i.prototype.dispose=function(){this.md&&(this.md.Dispose(),this.md=null),this.Ed()},i.Dd="Visio_DisposeBkgFrame",i}();!function(i){i[i.Active=0]="Active",i[i.Background=1]="Background",i[i.Disposed=2]="Disposed"}(De||(De={})),function(i){i[i.Fastfood=0]="Fastfood",i[i.MSIT=1]="MSIT",i[i.Production=2]="Production"}(Ne||(Ne={}));var Me,He,Le,Je,je=6e4,Ge=function(){function i(){var i=this;this.Zo={},this.Nd=!1,this.Bd=function(e,t){!function(i){return!(!Ki(i,"wdreloadsessionid")||!Ki(i,"wdreloadcount"))}(t)?e.ULS.Se(596464066,n.X,o.Info,"VisioBootstrapper - initializing session. Build version: "+i.GetVersion()):e.ULS.Se(590357217,n.X,o.Info,"VisioBootstrapper - Initializing reloaded session.  current Reload count: "+Xi(t,"wdreloadcount")+" Build version: "+i.GetVersion())},this.Md=function(i){if(i&&i.License){var e=Hi.getBRSValue(Hi.DTEEnabledForPlan0BRSKey);"plan1"===i.License||e&&"plan0"===i.License?localStorage.setItem("enableDTE","true"):localStorage.setItem("enableDTE","false")}},this.Hd=function(i){return p(p(i,"jsApi","1"),"jsapiver","v1")}}return i.prototype.GetVersion=function(){return T()},i.prototype.GetMinContentVersion=function(){return ke.GetMinContentVersion()},i.prototype.Prefetch=function(i){},i.prototype.InitializeWopiPending=function(i){var e=this,t=void 0,r=void 0,c=ki.INVALID;try{var d=U(),l=d[0],f=d[1];if(N(Ai(i.ApplicationUrl,l),"Visio","init"),Hi.getBRSValue(Hi.AppShellPrebootEnabledBRSKey)&&this.Nd)return void 0!==this.Ld&&void 0!==i.NewFileTemplateSource&&void 0!==i.NewFileTemplateSource.DocUniqueId&&this.Ld.updateCreateNewTemplateInfo(i.NewFileTemplateSource.DocUniqueId),this.Nd=!1,this.Ld;i.ApplicationUrl.indexOf("wdasp=1")>=0&&(this.Nd=!0),function(i){if(void 0===i)throw new TypeError("initParams");var e=i.Container;if(void 0===e||void 0===e.appendChild)throw new TypeError("Container");var t=i.SessionInformation;if(void 0===t||void 0===t.HostName||void 0===t.HostSessionId||void 0===t.UserId)throw new TypeError("SessionInformation");var n=i.ApplicationUrl;if(void 0===n||"string"!=typeof n)throw new TypeError("ApplicationUrl");var o=i.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===i.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===i.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(i);var w=h(window.location.href,"wdreloadsessionid"),m=h(window.location.href,"wdreloadcount");w&&m&&(l=w),t=G({remoteUlsEndpoint:_i(i.ApplicationUrl)+"RemoteUls.ashx",sessionId:l,uploadCadenceInMs:je});var S=s(i.ApplicationUrl)?Ne.Fastfood:a(i.ApplicationUrl)?Ne.MSIT:Ne.Production;Hi.initialize(S,t);var b=function(i,e,t,n,o,r){void 0===r&&(r=!1),i.SessionInformation.IsCore&&(i.SessionInformation.HideViewerToolbar=!0),function(i,e){var t=i.SessionInformation;t.WdParams||(t.WdParams={});if(t.WdParams.wd)return;e.substring(1).split("&").filter((function(i){if(0===i.indexOf("wd")){var e=i.split("=");e[0].length>2&&(t.WdParams[e[0]]=e[1])}}));var n=i.RebootOverrideData;n&&n.previousSessionId&&(t.WdParams.wdprevioussession=n.previousSessionId)}(i,window.location.search);var s=o||new mi("Visio",t),a=_i(i.ApplicationUrl),c={container:i.Container,sessionInformation:i.SessionInformation,applicationUrl:i.ApplicationUrl,wopiPrecheckInfo:i.WopiPrecheckInfo,applicationCustomSettings:i.ApplicationCustomSettings,diagnostics:{HostInitDiagnostics:i.Diagnostics,ClientDiagnostics:oi(),AppInitDiagnostics:{officeSessionId:e,officeBootstrapperVersion:T(),hostName:i.SessionInformation.HostName},SessionTraces:{}},fnOnInitializeSuccess:i.FnOnInitializeSuccess,fnOnInitializeFailure:i.FnOnInitializeFailure,sessionId:e,applicationBasePath:a,remoteTelemetryUrl:Ci(a,e),wopiInfo:i.WopiInfo,forceSingleStepBoot:r,isCreateNew:i.WopiPrecheckInfo.IsNewFile||g(i.ApplicationUrl,"new"),featureManager:n||gi(i.FnIsFeatureEnabled,t),be:s,newFileTemplateSource:i.NewFileTemplateSource,rebootOverrideData:i.RebootOverrideData,pageStateObserver:new bi(t,!0)};return c.fnOnAppModeSwitched=i.FnOnAppModeSwitched,c}(i,l,t),I=!1;this.Jd=Hi.getBRSValue(Hi.DTEEnabledBRSKey),Hi.getBRSValue(Hi.IsTeamsBackgroundFrameFixEnabled)?this.jd=Hi.getBRSValue(Hi.backgroundEditSessionEnabledKey):this.jd=!i.SessionInformation.MetaUiHostVersion&&Hi.getBRSValue(Hi.backgroundEditSessionEnabledKey),i.SessionInformation.MetaUiHostVersion&&(this.Zo={}),this.Bd(t,b),Hi.getBRSValue(Hi.JsapiV1DiagnosticFixEnabled)&&b.diagnostics.HostInitDiagnostics&&(b.diagnostics.HostInitDiagnostics.hostInitializeCallTime=W(),void 0===b.diagnostics.HostInitDiagnostics.hostPageRedirectCount&&(b.diagnostics.HostInitDiagnostics.hostPageRedirectCount=Yi())),t.ULS.Se(596457679,n.X,o.Info,"Bootstrapper Init Time: ".concat(W())),t.ULS.Se(595937312,n.X,o.Info,JSON.stringify(f));var y=ve(b.applicationUrl,b.sessionInformation);t.ULS.Se(596457680,n.X,o.Info,JSON.stringify({hostSessionInformation:y,clientSignals:oi()})),t.ULS.Se(596457681,n.X,o.Info,JSON.stringify({hostInitDiagnostics:b.diagnostics.HostInitDiagnostics?b.diagnostics.HostInitDiagnostics:"N/A"}));var C=u(i.ApplicationUrl),A=new Oi(C,t);A.activate(),A.registerMessagePayloadHandler(Hi.fromWacVisioFrameBRS,(function(i){Hi.handleVisioBRS(i,t)})),A.registerMessagePayloadHandler(si.Yt,(function(i){e.Md(i)})),b.applicationUrl.indexOf("VisioView=ConsumptionView&embed=1")>=0?c=ki.EMBED_VIEW:b.applicationUrl.indexOf("VisioView=ConsumptionView&InteractivePreview=1")>=0?c=ki.INTERACTIVE_PREVIEW:b.applicationUrl.indexOf("VisioView=ConsumptionView")>=0?c=ki.VIEW:b.applicationUrl.indexOf("VisioView=EditView&New=1")>=0?c=ki.EDIT_NEW:b.applicationUrl.indexOf("VisioView=EditView")>=0?c=ki.EDIT:(c=ki.INVALID,t.ULS.Se(596132872,n.X,o.Error,"Invalid Visio Frame Url")),Hi.getBRSValue(Hi.AppShellPrebootEnabledBRSKey)&&b.applicationUrl.indexOf("wdasp=1")>=0&&(c=ki.EDIT_NEW,b.applicationUrl=p(b.applicationUrl,"VisioView","EditView",!0),b.applicationUrl=p(b.applicationUrl,"New","1",!1));var _=v(window.location.href).teamsvisiomode;b.sessionInformation.MetaUiHostVersion&&!_&&b.rebootOverrideData&&b.rebootOverrideData.mode&&(_=b.rebootOverrideData.mode),_&&b.applicationUrl.indexOf("embed=1")<0&&("edit"===_.toLocaleLowerCase()&&c!==ki.EDIT&&(b.applicationUrl=p(b.applicationUrl,"VisioView","EditView",!0),b.applicationUrl=p(b.applicationUrl,"wdIsModeSwitch","1",!0),c=ki.EDIT),"view"===_.toLocaleLowerCase()&&c!==ki.VIEW&&(b.applicationUrl=p(b.applicationUrl,"VisioView","ConsumptionView",!0),c=ki.VIEW));var F=h(b.applicationUrl,"uih"),E=F&&"teams"===F.toLowerCase();if(this.Jd){var R=h(window.location.href,"action"),P=!1;if(E){var O=v(window.location.href).teamsvisiomode;P=c===ki.VIEW&&!O}var x=ji(b.applicationUrl)||Gi(b.applicationUrl),k=!1;if(Hi.getBRSValue(Hi.DTESafariFixEnabledBRSKey))K()===j.Safari&&0===R.length&&(k=!0);if(!k&&("default"===R||P||Hi.getBRSValue(Hi.DTESharingFixEnabledBRSKey)&&!i.WopiPrecheckInfo.ReadOnly&&!x&&!E&&0===R.length))"true"===localStorage.getItem("enableDTE")&&(b.applicationUrl=p(b.applicationUrl,"VisioView","EditView",!0),c=ki.EDIT,I=!0)}if(E&&(t.ULS.Se(545813153,n.X,o.Info,"Show Visio viewer react toolbar in Teams"),b.applicationUrl=p(b.applicationUrl,"enableToolbarInTeams","true")),Hi.getBRSValue(Hi.TypeScriptLocalStorageEnabled)){var D=localStorage.getItem("UseTypeScriptJS");D&&(b.applicationUrl=p(b.applicationUrl,"wdVisioTS",D))}b.applicationUrl=this.Hd(b.applicationUrl);var B=new Ue;if(void 0!==i.BootstrapperUrl?r=new We(i.BootstrapperUrl,i.BootstrapperUrl):t.ULS.Se(596457563,n.X,o.Warning,"Could not determine visio resources URL"),Qi(),this.jd&&c===ki.VIEW){var M=new Be(b,t,B,r,c,A,this.Zo);return t.ULS.Se(595682587,n.X,o.Info,"Building VisioApplication in appMode ".concat(c)),this.Ld=M.buildApplication(),this.Ld}return t.ULS.Se(595682588,n.X,o.Info,"BRS isUnifiedBackgroundAppBRSEnabled: ".concat(this.jd,", appMode: ").concat(c)),void 0!==i.BootstrapperUrl&&this.Preconnect(i.BootstrapperUrl),this.Ld=new ke(b,t,B,r,c,this.Zo,A,void 0,De.Active,I),this.Ld.addTimerTagForBoot(12e4),this.Ld.Boot(),this.Ld}catch(e){return t&&(t.ULS.Se(596464067,n.X,o.Error,"".concat(di.AppInitError,": ").concat(V(e))),t.ULS.flushOnClose()),void(i&&(i.ApplicationUrl&&N(Ai(i.ApplicationUrl,void 0),"Visio","bootException"),i.FnOnInitializeFailure&&i.FnOnInitializeFailure({errorType:di.AppInitError,errorObject:e})))}},i.prototype.Preconnect=function(i){var e=ui();e.shouldPreconnect()&&e.preconnect(i)},i}();!function(i){i.Unknown="UNKNOWN",i.Initialized="INITIALIZED",i.Prebooted="PREBOOTED",i.Booting="BOOTING",i.Booted="BOOTED",i.Failed="FAILED",i.Disposing="DISPOSING",i.Disposed="DISPOSED"}(Me||(Me={})),function(i){i.appReboot="appReboot",i.boot="boot",i.closeTab="closeTab",i.createNew="createNew",i.dispose="dispose",i.frameTrust="frameTrust",i.getAuthToken="getAuthToken",i.getHostKeyValue="getHostKeyValue",i.handleBootState="handleBootState",i.postWacToken="postWacToken",i.rename="rename",i.setOverlayContent="setOverlayContent",i.storeHostKeyValue="storeHostKeyValue",i.switchMode="switchMode",i.updateBootComplete="updateBootComplete",i.setWacFlightValue="setWacFlightValue"}(He||(He={})),function(i){i.AccessibilityLoopCompleted="AccessibilityLoopCompleted",i.ActionCompleted="ActionCompleted",i.BrowserEvent="BrowserEvent",i.CAAEMessage="CAAEMessage",i.Close="Close",i.InitEnd="InitEnd",i.Conversation="Conversation",i.CopyAndEdit="CopyAndEdit",i.CreateNewDocument="CreateNewDocument",i.Download="Download",i.Edit="Edit",i.Error="Error",i.FileEmbed="FileEmbed",i.FileProperties="FileProperties",i.FileRenamed="FileRenamed",i.FileVersions="FileVersions",i.FrameStateChanged="FrameStateChanged",i.FrameTrust="FrameTrust",i.GetAccessToken="GetAccessToken",i.GetAuthToken="GetAuthToken",i.GetCustomAuthConfig="GetCustomAuthConfig",i.GetWopiInfoFromUrl="GetWopiInfoFromUrl",i.GetDavUrlFromIds="GetDavUrlFromIds",i.ModeSwitched="ModeSwitched",i.MoveToFolder="MoveToFolder",i.OpenInMobileApp="OpenInMobileApp",i.OpenInBrowser="OpenInBrowser",i.OpenInClient="OpenInClient",i.PageChanged="PageChanged",i.PushState="PushState",i.Reboot="Reboot",i.RedeemForCommenting="RedeemForCommenting",i.RefreshSessionInfo="RefreshSessionInfo",i.ReplyWithChanges="ReplyWithChanges",i.ReportAbuse="ReportAbuse",i.SharedFilePicker="SharedFilePicker",i.SaveStatus="SaveStatus",i.Share="Share",i.ShareForm="ShareForm",i.SignIn="SignIn",i.SplashScreenShown="SplashScreenShown",i.UserAccessAndPermissions="UserAccessAndPermissions",i.UserActivity="UserActivity",i.UserEditActivity="UserEditActivity",i.Workflow="Workflow",i.ZoomChanged="ZoomChanged",i.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",i.LoadingStatus="LoadingStatus",i.SwitchNotebook="SwitchNotebook",i.FailedBootCheckFileInfo="FailedBootCheckFileInfo",i.GetTeamsUsers="GetTeamsUsers",i.SendTeamsUserMention="SendTeamsUserMention",i.NavigateBackToHost="NavigateBackToHost",i.GetClientUrlComplete="GetClientUrlComplete",i.GetWebUrlComplete="GetWebUrlComplete",i.CopyLinkComplete="CopyLinkComplete",i.SendConversationId="SendConversationId",i.CloseTeamsConversation="CloseTeamsConversation",i.PageLoaded="PageLoaded",i.FrameChanged="FrameChanged"}(Le||(Le={}));var ze=((Je={})[Ti.boot]={Gd:He.boot},Je[Ti.createNew]={Gd:He.createNew},Je[Ti.dispose]={Gd:He.dispose},Je[Ti.postWacToken]={Gd:He.postWacToken},Je[Ti.rename]={Gd:He.rename},Je[Ti.switchMode]={Gd:He.switchMode},Je[si.Ae]={Gd:He.handleBootState},Je[si.Ve]={Gd:He.closeTab},Je[si.Je]={Gd:He.frameTrust},Je[si.Ge]={Gd:He.getAuthToken},Je[si.qe]={Gd:He.getHostKeyValue},Je[si.rt]={Gd:He.appReboot},Je[si.pn]={Gd:He.setWacFlightValue},Je[si.pt]={Gd:He.setOverlayContent},Je[si.St]={Gd:He.storeHostKeyValue},Je[si.yt]={Gd:He.updateBootComplete},Je[Ti.blurFocus]={zd:yi.to},Je[Ti.continueAccessibilityLoop]={zd:yi.ao},Je[Ti.grabFocus]={zd:yi.co},Je[Ti.moveToFolder]={zd:yi.Ye},Je[Ti.popState]={zd:yi.ho},Je[Ti.sendChannelId]={zd:yi.po},Je[Ti.sendConvId]={zd:yi.vo},Je[Ti.teamsUsersReply]={zd:yi.wo},Je[Ti.teamsUserMentionReply]={zd:yi.mo},Je[Ti.backButtonPressed]={zd:yi.So},Je[Ti.getClientUrl]={zd:yi.bo},Je[Ti.getWebUrl]={zd:yi.Io},Je[Ti.sendAccessToken]={zd:yi.Co},Je[Ti.sendAuthToken]={zd:yi.Ao},Je[Ti.sendHWRTelemetry]={zd:yi.Jo},Je[Ti.sendCustomAuthConfig]={zd:yi._o},Je[Ti.sendDavUrl]={zd:yi.Oo},Je[Ti.sendEmbeddedViewUrl]={zd:yi.Eo},Je[Ti.sendFrameTrustResult]={zd:yi.Je},Je[Ti.sendSessionInfo]={zd:yi.Vo},Je[Ti.sendUserAccessAndPermissions]={zd:yi.Ro},Je[Ti.sendWopiInfo]={zd:yi.Po},Je[Ti.signalShared]={zd:yi.Lo},Je[Ti.sendOwlFrameDiagnostics]={zd:yi.To},Je[Ti.completeSharedFilePicker]={zd:yi.lt},Je[si.Ie]={qd:Le.AccessibilityLoopCompleted},Je[si.Te]={qd:Le.ActionCompleted},Je[si.Fe]={qd:Le.BrowserEvent},Je[si.Rt]={qd:Le.CAAEMessage},Je[si.Ee]={qd:Le.Close},Je[si.Re]={qd:Le.Conversation},Je[si.Pe]={qd:Le.CopyAndEdit},Je[si.Oe]={qd:Le.CreateNewDocument},Je[si.ke]={qd:Le.Download},Je[si.We]={qd:Le.Edit},Je[si.Ue]={qd:Le.Error},Je[si.De]={qd:Le.FileEmbed},Je[si.Ne]={qd:Le.FileProperties},Je[si.Be]={qd:Le.FileRenamed},Je[si.He]={qd:Le.FileVersions},Je[si.je]={qd:Le.GetAccessToken},Je[si.Xe]={qd:Le.GetDavUrlFromIds},Je[si.ze]={qd:Le.GetCustomAuthConfig},Je[si.Ke]={qd:Le.GetWopiInfoFromUrl},Je[si.Le]={qd:Le.FrameStateChanged},Je[si.Ze]={qd:Le.ModeSwitched},Je[si.Ye]={qd:Le.MoveToFolder},Je[si.Qe]={qd:Le.OpenInMobileApp},Je[si.it]={qd:Le.OpenInBrowser},Je[si.et]={qd:Le.OpenInClient},Je[si.tt]={qd:Le.PageChanged},Je[si.ot]={qd:Le.PushState},Je[si.st]={qd:Le.RedeemForCommenting},Je[si.ct]={qd:Le.RefreshSessionInfo},Je[si.ut]={qd:Le.ReplyWithChanges},Je[si.lt]={qd:Le.SharedFilePicker},Je[si.dt]={qd:Le.ReportAbuse},Je[si.ft]={qd:Le.SaveStatus},Je[si.vt]={qd:Le.Share},Je[si.wt]={qd:Le.ShareForm},Je[si.gt]={qd:Le.SignIn},Je[si.At]={qd:Le.UserAccessAndPermissions},Je[si._t]={qd:Le.UserActivity},Je[si.Ft]={qd:Le.UserEditActivity},Je[si.Et]={qd:Le.Workflow},Je[si.Vt]={qd:Le.ZoomChanged},Je[si.Bt]={qd:Le.AcquireOAuthTokenTeams},Je[si.$e]={qd:Le.LoadingStatus},Je[si.Mt]={qd:Le.SwitchNotebook},Je[si.Ht]={qd:Le.FailedBootCheckFileInfo},Je[si.Lt]={qd:Le.GetTeamsUsers},Je[si.Jt]={qd:Le.SendTeamsUserMention},Je[si.jt]={qd:Le.NavigateBackToHost},Je[si.Gt]={qd:Le.GetClientUrlComplete},Je[si.zt]={qd:Le.GetWebUrlComplete},Je[si.qt]={qd:Le.CopyLinkComplete},Je[si.Kt]={qd:Le.SendConversationId},Je[si.Xt]={qd:Le.CloseTeamsConversation},Je[si.$t]={qd:Le.PageLoaded},Je[si.fn]={qd:Le.InitEnd},Je[si.hn]={qd:Le.SplashScreenShown},Je),qe=function(){function i(i,e,t,r,s,a,c){var u,d,l=this;this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.pendingReboot=!1,this.skipWopiValidation=!1,this.skipFileNameCheck=!1,this.appContext={},this.isLoggerFromOwl=!1,this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.remoteTelemetryUrl="",this.Kd={},this.onMessage=function(i){var e=i.MessageId,t=i.Values||{},r=l.Kd[e];if(r&&r.length>0)l.Xd(e,t);else{var s=ze[e];if(s){var a=s.Gd,c=s.qd;a?(l.logger.ULS.Se(574654543,n.H,o.Info,"Running flow: ".concat(a)),l.$d[a](e,t,l,l.Zd[a]).catch((function(i){l.Yd(a,i)}))):c&&(c===Le.Share&&(t.sendTimeAsClickTime=i.SendTime),l.raiseEvent(c,t))}}},this.Yd=function(i,e){l.logger.ULS.Se(596459925,n.H,o.Error,"".concat(i," flow error: ").concat(V(e))),l.remoteTelemetryUrl&&N(l.remoteTelemetryUrl,l.appInfo.name,"flowException")},this.Xd=function(i,e){l.logger.ULS.Se(574654544,n.H,o.Info,"Dispatching action: ".concat(i));for(var t=l.Kd[i].slice().reverse(),r=t.length-1;r>-1;r-=1)try{t[r](i,e)}catch(e){l.logger.ULS.Se(596444186,n.H,o.Error,"".concat(i," action handler error: ").concat(V(e)))}return Promise.resolve({completion:"success"})},this.state=Me.Unknown;var f=U(),h=f[0],p=f[1];this.isLoggerFromOwl=!!t.logger,this.logger=null!==(d=t.logger)&&void 0!==d?d:G(),this.logger.ULS.Se(593506837,n.H,o.Info,JSON.stringify(p)),this.sessionId=h,this.hostSessionId=t.hostSessionId,this.host=i.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=i.user,this.bootstrapperUrl=i.bootstrapperUrl,this.ui=i.ui||{},this.viewMode=i.viewMode,this.application=r,this.appInfo=e,this.session=s,this.featureManager=gi(i.host.capabilities&&i.host.capabilities.isFeatureEnabledCallback,this.logger),this.be=new mi(e.name,this.logger),this.preloader=e.preloader,u=a(this.featureManager),this.$d=u[0],this.Zd=u[1],this.Qd=c,this.clientDiagnostics=oi(),this.pageStateObserver=new bi(this.logger,!0),this.authTokenTrustValidator=new hi(this.logger)}return Object.defineProperty(i.prototype,"diagnostics",{get:function(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}},enumerable:!1,configurable:!0}),i.prototype.raiseEvent=function(i,e){this.logger.ULS.Se(574654541,n.H,o.Info,"Raising event: ".concat(i));try{this.Qd(i,e)}catch(i){this.logger.ULS.Se(593506838,n.H,o.Error,"Event handler error: ".concat(V(i)))}},i.prototype.addActionHandler=function(i,e){this.Kd[i]||(this.Kd[i]=[]),this.Kd[i].push(e)},i.prototype.removeActionHandler=function(i,e){var t=this.Kd[i];if(t&&t.length>0){var n=t.indexOf(e);n>-1&&t.splice(n,1)}},i.prototype.run=function(i,e,t){var r=this;if(this.state===Me.Disposed&&this.backgroundSession)return this.logger.ULS.Se(525203609,n.H,o.Info,"Redirecting to background session: ".concat(i)),this.backgroundSession.run(i,e,t);var s=[],a=this.Kd[i];if(a&&a.length>0)s.push(this.Xd(i,e));else{var c=ze[i];if(c){var u=c.Gd,d=c.zd;if(u){this.logger.ULS.Se(574654542,n.H,o.Info,"Running flow: ".concat(u));var l=this.$d[u](i,e,this,this.Zd[u],t).catch((function(i){return r.Yd(u,i),{completion:"failure",errorSource:"jsapi",error:i}}));s.push(l)}else d&&(this.container&&this.container.postMessage(d,e),s.push(Promise.resolve({completion:"success"})))}else s.push(Promise.resolve({completion:"failure"})),this.logger.ULS.Se(593500189,n.H,o.Warning,"Unhandled command: ".concat(i))}return Promise.race(s)},i.prototype.dispose=function(){if(this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.be.dispose(),this.pageStateObserver.dispose(),this.authTokenTrustValidator.dispose(),this.Kd={},!this.pendingReboot){var i=this.application.sessions,e=i.indexOf(this.session);e>-1&&i.splice(e,1)}},i}();var Ke=function(){function i(i,e,t,n,o,r){var s=this;!function(i){if(!i)throw new TypeError("SessionInitParams");if(!i.hostSessionId)throw new TypeError("HostSessionId")}(t);this.il=new qe(i,e,t,n,this,r,(function(i,e){return o({type:i,data:e,session:s})})),this.il.state=Me.Initialized}return Object.defineProperty(i.prototype,"id",{get:function(){return this.il.sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"diagnostics",{get:function(){return this.il.diagnostics},enumerable:!1,configurable:!0}),i.prototype.run=function(i,e,t){return this.il.run(i,e,t)},i.prototype.boot=function(i,e){return this.il.run(Ti.boot,i,e)},i.prototype.dispose=function(i){return this.il.run(Ti.dispose,void 0,i)},i}(),Xe=function(){function i(i,e,t){var r,s,a=this;this.Yo="",this.Qo="",this.ir=[],this.tr=!1,this.nr=!1,this.er=!1,this.or=!1,this.el=function(i){var e,t=!1,r=!0,s="",c=!1;if(a.tl&&a.tl.contentWindow&&(t=!0,r=i.source===a.tl.contentWindow),i.origin&&(c=(s=d(i.origin,2).toLowerCase())===a.Qo||a.ir.includes(s)),!a.tr&&(!a.nr||c&&r)||a.gn.ULS.Se(593232850,n.H,o.Info,"Window: available["+t+"] valid["+r+"]; Origin: valid["+c+"] expected["+a.Qo+"] actual["+s+"]"),c&&(!a.er||r)){var u;try{u=JSON.parse(i.data)}catch(i){return void a.gn.ULS.Se(593232851,n.H,o.Info,"Failed to parse event data: ".concat(V(i)))}var l=u.MessageId;if(l){if(a.gn.ULS.Se(593232854,n.H,o.Info,"Received message: ".concat(l,", correlation: ").concat(u.CorrelationId)),l!==si._e&&l!==si.$e||a.setTargetOrigin(i.origin),u.Values&&u.Values.ackExpected&&a.postMessage(yi.Qn,void 0,u.CorrelationId),a.or&&l===si.un)return window._pageTimings=null!==(e=window._pageTimings)&&void 0!==e?e:{},void(window._pageTimings[u.Values.name]=u.Values.time);if(a.nl)try{a.nl(u)}catch(i){a.gn.ULS.Se(594556386,n.H,o.Error,"Message handler error: ".concat(V(i)))}else a.gn.ULS.Se(591933923,n.H,o.Error,"No message handler")}else(a.tr||a.nr)&&a.gn.ULS.Se(593232853,n.H,o.Info,"Missing message id")}},this.gn=e,this.setTargetOrigin(i),t&&this.setMessageHandler(t),this.or=!!(null===(s=null===(r=window.location)||void 0===r?void 0:r.search)||void 0===s?void 0:s.match(/wdpa=1/gi))||"1"===Vi("EnableMetricLogging"),window.addEventListener("message",this.el,!1)}return i.prototype.setTargetOrigin=function(i){var e=u(i).toLowerCase();this.Yo&&this.Yo!==e&&this.gn.ULS.Se(593232847,n.H,o.Warning,"Updating origin: [".concat(b(this.Yo),"]->[").concat(b(e),"]")),this.Yo=e,this.Qo=d(e,2),this.ir=["www.onenote.com","www.onenote.partner.office365.cn","www.onenote.gcc.osi.office365.us","www.onenote.osi.office365.us","www.onenote.osi.apps.mil","www.onenote.osi.eaglex.ic.gov","www.onenote.osi.microsoft.scloud"],this.tr=s(e),this.nr=a(e)},i.prototype.setTargetFrame=function(i,e){this.tl=i,this.er=!!e},i.prototype.setMessageHandler=function(i){this.nl=i},i.prototype.removeMessageHandler=function(){this.nl=void 0},i.prototype.postMessage=function(i,e,t){if(this.tl&&this.tl.contentWindow){this.gn.ULS.Se(593232849,n.H,o.Info,"Sending message: "+i);var r={MessageId:i,SendTime:W(),CorrelationId:t,Values:e};this.tl.contentWindow.postMessage(JSON.stringify(r),this.Yo)}else this.gn.ULS.Se(593232848,n.H,o.Error,"Missing target to send message: "+i)},i.prototype.dispose=function(){window.removeEventListener("message",this.el,!1),this.nl=void 0},i}(),$e=function(){function i(i,e){!function(i){if(!i||!i.appendChild)throw TypeError("Container")}(i),this.ol=i,this.rl=e,this.sl=e+"_Form",this.al=oe()}return Object.defineProperty(i.prototype,"element",{get:function(){return this.ol},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"frameId",{get:function(){return this.rl},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"formId",{get:function(){return this.sl},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isTopFrameTrusted",{get:function(){return this.al},enumerable:!1,configurable:!0}),i.prototype.boot=function(i,e,t,r){var s=this;this.gn=t,this.Da=new Xe(i,t,this.nl);var a=r.useAdditionalDiv,c=r.permissionsPolicy;this.cl&&!a?(this.cl.setAttribute("allow",c),this.gn.ULS.Se(588793045,n.H,o.Info,"Wac frame reused")):(this.cl=function(i,e,t,n,o,r,s,a){i.style.top="0",i.style.bottom="0",i.style.left="0",i.style.right="0",i.style.height="100%",i.style.width="100%";var c=i.ownerDocument,u=c.createElement("iframe");if(u.id=e,u.name=e,u.src="",u.title="Office on the web Frame",u.marginWidth="0",u.marginHeight="0",u.style.top="0",u.style.bottom="0",u.style.left="0",u.style.right="0",u.style.height="100%",u.style.width="100%",u.style.display="block",u.style.position="absolute",u.style.backgroundColor="transparent",u.style.border="none",u.frameBorder="0",u.setAttribute("allowfullscreen","true"),u.setAttribute("allowTransparency","true"),u.setAttribute("allow",t),te(u,s),n&&(i.style.minHeight=n,u.style.minHeight=n),o&&(i.style.minWidth=o,u.style.minWidth=o),a&&u.setAttribute("role","none"),r){var d=c.createElement("div");d.style.top="0",d.style.bottom="0",d.style.left="0",d.style.right="0",d.style.height="100%",d.style.width="100%",d.style.backgroundColor="#393a3d",d.style.backfaceVisibility="hidden",n&&(d.style.minHeight=n),o&&(d.style.minWidth=o),d.appendChild(u),i.appendChild(d)}else i.appendChild(u);return u}(this.ol,this.rl,c,r.minHeight,r.minWidth,a,r.isInvisible,r.setNoneRole),this.gn.ULS.Se(588793046,n.H,o.Info,"Wac frame created")),this.Da.setTargetFrame(this.cl,r.enforceSameWindow),a&&(this.ul=this.cl.parentElement),r.useFrameFixForTeams&&t.ULS.Se(509143245,n.H,o.Info,"Frame fix enabled for teams uiHost"),ne(this.cl,e,r.useFrameFixForTeams),this.dl=function(i,e,t,n,o){var r=i.ownerDocument,s=r.createElement("form");for(var a in s.id=t,s.name=t,s.action=n,s.target=e,s.method="POST",o){var c=r.createElement("input");c.type="hidden",c.name=a,c.value=o[a],s.appendChild(c)}return i.appendChild(s),s}(this.ol,this.rl,this.sl,i,e);try{this.dl.submit()}catch(i){this.gn.ULS.Se(507909977,n.H,o.Warning,"WAC frame failed to submit, will retry. Error: ".concat(V(i))),new Promise((function(i){window.setTimeout(i,10)})).then((function(){s.dl.submit()})).catch((function(i){throw s.gn.ULS.Se(507909976,n.H,o.Error,"WAC frame failed to submit on retry. Error: ".concat(V(i))),i}))}},i.prototype.setVisibility=function(i){this.cl&&te(this.cl,i)},i.prototype.setMessageHandler=function(i){this.nl=i,this.Da&&this.Da.setMessageHandler(i)},i.prototype.setWrapperPostMessage=function(i){this.ll=i},i.prototype.removeMessageHandler=function(){this.nl=void 0,this.Da&&this.Da.removeMessageHandler()},i.prototype.postMessage=function(i,e){this.ll?this.ll(i,e):this.Da&&this.Da.postMessage(i,e)},i.prototype.dispose=function(i,e){var t=this;return new Promise((function(n){if(t.dl&&(t.ol.removeChild(t.dl),t.dl=void 0),t.Da&&(t.Da.dispose(),t.Da=void 0,t.nl=void 0),t.ll&&(t.ll=void 0),t.gn=void 0,!t.cl||!t.ul&&i)n();else{var o=function(){t.ul?(t.ul.removeChild(t.cl),t.ol.removeChild(t.ul)):t.ol.removeChild(t.cl),t.cl=void 0,t.ul=void 0,n()};e?o():(t.cl.src="about:blank",window.setTimeout(o,0))}}))},i}();var Ze=function(){function i(i,e,t){var n,o=this;this.sessions=[],this.containers=[],this.fl=function(i){o.hl.dispatch(i)},function(i){if(!i)throw new TypeError("ApplicationInitParams");var e=i.host;if(!e||!e.storageHostName)throw new TypeError("HostInfo");var t=i.user;if(!t||null==t.id)throw new TypeError("UserInfo")}(i),this.pl=i,this.vl=e,this.wl=t,this.hl=new wi,(n=i.host.owlVersion)&&(I.BUILD_NUMBER=n)}return Object.defineProperty(i.prototype,"name",{get:function(){return this.vl.name},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"version",{get:function(){return T()},enumerable:!1,configurable:!0}),i.prototype.addEventListener=function(i){this.hl.add(i)},i.prototype.removeEventListener=function(i){this.hl.remove(i)},i.prototype.createContainer=function(i){var e="WacFrame_".concat(this.vl.name,"_").concat(this.containers.length),t=new $e(i,e);return this.containers.push(t),t},i.prototype.createSession=function(i){var e=new Ke(this.pl,this.vl,i,this,this.fl,this.wl);return this.sessions.push(e),e},i.prototype.dispose=function(i){var e=this,t=this.sessions.map((function(e){return e.dispose(i).catch((function(i){}))}));return Promise.all(t).then((function(i){return e.hl.removeAll(),e.sessions=[],e.containers=[],{completion:"success"}}))},i}(),Ye=function(i,e,t,r,s){return i!==si.rt?Promise.reject("Wrong flow"):new Promise((function(i){t.pendingReboot=!0;var r=void 0;if(e.queryOverrides)try{r=JSON.parse(e.queryOverrides)}catch(i){t.logger.ULS.Se(592217694,n.H,o.Error,"Failed to parse queryOverrides: ".concat(r))}t.raiseEvent(Le.Reboot,C(C({},e),{previousSessionId:t.sessionId,queryOverrides:r})),i({completion:"success"})}))};function Qe(i){return!(!(i&&i.source&&i.accessToken)||!i.expiry&&0!==i.expiry)}function it(i){return function(i,e){var t={};e&&Object.keys(e).forEach((function(i){t[i.toLowerCase()]=e[i]}));return i.split("&").forEach((function(i){if(/^wd\w+=\w+/i.test(i)){var e=i.split("=");t[e[0].toLowerCase()]=e[1]}})),t}(window.location.search.substring(1),i)}function et(i,e,t){var n=C(C(C({},v(i.appUrl)),function(i){var e={};l(e,"jsapi","1"),l(e,"jsapiver","v2"),l(e,"corrid",i.sessionId),l(e,"usid",i.sessionId),l(e,"newsession","1"),l(e,"sftc","1"),i.hostSessionId&&l(e,"hid",encodeURIComponent(i.hostSessionId));var t=i.host;t.uiHostName&&l(e,"uih",t.uiHostName),t.uiHostIntegrationType&&l(e,"uihit",encodeURIComponent(t.uiHostIntegrationType)),t.metaUiHostVersion&&l(e,"muv",encodeURIComponent(t.metaUiHostVersion));var n=t.capabilities;n&&(n.accessibilityLoop&&l(e,"accloop","1"),n.rebootDoc&&l(e,"sdr",n.rebootDoc.toString()),n.createNewDoc&&l(e,"scnd","1"),n.authToken&&l(e,"sat","1"),n.customAuthConfig&&l(e,"cac","1"),n.refreshAccessToken&&l(e,"rat","1"),n.atMentions&&l(e,"sams","1"),n.moveToFolder&&l(e,"mtf","1"),n.noBrowserModalDialogs&&l(e,"nbmd","1"),n.commonFilePicker&&l(e,"sfp","1"),n.directDownload&&l(e,"sdd","1"),n.directPrint&&l(e,"sdp","1"));var o=i.ui;o.language&&l(e,"ui",encodeURIComponent(o.language)),o.uiEmbed&&l(e,"uiembed","1"),(o.hideHeader||"DocGen"===o.contentAssemblyMode||"Templatization"===o.contentAssemblyMode||"ContentAssemblyEdit"===o.contentAssemblyMode||"ContentAssemblyView"===o.contentAssemblyMode)&&l(e,"hhdr","1"),o.highContrast&&l(e,"hcm",encodeURIComponent(o.highContrast)),o.hideFileLocationPicker&&l(e,"hodflp","1"),o.hideAppLauncherInHeader&&l(e,"halh","1"),o.hideChatInHeader&&l(e,"hch","1"),o.hideMeInHeader&&l(e,"hmh","1"),o.hideSearchInHeader&&l(e,"hsh","1"),o.hideWorkflowInHeader&&l(e,"hwfh","1"),o.hideSettingsInHeader&&l(e,"hsth","1"),o.showAppIconInHeader&&l(e,"sih","1"),o.useNeutralColorInHeader&&l(e,"unh","1"),o.openLinksInNewWindow&&l(e,"onw","1"),o.useDarkTheme&&l(e,"udt","1"),"DocGen"!==o.contentAssemblyMode&&"ContentAssemblyView"!==o.contentAssemblyMode||l(e,"readOnly","1");var r=i.wopi;r&&r.source&&l(e,"wopisrc",encodeURIComponent(r.source));var s=i.bootParams;s&&(s.dataLanguage&&l(e,"rs",encodeURIComponent(s.dataLanguage)),s.readOnly&&l(e,"readonly","1"),s.disableChat&&l(e,"dchat","1"),s.cookieCompliant&&l(e,"mscc","1"),s.isNewFile&&(l(e,"new","1"),s.isFromHostTemplate&&l(e,"wdtpl","fromhost"))),i.user.isLicensed&&l(e,"islicenseduser","1"),i.user.isSynthetic&&l(e,"syn","1"),i.actNavId&&l(e,"actnavid",i.actNavId),i.sessionContext&&l(e,"sc",encodeURIComponent(i.sessionContext));var a=i.wdParams;if(a)for(var c in a)l(e,c,a[c]);var u=i.preseededSession;u&&(u.key&&l(e,"preseededsessionkey",encodeURIComponent(u.key)),u.id&&l(e,"preseededwacsessionid",encodeURIComponent(u.id)));var d=i.throttling;d&&(d.protection&&l(e,"ctp",d.protection),d.request&&l(e,"rct",d.request));var h=i.hostInitDiagnostics;h&&(h.entryPoint&&l(e,"wdorigin",encodeURI(h.entryPoint)),h.userClickTime&&l(e,"wdhostclicktime",h.userClickTime.toString()));var p=i.rebootOverride;return p&&p.previousSessionId&&l(e,"wdprevioussession",p.previousSessionId),f(e,"region"),e}(i)),t),o=i.rebootOverride;return o&&o.queryOverrides&&(n=C(C({},n),o.queryOverrides)),function(i,e,t){var n=[];for(var o in t)t[o]&&n.push(o+"="+t[o]);return i+e+(n.length>0?"?"+n.join("&"):"")}(i.appBasePath,e,n)}function tt(i,e){var t=function(i){var e={};l(e,"highdpi",String(window.devicePixelRatio>1.24)),l(e,"softblockedbrowser",String(Z())),l(e,"hostname",i.hostName),l(e,"feature_status",Si(i.featureManager,i.wdParams)),l(e,"jsapibuild",T());var t=i.wopi;t&&(l(e,"access_token",t.accessToken),l(e,"access_token_ttl",t.expiry.toString()),t.wacToken&&l(e,"wac_token",t.wacToken));var r=i.customFontCatalogUrl;r&&l(e,"customfontcatalogurl",r);var s=i.contentBundle;if(s&&s.url){l(e,"bundlesrc",s.url);var a=s.staleness,c=null!=a;c&&l(e,ie.Pr,a.toString()),i.logger.ULS.Se(577783775,n.H,o.Info,"Content bundle staleness: "+(c?a:"N/A"))}var u=i.file,d=u.name;if(d){l(e,"filename",d);var f=E(d);f&&l(e,"fileextension",f)}u.getUrl&&l(e,"filegeturl",u.getUrl),u.downloadCode&&l(e,"filedownloadcode",u.downloadCode),u.size&&l(e,"filesize",u.size.toString()),u.eTag&&l(e,"etag",u.eTag),u.cTag&&l(e,"revid",u.cTag),u.uniqueId&&l(e,"docid",u.uniqueId),void 0!==u.immutableReason&&l(e,"immutableReason",u.immutableReason.toString());var h=i.newFileTemplate;h&&(h.getUrl&&l(e,"templateurl",h.getUrl),h.size&&l(e,"filesize",h.size.toString()),h.eTag&&l(e,"etag",h.eTag),h.uniqueId&&l(e,"docid",h.uniqueId)),i.user.id&&l(e,"user_id",i.user.id),i.ownerId&&l(e,"owner_id",i.ownerId),i.sessionContext&&l(e,"sc",i.sessionContext);var p=i.ui;p.controls&&l(e,"huictrls",JSON.stringify(p.controls)),"Templatization"!==p.contentAssemblyMode&&"DocGen"!==p.contentAssemblyMode&&"ContentAssemblyEdit"!==p.contentAssemblyMode&&"ContentAssemblyView"!==p.contentAssemblyMode||l(e,"caae","1"),p.contentAssemblyMode&&l(e,"caaemode",p.contentAssemblyMode);var v=i.meeting;v&&(v.id&&l(e,"meetingId",v.id),v.title&&l(e,"meetingTitle",v.title),v.type&&l(e,"meetingType",v.type),v.scheduledStartTime&&l(e,"scheduledStartTime",v.scheduledStartTime),v.scheduledEndTime&&l(e,"scheduledEndTime",v.scheduledEndTime),v.isPresenter&&l(e,"isPresenter",v.isPresenter.toString()),v.organizerId&&l(e,"meetingOrganizerId",v.organizerId),v.joinUrl&&l(e,"meetingJoinUrl",encodeURIComponent(v.joinUrl)),v.isMeetingTeamsRoom&&l(e,"isMeetingTeamsRoom",v.isMeetingTeamsRoom.toString()));var w=i.host;return w.owlVersion&&l(e,"owlver",w.owlVersion),w.owlRollout&&l(e,"owlro",w.owlRollout),e}(i);return Object.keys(e).forEach((function(i){e[i]?t[i]=e[i]:delete t[i]})),t}function nt(i){var e,t;if(function(i){return"wdjs"in i||"wd1js"in i}(i))return"true"===window.sessionStorage.getItem("sideLoadingIsEnabled")?(e=!1,void("true"===(t=Vi("sideLoadingIsEnabled"))||"false"!==t&&e||Ri("sideLoadingIsEnabled","true",1))):void Ri("sideLoadingIsEnabled","false",0)}var ot=function(i,e,t,a,c){return i!==Ti.boot?Promise.reject("Wrong flow"):new Promise((function(i){var d,l=W();if(t.state=Me.Booting,t.pendingReboot=!1,function(i,e,t){if(void 0===t&&(t=!1),!i)throw new TypeError("SessionBootParams");var n=i.appUrl,o=i.appBaseUrl;if(!n&&!o)throw new TypeError("Either appUrl or appBaseUrl should exist");if(n&&"string"!=typeof n)throw new TypeError("AppUrl");if(o&&"string"!=typeof o)throw new TypeError("AppBaseUrl");var r=i.file;if(!r||!t&&!r.name)throw new TypeError("FileInfo");var s=i.container;if(!s||!(s instanceof $e)&&!s.appendChild)throw new TypeError("Container");if(!e&&!Qe(i.wopi))throw new TypeError("WopiInfo")}(e,t.skipWopiValidation,t.skipFileNameCheck),t.intent=e.intent,t.file=e.file,t.customFontCatalogUrl=e.customFontCatalogUrl,t.wopi=e.wopi,t.contentBundle=e.contentBundle,t.newFileTemplate=e.newFileTemplate,t.ownerId=e.ownerId,t.sessionContext=e.sessionContext,t.actNavId=e.actNavId,t.preseededSession=e.preseededSession,t.throttling=e.throttling,t.meeting=e.meeting,t.tenantId=e.tenantId,t.wdParams=it(e.wdParams),t.pinnedTarget=e.pinnedTarget,t.rebootOverride=e.rebootOverride,t.bootParams=e.bootParams||{},t.hostInitDiagnostics=C(C({},e.diagnostics),{hostInitializeCallTime:l}),t.be.getValue(H.oe,!1)&&ai(t.hostInitDiagnostics),e.appUrl){var f=e.appUrl;t.appUrl=f;var p=t.bootParams;if(g(f,"new")&&(p.isNewFile=!0),!p.dataLanguage)(v=S(f,"rs"))&&(p.dataLanguage=v);var v,w=t.ui;if(g(f,"uiembed")&&(w.uiEmbed=!0),!w.language)(v=S(f,"ui"))&&(w.language=v);if(!t.hostInitDiagnostics.entryPoint){var b=S(f,"wdorigin");b&&(t.hostInitDiagnostics.entryPoint=b)}if(!t.host.uiHostName){var I=S(f,"uih");I&&(t.host.uiHostName=I)}}else t.appUrl="";t.appBaseUrl=e.appBaseUrl?e.appBaseUrl.toLowerCase():u(e.appUrl).toLowerCase(),t.appBaseUrl=function(i,e){if(!e||-1===r.indexOf(e.toLowerCase()))return i;var t=i.match(/(^http[s]:\/\/)((?!word)\w*[-])?(.*)/i);return t?"".concat(t[1]).concat(e,"-").concat(t[3]):i}(t.appBaseUrl,h(t.appUrl,"region")),t.be.updateEnvironment(t.appBaseUrl),a.initializeAppContext(t,i,e),t.appBasePath=a.buildAppBasePath(t);var y=!1,A=t.preseededSession;t.appInfo.usePreseededSessionId&&A&&A.id&&(t.sessionId=A.id,y=!0);var _,F=!1,E=e.hostGeneratedSessionId;if(!y&&E&&(t.sessionId=E,F=!0),e.rebootOverride&&(y||F||(d=U(),t.sessionId=d[0],_=d[1]),t.pageStateObserver=new bi(t.logger,!0),t.authTokenTrustValidator=new hi(t.logger)),t.logger.ULS.Se(38580693,n.H,o.Info,"User session id: ".concat(t.sessionId,", is preseeded: ").concat(y,", is host generated: ").concat(F)),t.remoteTelemetryUrl=a.buildRemoteTelemetryUrl(t),N(t.remoteTelemetryUrl,t.appInfo.name,"init"),!t.isLoggerFromOwl){var R=t.be.getValue(H.ne,"").toString();R||(R=t.appBasePath+"RemoteUls.ashx"),t.logger.configure({remoteUlsEndpoint:R,sessionId:t.sessionId})}if(t.be.initializePeriodicFetch(t.appBasePath,t.sessionId),_&&t.logger.ULS.Se(590966790,n.H,o.Info,JSON.stringify(_)),function(i){try{var e=i.hostInitDiagnostics;i.logger.ULS.Se(558155803,n.H,o.Info,"HostInitDiagnostics: "+(e?JSON.stringify(e):"N/A")),i.logger.ULS.Se(596444237,n.H,o.Info,JSON.stringify({session:ni(i),client:i.clientDiagnostics}))}catch(e){i.logger.ULS.Se(558155804,n.H,o.Error,"Failed to log init info: ".concat(V(e)))}}(t),t.appInitDiagnostics={officeSessionId:t.sessionId,officeBootstrapperVersion:T(),hostName:t.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",(function(){t.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),!t.container){var P=e.container;t.container=P instanceof $e?P:t.application.createContainer(P)}t.container.setMessageHandler(t.onMessage);var O=!!a.ignoreCompletionMessage&&a.ignoreCompletionMessage(t),x=function(i,e){t.successTime=W(),O||(t.container.postMessage(yi.oo,void 0),ei(t.appInitDiagnostics,e.Diagnostics)),t.be.addSettingsChangeListener(t.logger.settingsChangeHandler),a.onSuccess&&a.onSuccess(t,e),t.logger.ULS.Se(596448985,n.H,o.Info,JSON.stringify(t.diagnostics)),N(t.remoteTelemetryUrl,t.application.name,"bootSuccess"),t.logger.ULS.flush(),t.container.postMessage(yi.lo,{HostInitializeDiagnostics:t.hostInitDiagnostics,ClientDiagnostics:t.clientDiagnostics}),t.state=Me.Booted,D({completion:"success"}),ti(t.appInfo.name,t.logger)},k=function(i,e){var r;t.failureTime=W(),a.onFailure&&a.onFailure(t,e.Error),t.logger.ULS.Se(596448986,n.H,o.Error,JSON.stringify({error:e.Error,diagnostics:t.diagnostics})),N(t.remoteTelemetryUrl,t.application.name,"bootFailure"),t.logger.ULS.flush(),t.state=Me.Failed;D({completion:"failure",error:e.Error,errorSource:"app",documentLoadedWithTabSwitch:null===(r=t.appInitDiagnostics)||void 0===r?void 0:r.documentLoadedWithTabSwitch}),ti(t.appInfo.name,t.logger)},D=function(e){O||(t.bootHeartBeat&&t.bootHeartBeat.stop(),t.removeActionHandler(si._e,x),t.removeActionHandler(si.Ce,k)),i(e)};c&&c.subscribe((function(){var i;D({completion:c.reason||"cancelled",documentLoadedWithTabSwitch:null===(i=t.appInitDiagnostics)||void 0===i?void 0:i.documentLoadedWithTabSwitch})})),O||(t.addActionHandler(si._e,x),t.addActionHandler(si.Ce,k)),nt(t.wdParams);var B=a.buildBootRequestParams(t),M=et(t,B.appPageName,B.queryParamsOverrides),L=tt(t,B.postDataOverrides);if(t.bootstrapperUrl&&t.preconnector&&t.preconnector.shouldPreconnect(t.hostName)&&t.preconnector.preconnect(t.bootstrapperUrl),t.bootstrapperUrl&&t.preloader&&t.preloader.shouldPreload(M,t.host.origin))try{a.beforePreload&&a.beforePreload(t);var J=t.bootstrapperUrl;t.featureManager.isFeatureEnabled(vi.Nn)&&(t.logger.ULS.Se(590966791,n.H,o.Info,"HTTP2 preload enabled"),J=m(J)),t.preloader.preload(J,t.ui.language,t.logger,t.featureManager)}catch(i){t.logger.ULS.Se(590966792,n.H,o.Error,"Error preloading")}a.beforeContainerBoot&&a.beforeContainerBoot(t,M),t.appInitDiagnostics.officeFrameCreateTime=W(),t.container.boot(M,L,t.logger,a.buildContainerBootParams(t)),O?x(si._e,{Diagnostics:{}}):(t.bootHeartBeat=new ye(s(t.appBaseUrl),t.be,t.logger,(function(){var i;t.timeoutTime=W(),a.onTimeout&&a.onTimeout(t),N(t.remoteTelemetryUrl,t.application.name,"bootTimeout"),D({completion:"timeout",error:{documentLoadedWithTabSwitch:null===(i=t.appInitDiagnostics)||void 0===i?void 0:i.documentLoadedWithTabSwitch}}),c&&c.cancel()}),c&&a.overrideBootTimeout?Math.min(c.timeoutInMs,a.overrideBootTimeout(t)):c?c.timeoutInMs:a.overrideBootTimeout?a.overrideBootTimeout(t):void 0),a.beforeBootCompletionMessage&&a.beforeBootCompletionMessage(t))})).catch((function(i){throw t.failureTime=W(),a.onException&&a.onException(t,i),t.remoteTelemetryUrl&&N(t.remoteTelemetryUrl,t.application.name,"bootException"),t.bootHeartBeat&&t.bootHeartBeat.stop(),{error:i.toString(),errorStack:i.stack}}))},rt=function(i,e,t){return new Promise((function(e){t.logger.ULS.Se(590111070,n.H,o.Error,"Unsupported flow: ".concat(i)),e({completion:"failure"})}))},st=function(i,e,t,r,s){return i!==Ti.createNew?Promise.reject("Wrong flow"):new Promise((function(a){var c={wopiPendingInitializeTime:W()},u=!!(r&&r.parallelizeStartSessionRequest&&r.buildStartSessionRequestParams)&&r.parallelizeStartSessionRequest(t),d=!1,l=!1,f=!1,h=!1,p=void 0,v=void 0,w=!1,m=!1;if(K()===j.IE||r&&r.fallBackToSingleStepBootFlow&&r.fallBackToSingleStepBootFlow(t,e))!function(){t.logger.ULS.Se(578074079,n.H,o.Info,"Waiting for WOPI info to start boot");var i=function(i,a){if(d)t.logger.ULS.Se(578074080,n.H,o.Warning,"completeCreateNew already called");else{if(d=!0,c.wopiPendingCompleteTime=W(),"failure"===a.state)return R(a.reason),t.state=Me.Failed,void r({completion:"failure"});at(a.newFile),t.run(Ti.boot,C(C({},e),{wopi:a.wopi}),s).then((function(i){r(i)}))}};t.addActionHandler(Ti.completeCreateNew,i);var r=function(e){t.removeActionHandler(Ti.completeCreateNew,i),a(e)};s&&s.subscribe((function(){r({completion:"cancelled"})}))}();else{var g=function(i,e){d?t.logger.ULS.Se(587236372,n.H,o.Warning,"completeCreateNew already called"):(d=!0,c.wopiPendingCompleteTime=W(),"failure"!==e.state?Qe(p=e.wopi)?(t.wopi=p,t.logger.ULS.Se(587286030,n.H,o.Info,"WOPI info received. Access token: "+JSON.stringify({length:p.accessToken.length,expiry:p.expiry})+", current state: "+JSON.stringify({parallelizeStartSessionRequest:u,wacFrameLoaded:l,wacCanAcceptStartSessionResponse:f})),!u||l&&!f?l&&A():b(),l&&t.container&&t.container.postMessage(yi.Do,void 0),at(e.newFile)):S("InvalidWopiInfo"):S(e.reason))},S=function(i){R(i),l&&t.container&&t.container.postMessage(yi.Wo,void 0)},b=function(){t.logger.ULS.Se(587233056,n.H,o.Info,"Making parallelized StartSession request");var e=r.buildStartSessionRequestParams(t,i,p),s=et(t,e.appPageName,e.queryParamsOverrides),a={"Content-Type":"application/x-www-form-urlencoded"},u="access_token="+encodeURIComponent(p.accessToken)+"&access_token_ttl="+encodeURIComponent(p.expiry.toString());c.startSessionStartTime=W(),Te(s,u,a,I)},I=function(i){var e=W();c.startSessionCompleteTime=e,t.logger.ULS.Se(587233057,n.H,o.Info,"StartSession request completed. Status code: ".concat(i.status,", time: ").concat(e)),v={RequestStatus:i.status,ResponseText:i.responseText},l&&f?y():t.logger.ULS.Se(587233058,n.H,o.Info,"StartSession response not yet sent: "+JSON.stringify({wacFrameLoaded:l,wacCanAcceptStartSessionResponse:f,wopiInfoSent:w,startSessionResponseSent:m}))},T=function(i,e){c.readyMessageReceiveTime=W(),t.container&&t.container.postMessage(yi.io,void 0),l||(l=!0,f=e.CanAcceptStartSessionComplete,t.logger.ULS.Se(587321567,n.H,o.Info,"App ready: "+JSON.stringify({parallelizeStartSessionRequest:u,wacCanAcceptStartSessionResponse:f,startSessionResponseAvailable:!!v,wopiInfoAvailable:!!p})),d&&t.container&&t.container.postMessage(p?yi.Do:yi.Wo,void 0),u&&f?y():A(),ei(t.appInitDiagnostics,e.Diagnostics))},y=function(){m||w||!v||(200===v.RequestStatus?(m=!0,c.completeMessageCreateTime=W(),_(yi.ro,{StartSessionResponse:v,Diagnostics:c},3)):A())},A=function(){m||w||!p||(w=!0,c.completeMessageCreateTime=W(),r&&r.sendCreateNewWopiInfo?r.sendCreateNewWopiInfo(t):_(yi.so,{WopiDetails:{WopiSrc:p.source,AccessToken:p.accessToken,AccessTokenTtl:p.expiry.toString()},Diagnostics:c},3))},_=function(i,e,r){var s=W();r<=0?t.logger.ULS.Se(587233165,n.H,o.Error,"Attempted to complete but no ack. Time: ".concat(s)):(t.logger.ULS.Se(587233166,n.H,o.Info,"Sending complete message. Retries left: ".concat(r-1,", Time: ").concat(s)),c.completeMessageSendTime=s,t.container&&t.container.postMessage(i,e),window.setTimeout(F,1e3,i,e,r-1))},F=function(i,e,r){h||(t.logger.ULS.Se(587233167,n.H,o.Info,"Timeout session complete ack. Retries left: ".concat(r)),_(i,e,r))},E=function(i,e){h=!0},V=function(i){t.removeActionHandler(Ti.completeCreateNew,g),t.removeActionHandler(si.ye,T),t.removeActionHandler(si.ht,E),a(i)};t.addActionHandler(Ti.completeCreateNew,g),t.addActionHandler(si.ye,T),t.addActionHandler(si.ht,E),s&&s.subscribe((function(){V({completion:"cancelled"})})),t.skipWopiValidation=!0,t.skipFileNameCheck=!0,t.wopi=void 0,t.run(Ti.boot,e,s).then((function(i){t.skipWopiValidation=!1,t.wopi=p,V(i)}))}function R(i){t.logger.ULS.Se(596444188,n.H,o.Warning,"Fail with reason: "+(i?JSON.stringify(i):"N/A"))}}))};function at(i){i&&(i.path&&history.replaceState({},"",i.path),i.title&&(document.title=i.title))}var ct=function(){function i(i){var e=this;this.ml=!1,this.gl="",this.Sl=[],this.bl=function(i){e.ml||(e.ml=!0,e.gl=i?"timeout":"cancelled",e.Sl.map((function(i){return i()})),e.Sl=[])},this.Il=i,window.setTimeout((function(){return e.bl(!0)}),i)}return Object.defineProperty(i.prototype,"isCancelled",{get:function(){return this.ml},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"timeoutInMs",{get:function(){return this.Il},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"reason",{get:function(){return this.gl},enumerable:!1,configurable:!0}),i.prototype.cancel=function(){this.bl(!1)},i.prototype.subscribe=function(i){this.ml?i():this.Sl.push(i)},i}();function ut(i){return new ct(i)}var dt=function(i,e,t,r,s){return i!==Ti.dispose?Promise.reject("Wrong flow"):new Promise((function(i){t.logger.ULS.Se(595714433,n.H,o.Info,"start disposing the application");var a=t.host.requireExplicitUnload,c={disposeStartTime:W(),forceAppUnload:a};t.state=Me.Disposing;var u=function(){t.state=Me.Disposed,i({completion:"success"})},d=function(i){r&&r.disposeAppSpecificResources&&r.disposeAppSpecificResources(t,e),t.dispose(),c.disposeEndTime=W(),function(i,e,t){if(t){var r=Number(t.hostMessageReceived);e.appUnloadStartTime&&!isNaN(r)&&(e.hostToAppPostMessageLatency=r-e.appUnloadStartTime);var s=Number(t.appMessageSent);!isNaN(s)&&e.appUnloadEndTime&&(e.appToHostPostMessageLatency=e.appUnloadEndTime-s);var a=Number(t.appUnloadStart),c=Number(t.appUnloadEnd);if(isNaN(a)||isNaN(c)||(e.appUnloadLatency=c-a),t.serverTimings){var u=t.serverTimings;for(var d in u)e["st-"+d.toString()]=u[d]}}i.logger.ULS.Se(592524822,n.H,o.Info,"App disposed: "+JSON.stringify(e)),i.logger.ULS.flushOnClose()}(t,c,i),t.container?t.container.dispose(t.pendingReboot,a).then(u):u()};if(a){c.appUnloadStartTime=W();t.addActionHandler(si.bt,(function(i,e){c.appUnloadEndTime=W(),d(e)})),(s||new ct(5e3)).subscribe((function(){t.state===Me.Disposing&&(c.appUnloadTimedOut=!0,d())})),t.container&&t.container.postMessage(yi.Bo,void 0)}else d()}))};var lt,ft=function(i,e,t,r,s){return i!==si.Je?Promise.reject("Wrong flow"):new Promise((function(i){if(t.host.capabilities&&t.host.capabilities.frameTrustCheck)t.raiseEvent(Le.FrameTrust,e);else{var r=!!t.container&&t.container.isTopFrameTrusted;t.logger.ULS.Se(592445957,n.H,o.Info,"Top frame is trusted: ".concat(r)),t.container&&t.container.postMessage(yi.Je,{isTopFrameTrusted:r})}i({completion:"success"})}))},ht=function(i,e,t,n,o){return i!==si.Ge?Promise.reject("Wrong flow"):new Promise((function(i){t.authTokenTrustValidator.isResourceTrustedForMessage(e).then((function(n){n?t.raiseEvent(Le.GetAuthToken,e):(t.container.postMessage(yi.Ao,{AuthToken:"",Error:"accessDenied",RequestId:e.RequestId,IdentityType:e.IdentityType}),i({completion:"success"}))}),(function(n){t.container.postMessage(yi.Ao,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:e.RequestId,IdentityType:e.IdentityType}),i({completion:"failure",error:n})}))}))},pt=function(i,e,t,r,s){return i!==si.Ae?Promise.reject("Wrong flow"):new Promise((function(i){var s=e&&e.state?e.state:"Unknown";t.logger.ULS.Se(592839750,n.H,o.Info,"Boot state: [".concat(s,"]")),r&&r.beforeComplete&&r.beforeComplete(s),i({completion:"success"})}))},vt=function(i,e,t,r,s){if(i!==Ti.postWacToken)return Promise.reject("Wrong flow");var a=k();return t.logger.ULS.Se(507774685,n.H,o.Important,"postWacToken flow initiated"),new Promise((function(i){var r=function(i,e){t.logger.ULS.Se(507597017,n.H,o.Info,"postWacToken flow completed in ".concat(k()-a," ms")),window.clearInterval(u),window.clearTimeout(d);var r={completion:"success"};e&&void 0!==e.TokenAlreadySet&&(r.data={TokenAlreadySet:e.TokenAlreadySet}),s(r)},s=function(e){t.removeActionHandler(si.ln,r),i(e)},c=function(){var i;return null===(i=t.container)||void 0===i?void 0:i.postMessage(yi.Xo,e)};t.addActionHandler(si.ln,r),c();var u=window.setInterval(c,100),d=window.setTimeout((function(){window.clearInterval(u),t.logger.ULS.Se(507844190,n.H,o.Warning,"postWacToken flow timed out after ".concat(6e4," milliseconds")),s({completion:"timeout"})}),6e4)}))};function wt(i,e){i.ULS.Se(42524822,n.H,o.Info,"LogFeatureUsage: ".concat(e.toString()))}var mt,gt=((lt={})[Wi.BOOTSTART]=596464066,lt[Wi.BACKGROUND_MODESWITCH_BOOTSTART]=596464066,lt[Wi.BOOTSUCCESS]=596457106,lt[Wi.BOOTFAILED]=596464088,lt[Wi.BOOTEXCEPTION]=596464072,lt[Wi.BOOTTIMEOUT]=587580759,lt);function St(i,e){switch(e){case Wi.BOOTSTART:case Wi.BACKGROUND_MODESWITCH_BOOTSTART:case Wi.BOOTSUCCESS:case Wi.BOOTFAILED:case Wi.BOOTEXCEPTION:case Wi.BOOTTIMEOUT:i.ULS.Se(gt[e],n.H,o.Warning,e.toString());break;default:i.ULS.Se(523298252,n.H,o.Info,"UKNOWN RELIABILITY MILESTONE")}i.ULS.flush()}function bt(i,e,t){var n,o,r,s;Qi(),Ji(i.appUrl)||(wt(i.logger,Ui.JSAPIV2),St(i.logger,Wi.BOOTSTART));var a=i.appContext,c=Hi.getBRSValue(Hi.DTEEnabledBRSKey);a.wasDefaultedtoEdit=!1,c&&!Ji(i.appUrl)&&function(i,e){var t,n=i.appContext,o=h(window.location.href,"action"),r=!1,s=i.host.uiHostName,a=s&&"teams"===s.toLowerCase();if(a){var c=Li(i.appUrl)===ki.VIEW;i.rebootOverride||(r=c)}var u=ji(i.appUrl)||Gi(i.appUrl);if(Hi.getBRSValue(Hi.DTESafariFixEnabledBRSKey)&&K()===j.Safari&&0===o.length)return;("default"===o||r||Hi.getBRSValue(Hi.DTESharingFixEnabledBRSKey)&&!(null===(t=null==e?void 0:e.bootParams)||void 0===t?void 0:t.readOnly)&&!u&&!a&&0===o.length)&&"true"===localStorage.getItem("enableDTE")&&(i.appUrl=p(i.appUrl,"VisioView","EditView",!0),n.wasDefaultedtoEdit=!0)}(i,t),a.appMode=Li(i.appUrl),a.resource=new We(i.appBaseUrl,i.bootstrapperUrl),a.appFramePageViewLoaded=!1,a.fastViewPostMessageToWacFrameState={appFrameReadyToReceiveFastViewData:!1,jsapiAlreadySentFastViewDataToWacFrame:!1,jsapiReadyToSendFastViewDataToWacFrame:!1},a.fastViewInfo={fastViewContainer:void 0,fishBowlElement:void 0,imageElement:void 0,pageElement:void 0,docViewLoaded:!1,imageLoaded:!1,docViewResponseText:void 0,fastViewcontainerVisible:!1,fastviewShownFromHostCache:!1,fastViewPLTTime:void 0,defaultImageWidth:void 0,defaultImageHeight:void 0,fastviewContentLoadedFromLocalcache:!1,fastViewImageDataFromCache:void 0,fastViewCacheHit:!1,noChromeMode:!1,noChromeWithToolbar:!1,fastviewSavedToBrowserCache:!1},a.fastViewBrowserCache=ee.Create(i.user.id,null===(n=i.wopi)||void 0===n?void 0:n.source,null===(o=i.file)||void 0===o?void 0:o.eTag,i.logger),a.sessionBootParams=t,a.commentContext=void 0,a.modeSwitchAckReceived=!1;var u=i.host.uiHostName,d=u&&"teams"===u.toLowerCase();((null===(r=i.wdParams)||void 0===r?void 0:r.wdnc)||Hi.getBRSValue(Hi.hostCacheForEmbedViewEnabledBRSKey)&&(a.appMode===ki.EMBED_VIEW||a.appMode===ki.INTERACTIVE_PREVIEW))&&(a.fastViewInfo.noChromeMode=!0),d&&(null===(s=i.ui)||void 0===s?void 0:s.hideHeader)&&(a.appMode===ki.VIEW||a.appMode===ki.EMBED_VIEW||a.appMode===ki.INTERACTIVE_PREVIEW||a.appMode===ki.EDIT&&-1===i.appUrl.indexOf("embed=1"))&&(a.fastViewInfo.noChromeMode=!0),d&&a.fastViewInfo.noChromeMode&&(a.fastViewInfo.noChromeWithToolbar=!0),h(window.location.href,"teamsvisiomode")&&i.hostInitDiagnostics&&(i.hostInitDiagnostics.userClickTime=(new Date).getTime())}function It(i){return i.appBaseUrl+"/v/"}function Tt(i){return e=i.appBasePath,t=i.sessionId,e+"RemoteTelemetry.ashx"+(t?"?usid="+t:"");var e,t}function yt(i,e){if(void 0===e&&(e=!1),Pt(i,e)){Ji(i.appUrl)||Oe.RecordTelemetryData("bootPerf","constGuid","fastViewDuration",Re.TimerBegin,new Date,i.logger);try{!function(i){var e=function(i){var e=i.appContext;if(!i.container)return;var t=Rt(i),n=function(){var i=document.createElement("div");return i.id="VisioFastViewContainer",i.style.width="100%",i.style.height="100%",i.style.visibility="hidden",i.style.position="absolute",i.style.backgroundColor="#F3F2F1",i.style.display="block",i.style.touchAction="none",i.style.zIndex="1",i}(),o=function(i,e,t,n){var o=document.createElement("div");o.style.top=t?Bi.ToolbarHeightConsumption+"px":e?"0px":Bi.RibbonHeightConsumption+"px";return o.style.left="0px",o.style.right="0px",o.style.bottom=Bi.StatusbarHeight+"px",o.style.position="absolute",o.style.borderTopColor="#C6C6C6",o.style.borderTopWidth=Bi.FishbowlBorderTop+"px",o.style.borderTopStyle="solid",o.style.backgroundColor=zi(n)?"#FFFFFF":"#F9F9F9",i.appendChild(o),o}(n,t.noChromeMode,t.noChromeWithToolbar,e.appMode),r=function(i){var e=document.createElement("div");return e.id="backgroundPage",i.appendChild(e),e}(o),s=function(i){var e=document.createElement("img");return e.id="foregroundPage",e.style.visibility="hidden",e.setAttribute("crossorigin","anonymous"),i.appendChild(e),e}(r);!t.noChromeMode&&function(i,e){var t=document.createElement("div");t.style.top="0px",t.style.height=Bi.HeaderHeight+"px",t.style.left="0px",t.style.right="0px",t.style.position="absolute",Hi.getBRSValue(Hi.Fluent2StyleIsEnabled)?t.style.backgroundColor="#FFFFFF":t.style.backgroundColor=e.ui&&e.ui.useNeutralColorInHeader?"#F3F2F1":"#3955A3";i.appendChild(t)}(n,i),(!t.noChromeMode||t.noChromeWithToolbar)&&function(i,e){var t=document.createElement("div");t.style.top=(i?0:Bi.HeaderHeight)+"px",t.style.height="0px",t.style.left="0px",t.style.right="0px",t.style.position="absolute",t.style.backgroundColor="#E1E1E1",t.id="visio_fastview_toolbar_upper",e.appendChild(t);var n=document.createElement("div");n.style.top=(i?0:Bi.HeaderHeight)+"px",n.style.height=Bi.ToolbarHeightConsumption+"px",n.style.left="0px",n.style.right="0px",n.style.position="absolute",n.style.backgroundColor="#FFFFFF",n.id="visio_fastview_toolbar",e.appendChild(n)}(t.noChromeWithToolbar,n);var a=function(i,e){var t=e.appContext,n=document.createElement("div");t.fastViewInfo.noChromeWithToolbar?n.style.top=Bi.ToolbarHeightConsumption+"px":t.fastViewInfo.noChromeMode?n.style.top="0px":n.style.top=Bi.RibbonHeightConsumption+Bi.FishbowlBorderTop+"px";n.style.height=Bi.ProgressImageHeight+"px",n.style.left="0px",n.style.right="0px",n.style.position="absolute",e.appContext.resource&&(n.style.backgroundImage="url(".concat(e.appContext.resource.getDelayLoadingGif(),")"),n.style.backgroundRepeat="repeat-x");return i.appendChild(n),n}(n,i),c=function(i){var e=document.createElement("div");return e.style.height="0px",i.appendChild(e),e}(n),u=(d=n,l=document.createElement("div"),l.style.bottom="0px",l.style.height=Bi.StatusbarHeight+"px",l.style.left="0px",l.style.right="0px",l.style.position="absolute",l.style.borderTopColor="#C6C6C6",l.style.borderTopWidth=Bi.StatusbarBorderTop+"px",l.style.borderTopStyle="solid",l.style.backgroundColor="#FFFFFF",d.appendChild(l),l);var d,l;e.appMode===ki.EDIT&&function(i,e,t,n,o,r){(function(i,e,t,n){var o=n?Bi.RibbonHeightNoChrome:Bi.RibbonHeightEdit;i.style.top=o+"px",t.style.top=o+Bi.FishbowlBorderTop+"px",i.style.left=Bi.ShapePanelWidthWithBorder+"px",e.style.left=Bi.ShapePanelWidthWithBorder+"px"})(i,t,n,o),function(i,e,t){i.style.top=e.style.top,i.style.position="absolute",i.style.height="auto",i.style.borderWidth=Bi.ShapePanelBorderWidth+"px",i.style.borderRightStyle="solid",i.style.boxShadow="2px 1px 4px 0 rgba(0,0,0,0.13)",i.style.borderColor="#e1e1e1",i.style.backgroundColor="#f2f2f2",i.style.width=Bi.ShapePanelWidthWithoutBorder+"px",i.style.bottom="0px",i.style.overflow="0",function(i,e){var t=document.createElement("div");t.style.top="50%",t.style.left="50%",t.style.position="absolute",t.style.transform="translateX(-50%) translateY(-50%)",t.style.fontSize="9pt",t.style.fontFamily='"Segoe UI", Arial, Verdana, sans-serif',i.appendChild(t);var n=document.createElement("img");n.style.cssFloat="left",n.style.height="16px",n.style.width="16px",n.setAttribute("crossorigin","anonymous"),e.appContext.resource?n.src=e.appContext.resource.getLoadingSpinnerGif():n.style.visibility="hidden";t.appendChild(n);var o=document.createElement("div");o.style.cssFloat="left",o.style.paddingLeft="10px",o.innerText="",t.appendChild(o)}(i,t)}(e,i,r)}(o,c,u,a,t.noChromeMode,i);return i.container.element.appendChild(n),{fastViewContainer:n,fishBowlElement:o,pageElement:r,imageElement:s,shapePanelElement:c}}(i),t=e.imageElement,r=e.fishBowlElement,s=e.pageElement,a=e.fastViewContainer,c=Rt(i);c.fishBowlElement=r,c.imageElement=t,c.pageElement=s,c.fastViewContainer=a;var u=i.appContext;if(u.fastViewBrowserCache&&u.fastViewBrowserCache.IsCacheAvailable())return void u.fastViewBrowserCache.DecryptAndValidate((function(e,t){try{c.imageElement.setAttribute("src","data:image/png;base64,{0}".replace("{0}",t)),c.imageLoaded=!0,c.docViewResponseText=e,c.docViewLoaded=!0,c.fastviewContentLoadedFromLocalcache=!0,c.fastViewImageDataFromCache=t,At(i)}catch(e){i.logger.ULS.Se(508045407,n.H,o.Error,"doc view parsing failed from cache with exception: "+V(e)),Ct(i)}}),(function(){i.logger.ULS.Se(508045406,n.H,o.Error,"fastview browser cache decryption and validation failed"),u.fastViewBrowserCache.DeleteDocument(),Ct(i)}));(function(i){var e,t=Rt(i),r=t.imageElement;r.onload=function(){t.imageLoaded=!0,At(i)},r.onerror=function(){i.logger.ULS.Se(523531992,n.H,o.Error,"Fast View image request failed in JSAPI bootstrapper"),Ct(i)},r.src=_t(null===(e=i.contentBundle)||void 0===e?void 0:e.url,Mi.FastViewImage)})(i),function(i){var e,t=_t(null===(e=i.contentBundle)||void 0===e?void 0:e.url,Mi.FastViewJson),r=Rt(i);Ni.sendXmlHttpRequest("GET",t,!0,(function(e){try{r.docViewResponseText=e,r.docViewLoaded=!0,At(i)}catch(e){i.logger.ULS.Se(508045405,n.H,o.Error,"doc view usage failed with exception: "+V(e)),Ct(i)}}),(function(){i.logger.ULS.Se(508045404,n.H,o.Error,"doc view request failed in JSAPI bootstrapper"),Ct(i)}),Mi.FastViewJson,i.logger)}(i)}(i)}catch(e){i.logger.ULS.Se(523531990,n.H,o.Error,"Failed to boot from the host cache: ".concat(V(e))),Ct(i)}}}function Ct(i){var e=Rt(i);e.fastViewContainer&&e.fastViewContainer.parentElement&&e.fastViewContainer.parentElement.removeChild(e.fastViewContainer),e.fastViewcontainerVisible=!1,i.appContext.fastViewPostMessageToWacFrameState.jsapiReadyToSendFastViewDataToWacFrame=!0,Ot(i)}function At(i){try{var e=Rt(i),t=JSON.parse(e.docViewResponseText);if(e.fastViewCacheHit=!0,e.docViewLoaded&&e.imageLoaded&&i.state===Me.Booting&&!i.appContext.appFramePageViewLoaded){var r=(s=t.PageWidth,a=t.PageHeight,c=e.fishBowlElement.offsetWidth,u=e.fishBowlElement.offsetHeight,d=96*Bi.FishbowlMarginInches,l=96*Bi.FishbowlMarginInches,f=(c-d)/(96*s),h=(u-l)/(96*a),Math.min(f,h));!function(i,e,t){var n=Rt(i),o=t.PageWidth,r=t.PageHeight,s=n.fishBowlElement,a=n.pageElement,c=s.offsetWidth-96*o*e,u=s.offsetHeight-96*r*e;a.style.width=96*o*e+"px",a.style.height=96*r*e+"px",a.style.backgroundColor="white",zi(i.appContext.appMode)||(a.style.borderColor="#C6C6C6",a.style.borderWidth="1px",a.style.borderStyle="solid",a.style.boxShadow="0px 0px 20px #C6C6C6");a.style.position="absolute",a.style.top=u/2+"px",a.style.left=c/2+"px"}(i,r,t),e.imageElement.style.position="absolute",e.imageElement.style.left=96*t.OffsetX*r+"px",e.imageElement.style.top=e.pageElement.clientHeight-96*(t.Height+t.OffsetY)*r+"px",e.defaultImageHeight=e.imageElement.height,e.defaultImageWidth=e.imageElement.width,e.imageElement.width=96*t.Width*r,e.imageElement.height=96*t.Height*r,e.imageElement.style.visibility="visible",e.fastViewContainer.style.display="block",e.fastViewContainer.style.visibility="visible",e.fastviewShownFromHostCache=!0,e.fastViewPLTTime=W(),e.fastViewcontainerVisible=!0,i.appContext.fastViewPostMessageToWacFrameState.jsapiReadyToSendFastViewDataToWacFrame=!0,function(i){var e=Rt(i);setTimeout((function(){e.fastViewcontainerVisible&&(i.logger.ULS.Se(523089178,n.H,o.Warning,"[setTimeoutForRemovalOfFastView] Removing fastview screen as its > ".concat(15e3," millisec.")),Ft(i))}),15e3)}(i),Ot(i)}else e.docViewLoaded&&e.imageLoaded&&i.logger.ULS.Se(523531993,n.H,o.Info,"FastView not shown. Conditions: "+JSON.stringify({SessionState:i.state,appFramePageViewLoaded:i.appContext.appFramePageViewLoaded}))}catch(e){i.logger.ULS.Se(508045403,n.H,o.Error,"fastview creation failed with exception: "+V(e))}var s,a,c,u,d,l,f,h}function _t(i,e){if(!i||-1===i.indexOf("{0}"))throw new TypeError("invalid content URL");if(!e)throw new TypeError("invalid content id");return decodeURI(i).replace("{0}",e)}function Ft(i){window.setTimeout((function(){return Ct(i)}),0)}function Et(i){var e=Rt(i),t=i.appInitDiagnostics;t.documentLoadedFromWopiPrecheckInfo=e.fastviewShownFromHostCache,e.fastviewShownFromHostCache&&(t.documentLoadedTime=e.fastViewPLTTime),t.cacheAboutToExpire=!1,e.fastViewCacheHit&&!t.cacheHit&&(t.cacheAboutToExpire=!0),t.cacheHit=e.fastViewCacheHit,Ji(i.appUrl)&&(t.webAppFrameReinitialized=!0);var n=i.hostInitDiagnostics;n&&void 0===n.hostPageRedirectCount&&(n.hostPageRedirectCount=Yi())}function Vt(i){var e,t,r,s,a,c,u,d=i.appInitDiagnostics;if(d){var l=i.appContext,f=Rt(i);Ji(i.appUrl)||xe(i.hostInitDiagnostics,d,i.logger);var h=!1;try{h=null===(e=JSON.parse(f.docViewResponseText))||void 0===e?void 0:e.IsCompressed}catch(i){}i.logger.ULS.Se(595981388,n.H,o.Info,JSON.stringify({BootDiagnostics:d,hostDiagnostics:i.hostInitDiagnostics,navigationStartTime:Zi(),isJSAPIV2:"true",localCacheHit:f.fastviewContentLoadedFromLocalcache,compressedView:h?"true":"false",backgroundBoot:Ji(i.appUrl),appMode:l.appMode.toString()})),d.documentLoadedWithTabSwitch&&i.logger.ULS.Se(596457107,n.H,o.Info,"DOCUMENTLOADEDWITHTABSWITCH"),i.logger.ULS.Se(596457681,n.H,o.Info,JSON.stringify({hostInitDiagnostics:null!==(t=i.hostInitDiagnostics)&&void 0!==t?t:"N/A"})),window._pageTimings=null!==(r=window._pageTimings)&&void 0!==r?r:{},d.documentLoadedTime&&(null===(s=i.hostInitDiagnostics)||void 0===s?void 0:s.hostInitializeCallTime)&&(window._pageTimings.Visio_Perf_PLT=d.documentLoadedTime-(null===(a=i.hostInitDiagnostics)||void 0===a?void 0:a.hostInitializeCallTime)),d.appCompletedTime&&(null===(c=i.hostInitDiagnostics)||void 0===c?void 0:c.hostInitializeCallTime)&&(window._pageTimings.Visio_Perf_ILT=d.appCompletedTime-(null===(u=i.hostInitDiagnostics)||void 0===u?void 0:u.hostInitializeCallTime))}}function Rt(i){return i.appContext.fastViewInfo}function Pt(i,e){var t,n=i.appContext;return!(!i.contentBundle||!i.contentBundle.url)&&(!!i.container&&(!((null===(t=i.wdParams)||void 0===t?void 0:t.wdPBIView)||i.appUrl.indexOf("wdPBIView")>=0)&&(!window.matchMedia("screen and (-ms-high-contrast: active)").matches&&(n.appMode===ki.VIEW||(!(n.appMode!==ki.EMBED_VIEW&&n.appMode!==ki.INTERACTIVE_PREVIEW||!Hi.getBRSValue(Hi.hostCacheForEmbedViewEnabledBRSKey))||n.appMode===ki.EDIT&&!ji(i.appUrl)&&(!Ji(i.appUrl)||e))))))}function Ot(i,e){var t,r;void 0===e&&(e=!1);var s=i.appContext.fastViewPostMessageToWacFrameState,a=Rt(i);if(!s.jsapiAlreadySentFastViewDataToWacFrame&&s.appFrameReadyToReceiveFastViewData){if(s.appFrameReadyToReceiveFastViewData&&e){var c=((t={})[Mi.FastViewImage]=void 0,t[Mi.FastViewJson]=void 0,t);return i.container&&i.container.postMessage(yi.Ko,c),s.jsapiAlreadySentFastViewDataToWacFrame=!0,void i.logger.ULS.Se(523368192,n.H,o.Info,"[sendFastViewDataToVisioAppFrame] force sending empty postmessage for fastview data after 5 sec wait time.")}if(s.appFrameReadyToReceiveFastViewData&&!s.jsapiReadyToSendFastViewDataToWacFrame)return i.logger.ULS.Se(523368193,n.H,o.Info,"[sendFastViewDataToVisioAppFrame] wac appframe is waiting for fastview data. jsapi is not yet ready to send it. Setting up 5 sec timer to revert if not done automatically. "),void setTimeout((function(){return Ot(i,!0)}),5e3);var u=a.fastviewContentLoadedFromLocalcache?a.fastViewImageDataFromCache:$i(a.imageElement,a.defaultImageWidth,a.defaultImageHeight),d=a.docViewResponseText,l=((r={})[Mi.FastViewImage]=u,r[Mi.FastViewJson]=d,r);i.container&&i.container.postMessage(yi.Ko,l),s.jsapiAlreadySentFastViewDataToWacFrame=!0,i.logger.ULS.Se(523368194,n.H,o.Info,"[sendFastViewDataToVisioAppFrame] Sent fastview data to wac appframe. ")}}function xt(i){var e,t,n=i.appContext,o={},r={},s=h(window.location.href,"teamsvisiomode");!n.wasDefaultedtoEdit&&i.host&&i.host.metaUiHostVersion&&!s&&(null===(e=i.rebootOverride)||void 0===e?void 0:e.mode)&&(s=i.rebootOverride.mode),s&&i.appUrl.indexOf("embed=1")<0&&("edit"===s.toLocaleLowerCase()&&n.appMode!==ki.EDIT&&(l(o,"VisioView","EditView"),l(o,"wdIsModeSwitch","1"),n.appMode=ki.EDIT),"view"===s.toLocaleLowerCase()&&n.appMode!==ki.VIEW&&(l(o,"VisioView","ConsumptionView"),n.appMode=ki.VIEW));var a=i.host.uiHostName;if(a&&"teams"===a.toLowerCase()&&l(o,"enableToolbarInTeams","true"),l(o,"pmOrigin",encodeURIComponent(u(window.location.href))),i.hostName&&l(o,"filesrc",encodeURIComponent(i.hostName)),n.appMode!==ki.EDIT_NEW||i.wopi||l(o,"instantedit","1"),f(o,"sams"),Hi.getBRSValue(Hi.IsAtMentionsEnabled)){var c=h(window.location.href,"nav");if(c&&n.appMode===ki.VIEW)l(r,"nav",decodeURIComponent(c));i.host.capabilities&&i.host.capabilities.atMentions&&l(r,"sams","1")}(null===(t=i.contentBundle)||void 0===t?void 0:t.url)&&(l(r,"bsdpm","true"),l(r,"dpmdv","true"));var d=void 0;return i.hostInitDiagnostics&&((d=i.hostInitDiagnostics.userClickTime)||(d=i.hostInitDiagnostics.hostInitializeCallTime)),d||(d=(new Date).getTime()),l(r,"dct",d.toString()),l(r,"wde",n.wasDefaultedtoEdit.toString()),l(r,"highdpi",String(window.devicePixelRatio>1.25)),Pt(i,!1)?l(o,"fastPreview","true"):l(o,"fastPreview","false"),Ji(i.appUrl)&&f(o,"newsession"),{appPageName:"visioframe.aspx",queryParamsOverrides:o,postDataOverrides:r}}function kt(i){i.logger.ULS.Se(526455300,n.H,o.Info,"[handleViewModeCLT] View mode CLT complete message received"),i.container&&i.container.postMessage(yi.jo,void 0),function(i){return!!Hi.getBRSValue(Hi.backgroundEditSessionEnabledKey)&&(!i.host.metaUiHostVersion||Hi.getBRSValue(Hi.IsTeamsBackgroundFrameFixEnabled))}(i)&&function(i){var e=i.appContext;if(e.appMode!==ki.VIEW)throw new TypeError("Booting up background editor in non viewer session");if(e.sessionBootParams){var t=C({},e.sessionBootParams),r=t.appUrl;if(void 0===r)throw new TypeError("applicationUrl is empty");if("consumptionview"!==h(r.toLowerCase(),"visioview"))throw new TypeError("applicationUrl does not have VisioView=ConsumptionView query param");r=p(r,"VisioView","EditView",!0),r=p(r,"backgroundsession","1",!0),t.appUrl=p(r,"wdIsModeSwitch","1",!0);var s=U()[0];t.hostGeneratedSessionId=s,t.preseededSession=void 0,i.logger.ULS.Se(521176415,n.H,o.Info,"[createBackgroudEditorSession] edit session associated: ".concat(s)),t.rebootOverride=void 0,i.backgroundSession=i.application.createSession({hostSessionId:i.hostSessionId}),i.backgroundSession.boot(t),i.backgroundSession.run(mt.Tl,i.session)}}(i)}function Wt(i,e){var t=Rt(i);if(e&&!t.fastviewSavedToBrowserCache){var n=parseInt(e[ee.maxStorageQuotaSettingName].toString(),10),o=parseInt(e[ee.minEvictTimePeriodSettingName].toString(),10);if(window.setTimeout((function(){return ee.EvictStaleCache(1024*n*1024,24*o*60*60*1e3,i.logger)}),ee.cacheEvictIdleTimeInMs),t.fastviewShownFromHostCache){var r=t.fastviewContentLoadedFromLocalcache?t.fastViewImageDataFromCache:$i(t.imageElement,t.defaultImageWidth,t.defaultImageHeight);r&&(window.setTimeout((function(){var e;return null===(e=i.appContext.fastViewBrowserCache)||void 0===e?void 0:e.SaveDocument(t.docViewResponseText,r)}),ee.documentSaveIdleTimeInMs),t.fastviewSavedToBrowserCache=!0)}}}function Ut(i,e){var t,r;null===(t=i.bootHeartBeat)||void 0===t||t.restart();var s=0;null===(r=i.container)||void 0===r||r.setVisibility(!1),function i(e,t,n,o,r,s,a){void 0===a&&(a=0),a>=10&&r("[workWithRetry] max recursion depth of ".concat(10," reached. Stopping retry and failing")),t()||(n()?(o(),e(),setTimeout((function(){return i(e,t,n,o,r,s,a+1)}),s())):r("[workWithRetry] max retries configured reached. Stopping retry and failing"))}((function(){i.container&&i.container.postMessage(yi.zo,e)}),(function(){return i.appContext.modeSwitchAckReceived}),(function(){return s<3}),(function(){s++}),(function(e){i.logger.ULS.Se(522840264,n.H,o.Info,"[handleBootBackgroundClient] ".concat(e,". Falling back to legacy switch"));var t=i.appContext.activeSession;t&&t.run(mt.yl,void 0)}),(function(){return 1e3}))}function Dt(i){!function(i){i.addActionHandler(si.Zt,(function(e,t){Hi.handleVisioBRS(t,i.logger)})),i.addActionHandler(si.Yt,(function(i,e){!function(i){if(i&&i.License){var e=Hi.getBRSValue(Hi.DTEEnabledForPlan0BRSKey);"plan1"===i.License||e&&"plan0"===i.License?localStorage.setItem("enableDTE","true"):localStorage.setItem("enableDTE","false")}}(e)})),i.addActionHandler(si.nn,(function(e,t){i.appContext.appFramePageViewLoaded=!0;var n=i.appInitDiagnostics;t&&t.Diagnostics&&Object.keys(t.Diagnostics).forEach((function(i){return n[i]=t.Diagnostics[i]}))})),i.addActionHandler(si.on,(function(e){!function(i){var e,t=window.location.href;t=p(t,"wdreloadsessionid",i.sessionId,!0);var r=i.sessionId,s=1;(null===(e=i.wdParams)||void 0===e?void 0:e.wdreloadcount)&&(s=parseInt(i.wdParams.wdreloadcount,10)+1),s>Hi.getIntegerBRSValue(Hi.ReloadOnScriptFailMaxLimitBRSKey,3)?i.logger.ULS.Se(523531988,n.X,o.Error,"Visio Boot failed for WACSessionID: "+r+" after"+s+"retries"):(t=p(t,"wdreloadcount",String(s),!0),i.logger.ULS.Se(523531989,n.X,o.Warning,"Refreshing VisioFrame for WACSessionID: "+r+", currentReloadCount: "+s+", UriLen: "+t.length),i.logger.ULS.flush(),window.location.href=t)}(i)})),Hi.getBRSValue(Hi.CoCommentingAcrossViewAndEditEnabled)&&i.addActionHandler(si.nt,(function(e,t){!function(i,e){i.appContext.commentContext=e}(i,t)}));i.addActionHandler(si.an,(function(e,t){!function(i,e){var t=window.location.href;"VIEW"===e.toMode||"EDIT"===e.toMode?(t=p(t,"teamsvisiomode",e.toMode,!0),Hi.getBRSValue(Hi.IsFormulaeSerializationRollbackEnabled)&&i.appContext.appMode===ki.EDIT&&"1"===e.wdDisableFormulae&&(t=p(t,"wdDisableFormulae","1",!0)),window.location.href=t):i.logger.ULS.Se(593622414,n.X,o.Warning,"Invalid options received in Visio_DocReboot_HostNav message")}(i,t)})),i.addActionHandler(si.cn,(function(e,t){!function(i,e){Ft(i),Wt(i,e.Settings)}(i,t)})),i.addActionHandler(si.sn,(function(e){i.appContext.fastViewPostMessageToWacFrameState.appFrameReadyToReceiveFastViewData=!0,Ot(i)}))}(i),i.appContext.appMode===ki.VIEW?function(i){i.addActionHandler(si.in,(function(e,t){!function(i,e){var t;i.logger.ULS.Se(526455301,n.H,o.Info,"[handleModeSwitchFromViewerFrame] Received switch mode post message from frame with App mode : "+(null===(t=i.appContext)||void 0===t?void 0:t.appMode.toString())),i.container&&i.container.postMessage(yi.Go,void 0),i.backgroundSession?(i.backgroundSession.run(mt.Cl,void 0),i.backgroundSession.run(mt.Al,e)):i.container&&i.container.postMessage(yi.qo,void 0)}(i,t)})),i.addActionHandler(si.Qt,(function(e){kt(i)})),i.addActionHandler(mt.yl,(function(e){i.container&&i.container.postMessage(yi.qo,void 0)})),i.addActionHandler(si.rn,(function(e){!function(i){i.backgroundSession?i.backgroundSession.dispose():i.logger.ULS.Se(523531987,n.X,o.Warning,"handleVisioViewDisposeBkgFrame backgroundEditApp is null")}(i)}))}(i):function(i){i.addActionHandler(mt.Al,(function(e,t){Ut(i,t)})),i.addActionHandler(mt.Tl,(function(e,t){i.appContext.activeSession=t})),i.addActionHandler(si.en,(function(e,t){!function(i,e){var t,r;if(i.logger.ULS.Se(526455302,n.H,o.Info,"[handleModeSwitchAckFromEditor] Received mode switch ack from Editor"+e),i.appContext.modeSwitchAckReceived=!0,null==e?void 0:e.IsSuccess){var s=i.appContext;null===(t=null==s?void 0:s.activeSession)||void 0===t||t.run(Ti.dispose,{notDisposeBackgroundSession:!0},void 0),wt(i.logger,Ui.JSAPIV2),St(i.logger,Wi.BOOTSTART),i.raiseEvent(Le.FrameChanged,null===(r=i.container)||void 0===r?void 0:r.frameId)}else{var a=i.appContext.activeSession;a&&a.run(mt.yl,void 0)}}(i,t)})),i.addActionHandler(mt.Cl,(function(e){i.diagnostics.appInitDiagnostics&&(i.diagnostics.appInitDiagnostics.modeSwitchClickTime=W()),yt(i,!0)})),i.addActionHandler(si.tn,(function(e,t){!function(i,e){var t=i.appContext;if(!ji(i.appUrl)){var n="";e&&e.RefreshOrigin&&(n=e.RefreshOrigin);var o=window.location.href;Hi.getBRSValue(Hi.IsToastUserFixEnabledBRSKey)&&o&&(o=w(o,"wdToastUser")),Hi.getBRSValue(Hi.IsContextAppRefreshFixEnabledBRSKey)&&o&&(o=w(o,"wdActivePageId"),o=w(o,"wdPageScale"),o=w(o,"wdPageCenterX"),o=w(o,"wdPageCenterY")),t.appMode!==ki.EDIT&&t.appMode!==ki.EDIT_NEW||(o&&(o=p(o,"action","edit",!0),n&&(o=p(o,"OR",n,!0)),t.appMode===ki.EDIT_NEW&&(o=p(o,"wdNewAndOpenCt","0",!0))),qi(o))}}(i,t)}))}(i)}function Nt(i){yt(i),Dt(i)}function Bt(i){return{permissionsPolicy:(e=i.appBaseUrl,"microphone ".concat(e,"; autoplay ").concat(e,"; camera ").concat(e,"; clipboard-read ").concat(e,"; clipboard-write ").concat(e,"; keyboard-map ").concat(e,"; display-capture ").concat(e)),isInvisible:i.appUrl.indexOf("backgroundsession")>-1,enforceSameWindow:!0};var e}function Mt(i,e){i.appContext.appMode===ki.VIEW&&Hi.getBRSValue(Hi.CoCommentingAcrossViewAndEditEnabled)&&function(i){i.logger.ULS.Se(523352026,n.H,o.Info,"Sending comment context message to frame"),void 0!==i.appContext.commentContext&&(i.container&&i.container.postMessage(yi.Fo,i.appContext.commentContext),i.appContext.commentContext=void 0)}(i),Ft(i),Wt(i,e.Settings),Et(i),Vt(i),St(i.logger,Wi.BOOTSUCCESS)}function Ht(i){Ft(i),Et(i),Vt(i),St(i.logger,Wi.BOOTFAILED)}function Lt(i,e){St(i.logger,Wi.BOOTEXCEPTION)}function Jt(i){St(i.logger,Wi.BOOTTIMEOUT)}function jt(i){var e;Ji(i.appUrl)&&(null===(e=i.bootHeartBeat)||void 0===e||e.stop())}function Gt(){return 12e4}function zt(i,e){var t,n,o;if(Hi.getBRSValue(Hi.instantCreateNewLocalStorageKey)){if(null===(t=e.bootParams)||void 0===t?void 0:t.isNewFile)return!!(null===(n=e.wdParams)||void 0===n?void 0:n.wdTpl)&&!Hi.getBRSValue(Hi.InstantForAllTemplatesEnabledBRSKey);if(-1!==(null===(o=e.appUrl)||void 0===o?void 0:o.indexOf("wdasp")))return!Hi.getBRSValue(Hi.InstantForAllTemplatesEnabledBRSKey)}return!0}function qt(i,e){var t;Ct(i);var n=i.appContext;n.sessionBootParams=void 0,n.appFramePageViewLoaded=!1,n.modeSwitchAckReceived=!1,ee.dispose(),n.fastViewInfo={fastViewContainer:void 0,fishBowlElement:void 0,imageElement:void 0,pageElement:void 0,docViewLoaded:!1,imageLoaded:!1,docViewResponseText:void 0,fastViewcontainerVisible:!1,fastviewShownFromHostCache:!1,fastViewPLTTime:void 0,defaultImageWidth:void 0,defaultImageHeight:void 0,fastviewContentLoadedFromLocalcache:!1,fastViewImageDataFromCache:void 0,fastViewCacheHit:!1,noChromeMode:!1,noChromeWithToolbar:!1,fastviewSavedToBrowserCache:!1},Hi.dispose(),(null==e?void 0:e.notDisposeBackgroundSession)||null===(t=i.backgroundSession)||void 0===t||t.dispose()}!function(i){i.Al="Visio_BootBackgroundClientApp",i.Tl="Visio_SaveActiveSessionReference",i.Cl="Visio_ShowFastViewInBackgroundSession",i.yl="Visio_RelayFallBackToLegacySwitchToActiveSession"}(mt||(mt={}));var Kt,Xt=function(){var i,e;return[(i={},i[He.appReboot]=Ye,i[He.boot]=ot,i[He.closeTab]=rt,i[He.createNew]=st,i[He.dispose]=dt,i[He.frameTrust]=ft,i[He.getAuthToken]=ht,i[He.getHostKeyValue]=rt,i[He.handleBootState]=pt,i[He.postWacToken]=vt,i[He.rename]=rt,i[He.setOverlayContent]=ce,i[He.setWacFlightValue]=_e,i[He.storeHostKeyValue]=rt,i[He.switchMode]=rt,i[He.updateBootComplete]=rt,i),(e={},e[He.boot]={initializeAppContext:bt,buildAppBasePath:It,buildRemoteTelemetryUrl:Tt,buildBootRequestParams:xt,beforeContainerBoot:Nt,buildContainerBootParams:Bt,onSuccess:Mt,onFailure:Ht,onException:Lt,onTimeout:Jt,beforeBootCompletionMessage:jt,overrideBootTimeout:Gt},e[He.dispose]={disposeAppSpecificResources:qt},e[He.createNew]={fallBackToSingleStepBootFlow:zt},e)]};!function(i){i[i.NotSupported=0]="NotSupported",i[i.SameDocOnly=1]="SameDocOnly",i[i.AnyDoc=2]="AnyDoc",i[i.OtherMode=4]="OtherMode"}(Kt||(Kt={}));var $t=new Ge,Zt=function(i){return new Ze(i,{name:"Visio"},Xt)}}});
//# sourceMappingURL=visio.boot.72a6c404fc3f8c51f406.js.map